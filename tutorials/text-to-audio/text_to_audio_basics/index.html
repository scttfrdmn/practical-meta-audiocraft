<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Text-to-Audio Basics: Combining AudioCraft Models</title>
  <meta name="description" content="A hands-on guide to creating music, sound effects, and audio experiences with AI">
  <link rel="canonical" href="https://scttfrdmn.github.io/practical-meta-audiocraft/tutorials/text-to-audio/text_to_audio_basics/">
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      margin: 0;
      padding: 0;
    }
    .wrapper {
      max-width: 100%;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 0 20px;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    h1 { color: #1a73e8; }
    h2 { color: #34a853; }
    a {
      color: #1a73e8;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .site-header {
      border-bottom: 1px solid #eee;
      padding: 15px 0;
      margin-bottom: 30px;
    }
    .site-title {
      margin: 0;
      font-size: 1.8rem;
    }
    .site-title a {
      color: #1a73e8;
      text-decoration: none;
    }
    .site-nav {
      float: right;
      margin-top: 10px;
    }
    .site-nav .page-link {
      margin-left: 20px;
    }
    .nav-trigger {
      display: none;
    }
    .menu-icon {
      display: none;
    }
    .page-content {
      padding: 20px 0;
    }
    .site-footer {
      border-top: 1px solid #eee;
      padding: 30px 0;
      margin-top: 60px;
    }
    .footer-col-wrapper {
      display: flex;
      flex-wrap: wrap;
    }
    .footer-col {
      flex: 1;
      min-width: 200px;
      padding-right: 20px;
    }
    code {
      background-color: #f5f5f5;
      padding: 2px 5px;
      border-radius: 3px;
    }
    pre {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
    .highlight {
      background-color: #f5f5f5;
      border-radius: 5px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px 12px;
    }
    th {
      background-color: #f5f5f5;
      text-align: left;
    }
    button, .button {
      display: inline-block;
      background-color: #1a73e8;
      color: white !important;
      padding: 10px 20px;
      border-radius: 4px;
      font-weight: bold;
      margin-top: 20px;
      border: none;
      cursor: pointer;
      text-decoration: none !important;
    }
    button:hover, .button:hover {
      background-color: #0d65d9;
    }
    .feature {
      background-color: #f5f5f5;
      border-radius: 8px;
      padding: 20px;
      border-left: 4px solid #1a73e8;
      margin-bottom: 20px;
    }
    
    @media screen and (max-width: 600px) {
      .site-nav {
        position: absolute;
        top: 70px;
        right: 20px;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        text-align: right;
        padding: 0;
        z-index: 1;
      }
      .site-nav .page-link {
        display: block;
        padding: 10px;
        margin: 0;
      }
      .site-nav .menu-icon {
        display: block;
        float: right;
        width: 36px;
        height: 26px;
        line-height: 0;
        padding-top: 10px;
        text-align: center;
      }
      .site-nav .trigger {
        clear: both;
        display: none;
      }
      .site-nav input:checked ~ .trigger {
        display: block;
        padding-bottom: 5px;
      }
      .footer-col-wrapper {
        flex-direction: column;
      }
      .footer-col {
        margin-bottom: 20px;
      }
    }
  </style>
</head><body>
    <div class="wrapper">
      <header class="site-header">
        <div class="container">
          <h1 class="site-title"><a href="/practical-meta-audiocraft/">Practical Meta AudioCraft</a></h1>
          <nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
              <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                  <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484c0-0.82,0.665-1.485,1.484-1.485 h15.032C17.335,0,18,0.665,18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516 c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,6.031,18,6.696,18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516c0-0.82,0.665-1.483,1.484-1.483h15.032 C17.335,12.031,18,12.696,18,13.516z"/>
                </svg>
              </span>
            </label>

            <div class="trigger">
              <a class="page-link" href="/practical-meta-audiocraft/">Home</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part1/introduction/">Getting Started</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part2/basic-music/">MusicGen</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part3/introduction-to-audiogen/">AudioGen</a>
              <a class="page-link" href="/practical-meta-audiocraft/tutorials/getting-started/">Tutorials</a>
            </div>
          </nav>
        </div>
      </header>

      <main class="page-content" aria-label="Content">
        <div class="container">
          <article class="post">

  <header class="post-header">
    <h1 class="post-title">Text-to-Audio Basics: Combining AudioCraft Models</h1>
  </header>

  <div class="post-content">
    <h1 id="text-to-audio-basics-combining-audiocraft-models">Text-to-Audio Basics: Combining AudioCraft Models</h1>

<p>This tutorial covers techniques for building flexible text-to-audio pipelines using AudioCraft’s different models. We’ll explore how to combine MusicGen and AudioGen to create comprehensive audio experiences.</p>

<h2 id="introduction-to-text-to-audio-pipelines">Introduction to Text-to-Audio Pipelines</h2>

<p>While MusicGen specializes in music generation and AudioGen focuses on environmental sounds, combining these models opens up a wide range of possibilities for creating complete audio scenes and experiences. In this tutorial, we’ll look at how to:</p>

<ol>
  <li>Build a multi-model pipeline</li>
  <li>Create hybrid audio generations</li>
  <li>Develop a unified interface for different audio types</li>
  <li>Mix and layer generated audio from different models</li>
</ol>

<h2 id="setting-up-a-multi-model-environment">Setting Up a Multi-Model Environment</h2>

<p>First, let’s create a script that can access both MusicGen and AudioGen:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># text_to_audio_pipeline.py
</span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchaudio</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">audiocraft.models</span> <span class="kn">import</span> <span class="n">MusicGen</span><span class="p">,</span> <span class="n">AudioGen</span>
<span class="kn">from</span> <span class="nn">audiocraft.data.audio</span> <span class="kn">import</span> <span class="n">audio_write</span>

<span class="k">class</span> <span class="nc">TextToAudioPipeline</span><span class="p">:</span>
    <span class="s">"""
    A unified pipeline for generating various types of audio from text.
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="s">"""
        Initialize the text-to-audio pipeline.
        
        Args:
            use_gpu (bool): Whether to use GPU acceleration if available
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_get_device</span><span class="p">()</span> <span class="k">if</span> <span class="n">use_gpu</span> <span class="k">else</span> <span class="s">"cpu"</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sample_rate</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Using device: </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">device</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_get_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Determine the best available device."""</span>
        <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">backends</span><span class="p">.</span><span class="n">mps</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
            <span class="k">return</span> <span class="s">"mps"</span>
        <span class="k">elif</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
            <span class="k">return</span> <span class="s">"cuda"</span>
        <span class="k">return</span> <span class="s">"cpu"</span>
    
    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">model_size</span><span class="p">):</span>
        <span class="s">"""
        Load a specific audio generation model.
        
        Args:
            model_type (str): Type of model ("music" or "audio")
            model_size (str): Size of model ("small", "medium", or "large")
        """</span>
        <span class="k">if</span> <span class="n">model_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"music"</span><span class="p">,</span> <span class="s">"audio"</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Model type must be 'music' or 'audio'"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s">"music"</span> <span class="ow">and</span> <span class="n">model_size</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"small"</span><span class="p">,</span> <span class="s">"medium"</span><span class="p">,</span> <span class="s">"large"</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"MusicGen size must be 'small', 'medium', or 'large'"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s">"audio"</span> <span class="ow">and</span> <span class="n">model_size</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"medium"</span><span class="p">,</span> <span class="s">"large"</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"AudioGen size must be 'medium' or 'large'"</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Loading </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s"> model (</span><span class="si">{</span><span class="n">model_size</span><span class="si">}</span><span class="s">)..."</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s">"music"</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">MusicGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="n">model_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">models</span><span class="p">[</span><span class="s">"music"</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">AudioGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="n">model_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">models</span><span class="p">[</span><span class="s">"audio"</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
        
        <span class="n">model</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">device</span><span class="p">)</span>
        
        <span class="c1"># Store sample rate (same for all models)
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">sample_rate</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">model_type</span><span class="p">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s"> model loaded successfully!"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="s">"""
        Generate audio from a text prompt using the specified model.
        
        Args:
            prompt (str): Text prompt describing the audio to generate
            model_type (str): Type of model to use ("music" or "audio")
            duration (float): Length of audio in seconds
            temperature (float): Controls randomness (higher = more random)
            
        Returns:
            torch.Tensor: Generated audio tensor
        """</span>
        <span class="k">if</span> <span class="n">model_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">models</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">model_type</span><span class="p">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s"> model not loaded. Call load_model first."</span><span class="p">)</span>
        
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">models</span><span class="p">[</span><span class="n">model_type</span><span class="p">]</span>
        
        <span class="c1"># Set generation parameters
</span>        <span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
            <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
            <span class="n">top_k</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
            <span class="n">top_p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s"> with prompt: '</span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s">'"</span><span class="p">)</span>
        
        <span class="c1"># Generate audio
</span>        <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">([</span><span class="n">prompt</span><span class="p">])</span>
        
        <span class="c1"># Move to CPU
</span>        <span class="k">return</span> <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">save_audio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">audio_tensor</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s">"audio_output"</span><span class="p">):</span>
        <span class="s">"""
        Save an audio tensor to a file.
        
        Args:
            audio_tensor (torch.Tensor): Audio tensor to save
            filename (str): Base filename (without extension)
            output_dir (str): Directory to save to
        """</span>
        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        
        <span class="n">audio_write</span><span class="p">(</span>
            <span class="n">output_path</span><span class="p">,</span>
            <span class="n">audio_tensor</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
            <span class="n">strategy</span><span class="o">=</span><span class="s">"loudness"</span>
        <span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Audio saved to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span>
    
    <span class="k">def</span> <span class="nf">mix_audio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">audio_tensors</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""
        Mix multiple audio tensors together.
        
        Args:
            audio_tensors (list): List of audio tensors to mix
            weights (list, optional): Weights for each audio tensor
            
        Returns:
            torch.Tensor: Mixed audio tensor
        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">audio_tensors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"No audio tensors provided for mixing"</span><span class="p">)</span>
        
        <span class="c1"># Default to equal weights if not specified
</span>        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio_tensors</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio_tensors</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio_tensors</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Number of weights must match number of audio tensors"</span><span class="p">)</span>
        
        <span class="c1"># Convert all tensors to numpy for easier handling
</span>        <span class="n">audio_arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">tensor</span><span class="p">.</span><span class="n">numpy</span><span class="p">()</span> <span class="k">for</span> <span class="n">tensor</span> <span class="ow">in</span> <span class="n">audio_tensors</span><span class="p">]</span>
        
        <span class="c1"># Find the longest audio
</span>        <span class="n">max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">array</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">array</span> <span class="ow">in</span> <span class="n">audio_arrays</span><span class="p">)</span>
        
        <span class="c1"># Initialize output array
</span>        <span class="n">mixed_audio</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_length</span><span class="p">)</span>
        
        <span class="c1"># Mix each audio with its weight
</span>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">audio_arrays</span><span class="p">,</span> <span class="n">weights</span><span class="p">)):</span>
            <span class="c1"># Pad shorter audios with silence
</span>            <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_length</span><span class="p">)</span>
            <span class="n">padded</span><span class="p">[:</span><span class="n">array</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">array</span>
            
            <span class="c1"># Add to mix with weight
</span>            <span class="n">mixed_audio</span> <span class="o">+=</span> <span class="n">padded</span> <span class="o">*</span> <span class="n">weight</span>
        
        <span class="c1"># Normalize to prevent clipping
</span>        <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">mixed_audio</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">mixed_audio</span> <span class="o">=</span> <span class="n">mixed_audio</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">mixed_audio</span><span class="p">))</span>
        
        <span class="c1"># Convert back to tensor
</span>        <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">mixed_audio</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># Example usage
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="c1"># Create the pipeline
</span>    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">TextToAudioPipeline</span><span class="p">()</span>
    
    <span class="c1"># Load models
</span>    <span class="n">pipeline</span><span class="p">.</span><span class="n">load_model</span><span class="p">(</span><span class="s">"music"</span><span class="p">,</span> <span class="s">"small"</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="p">.</span><span class="n">load_model</span><span class="p">(</span><span class="s">"audio"</span><span class="p">,</span> <span class="s">"medium"</span><span class="p">)</span>
    
    <span class="c1"># Generate music
</span>    <span class="n">music_prompt</span> <span class="o">=</span> <span class="s">"Gentle ambient music with soft piano and synthesizer pads"</span>
    <span class="n">music_audio</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">music_prompt</span><span class="p">,</span> <span class="s">"music"</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    
    <span class="c1"># Generate sound effects
</span>    <span class="n">sfx_prompt</span> <span class="o">=</span> <span class="s">"Forest ambience with birds chirping and leaves rustling"</span>
    <span class="n">sfx_audio</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">sfx_prompt</span><span class="p">,</span> <span class="s">"audio"</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    
    <span class="c1"># Save individual tracks
</span>    <span class="n">pipeline</span><span class="p">.</span><span class="n">save_audio</span><span class="p">(</span><span class="n">music_audio</span><span class="p">,</span> <span class="s">"ambient_music"</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="p">.</span><span class="n">save_audio</span><span class="p">(</span><span class="n">sfx_audio</span><span class="p">,</span> <span class="s">"forest_ambience"</span><span class="p">)</span>
    
    <span class="c1"># Mix them together with music at 70% and SFX at 50%
</span>    <span class="n">mixed_audio</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">mix_audio</span><span class="p">([</span><span class="n">music_audio</span><span class="p">,</span> <span class="n">sfx_audio</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="n">pipeline</span><span class="p">.</span><span class="n">save_audio</span><span class="p">(</span><span class="n">mixed_audio</span><span class="p">,</span> <span class="s">"ambient_forest_scene"</span><span class="p">)</span>
</code></pre></div></div>

<p>This script provides a unified interface for working with both MusicGen and AudioGen, making it easy to generate and combine different types of audio.</p>

<h2 id="creating-scene-based-audio-compositions">Creating Scene-Based Audio Compositions</h2>

<p>Now let’s create a script that generates complete audio scenes by combining multiple elements:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># audio_scene_generator.py
</span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">text_to_audio_pipeline</span> <span class="kn">import</span> <span class="n">TextToAudioPipeline</span>

<span class="k">def</span> <span class="nf">generate_audio_scene</span><span class="p">(</span><span class="n">scene_description</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s">"scenes"</span><span class="p">):</span>
    <span class="s">"""
    Generate a complete audio scene from a structured description.
    
    Args:
        scene_description (dict): Scene description with components
        output_dir (str): Directory to save output files
    """</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Create output scene directory
</span>    <span class="n">scene_name</span> <span class="o">=</span> <span class="n">scene_description</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"unnamed_scene"</span><span class="p">)</span>
    <span class="n">safe_name</span> <span class="o">=</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span> <span class="k">if</span> <span class="n">c</span><span class="p">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s">"_"</span> <span class="k">else</span> <span class="s">"_"</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">scene_name</span><span class="p">)</span>
    <span class="n">scene_dir</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">safe_name</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">scene_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Initialize the pipeline
</span>    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">TextToAudioPipeline</span><span class="p">()</span>
    
    <span class="c1"># Load required models based on the scene components
</span>    <span class="n">models_needed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">scene_description</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"components"</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">models_needed</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">component</span><span class="p">[</span><span class="s">"type"</span><span class="p">])</span>
    
    <span class="k">for</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="n">models_needed</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="s">"small"</span> <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s">"music"</span> <span class="k">else</span> <span class="s">"medium"</span>
        <span class="n">pipeline</span><span class="p">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_type</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    
    <span class="c1"># Generate each component
</span>    <span class="n">component_audios</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">component_weights</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">component</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scene_description</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"components"</span><span class="p">,</span> <span class="p">[])):</span>
        <span class="n">component_type</span> <span class="o">=</span> <span class="n">component</span><span class="p">[</span><span class="s">"type"</span><span class="p">]</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">component</span><span class="p">[</span><span class="s">"prompt"</span><span class="p">]</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">component</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"duration"</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="n">component</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"temperature"</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">component</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"weight"</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating component </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">scene_description</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'components'</span><span class="p">,</span> <span class="p">[]))</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
        <span class="c1"># Generate audio for this component
</span>        <span class="n">audio</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">component_type</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span>
        
        <span class="c1"># Save individual component
</span>        <span class="n">component_name</span> <span class="o">=</span> <span class="n">component</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="n">safe_component_name</span> <span class="o">=</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span> <span class="k">if</span> <span class="n">c</span><span class="p">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s">"_"</span> <span class="k">else</span> <span class="s">"_"</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">component_name</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="p">.</span><span class="n">save_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">safe_component_name</span><span class="p">,</span> <span class="n">scene_dir</span><span class="p">)</span>
        
        <span class="c1"># Add to the list for mixing
</span>        <span class="n">component_audios</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        <span class="n">component_weights</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
    
    <span class="c1"># Mix all components together
</span>    <span class="k">if</span> <span class="n">component_audios</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Mixing components together..."</span><span class="p">)</span>
        <span class="n">mixed_audio</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">mix_audio</span><span class="p">(</span><span class="n">component_audios</span><span class="p">,</span> <span class="n">component_weights</span><span class="p">)</span>
        
        <span class="c1"># Save the mixed scene
</span>        <span class="n">pipeline</span><span class="p">.</span><span class="n">save_audio</span><span class="p">(</span><span class="n">mixed_audio</span><span class="p">,</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">safe_name</span><span class="si">}</span><span class="s">_complete"</span><span class="p">,</span> <span class="n">scene_dir</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Scene generation complete! Files saved to </span><span class="si">{</span><span class="n">scene_dir</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="c1"># Example scene descriptions
</span><span class="n">scenes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s">"name"</span><span class="p">:</span> <span class="s">"Peaceful Forest Morning"</span><span class="p">,</span>
        <span class="s">"components"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">"name"</span><span class="p">:</span> <span class="s">"background_music"</span><span class="p">,</span>
                <span class="s">"type"</span><span class="p">:</span> <span class="s">"music"</span><span class="p">,</span>
                <span class="s">"prompt"</span><span class="p">:</span> <span class="s">"Gentle ambient music with soft piano and nature-inspired melodies"</span><span class="p">,</span> 
                <span class="s">"duration"</span><span class="p">:</span> <span class="mf">15.0</span><span class="p">,</span>
                <span class="s">"temperature"</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
                <span class="s">"weight"</span><span class="p">:</span> <span class="mf">0.6</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s">"name"</span><span class="p">:</span> <span class="s">"forest_ambience"</span><span class="p">,</span>
                <span class="s">"type"</span><span class="p">:</span> <span class="s">"audio"</span><span class="p">,</span>
                <span class="s">"prompt"</span><span class="p">:</span> <span class="s">"Forest ambience with birds chirping, gentle breeze through leaves, and distant stream"</span><span class="p">,</span>
                <span class="s">"duration"</span><span class="p">:</span> <span class="mf">15.0</span><span class="p">,</span>
                <span class="s">"temperature"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="s">"weight"</span><span class="p">:</span> <span class="mf">0.8</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">"name"</span><span class="p">:</span> <span class="s">"Busy City Cafe"</span><span class="p">,</span>
        <span class="s">"components"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">"name"</span><span class="p">:</span> <span class="s">"jazz_music"</span><span class="p">,</span>
                <span class="s">"type"</span><span class="p">:</span> <span class="s">"music"</span><span class="p">,</span>
                <span class="s">"prompt"</span><span class="p">:</span> <span class="s">"Smooth jazz cafe music with piano, bass, and soft drums"</span><span class="p">,</span>
                <span class="s">"duration"</span><span class="p">:</span> <span class="mf">15.0</span><span class="p">,</span>
                <span class="s">"temperature"</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
                <span class="s">"weight"</span><span class="p">:</span> <span class="mf">0.5</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s">"name"</span><span class="p">:</span> <span class="s">"cafe_ambience"</span><span class="p">,</span>
                <span class="s">"type"</span><span class="p">:</span> <span class="s">"audio"</span><span class="p">,</span>
                <span class="s">"prompt"</span><span class="p">:</span> <span class="s">"Busy cafe with conversations, coffee machines, cups clinking, and chairs moving"</span><span class="p">,</span>
                <span class="s">"duration"</span><span class="p">:</span> <span class="mf">15.0</span><span class="p">,</span>
                <span class="s">"temperature"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="s">"weight"</span><span class="p">:</span> <span class="mf">0.7</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s">"name"</span><span class="p">:</span> <span class="s">"outside_traffic"</span><span class="p">,</span>
                <span class="s">"type"</span><span class="p">:</span> <span class="s">"audio"</span><span class="p">,</span>
                <span class="s">"prompt"</span><span class="p">:</span> <span class="s">"Distant city traffic and occasional car horns through windows"</span><span class="p">,</span>
                <span class="s">"duration"</span><span class="p">:</span> <span class="mf">15.0</span><span class="p">,</span>
                <span class="s">"temperature"</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
                <span class="s">"weight"</span><span class="p">:</span> <span class="mf">0.3</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="c1"># Generate the forest scene
</span>    <span class="n">generate_audio_scene</span><span class="p">(</span><span class="n">scenes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="c1"># Uncomment to generate the cafe scene
</span>    <span class="c1"># generate_audio_scene(scenes[1])
</span></code></pre></div></div>

<p>This script allows you to define complex audio scenes with multiple components, each generated by the appropriate model, and then mix them together with custom weights.</p>

<h2 id="building-a-dynamic-audio-environment">Building a Dynamic Audio Environment</h2>

<p>Let’s create a more interactive example that can dynamically change the audio environment based on parameters:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dynamic_audio_environment.py
</span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">text_to_audio_pipeline</span> <span class="kn">import</span> <span class="n">TextToAudioPipeline</span>

<span class="k">class</span> <span class="nc">DynamicAudioEnvironment</span><span class="p">:</span>
    <span class="s">"""
    A system that generates atmospheric audio environments that can change
    dynamically based on parameters.
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Initialize the dynamic audio environment."""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">TextToAudioPipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pipeline</span><span class="p">.</span><span class="n">load_model</span><span class="p">(</span><span class="s">"music"</span><span class="p">,</span> <span class="s">"small"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pipeline</span><span class="p">.</span><span class="n">load_model</span><span class="p">(</span><span class="s">"audio"</span><span class="p">,</span> <span class="s">"medium"</span><span class="p">)</span>
        
        <span class="c1"># Define base prompts for different environment types
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">environment_templates</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"forest"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"music"</span><span class="p">:</span> <span class="s">"Peaceful {mood} ambient music inspired by forest sounds with {instrument}"</span><span class="p">,</span>
                <span class="s">"ambient"</span><span class="p">:</span> <span class="s">"Forest environment with {time_of_day} atmosphere, {weather} conditions, and {wildlife} sounds"</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s">"ocean"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"music"</span><span class="p">:</span> <span class="s">"{mood} ambient music with {instrument}, reminiscent of ocean waves and sea breeze"</span><span class="p">,</span>
                <span class="s">"ambient"</span><span class="p">:</span> <span class="s">"Ocean shore with {weather} conditions, {time_of_day} atmosphere, and {wildlife} sounds"</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s">"city"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"music"</span><span class="p">:</span> <span class="s">"Urban {mood} background music with {instrument} for a city environment"</span><span class="p">,</span>
                <span class="s">"ambient"</span><span class="p">:</span> <span class="s">"{time_of_day} city sounds with {weather} conditions, {traffic_level} traffic, and {crowd_level} crowd noise"</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s">"space"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"music"</span><span class="p">:</span> <span class="s">"Ethereal {mood} space-themed ambient music with {instrument}"</span><span class="p">,</span>
                <span class="s">"ambient"</span><span class="p">:</span> <span class="s">"Science fiction space environment with {spacecraft} sounds, {activity} noises, and distant {events}"</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c1"># Parameter options
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"mood"</span><span class="p">:</span> <span class="p">[</span><span class="s">"calm"</span><span class="p">,</span> <span class="s">"mysterious"</span><span class="p">,</span> <span class="s">"uplifting"</span><span class="p">,</span> <span class="s">"melancholic"</span><span class="p">,</span> <span class="s">"tense"</span><span class="p">,</span> <span class="s">"hopeful"</span><span class="p">],</span>
            <span class="s">"instrument"</span><span class="p">:</span> <span class="p">[</span><span class="s">"piano"</span><span class="p">,</span> <span class="s">"synthesizer pads"</span><span class="p">,</span> <span class="s">"strings"</span><span class="p">,</span> <span class="s">"flute"</span><span class="p">,</span> <span class="s">"guitar"</span><span class="p">,</span> <span class="s">"digital textures"</span><span class="p">],</span>
            <span class="s">"time_of_day"</span><span class="p">:</span> <span class="p">[</span><span class="s">"morning"</span><span class="p">,</span> <span class="s">"afternoon"</span><span class="p">,</span> <span class="s">"evening"</span><span class="p">,</span> <span class="s">"night"</span><span class="p">,</span> <span class="s">"dawn"</span><span class="p">,</span> <span class="s">"dusk"</span><span class="p">],</span>
            <span class="s">"weather"</span><span class="p">:</span> <span class="p">[</span><span class="s">"clear"</span><span class="p">,</span> <span class="s">"rainy"</span><span class="p">,</span> <span class="s">"windy"</span><span class="p">,</span> <span class="s">"stormy"</span><span class="p">,</span> <span class="s">"foggy"</span><span class="p">,</span> <span class="s">"sunny"</span><span class="p">],</span>
            <span class="s">"wildlife"</span><span class="p">:</span> <span class="p">[</span><span class="s">"birds"</span><span class="p">,</span> <span class="s">"insects"</span><span class="p">,</span> <span class="s">"small animals"</span><span class="p">,</span> <span class="s">"frogs"</span><span class="p">,</span> <span class="s">"distant animals"</span><span class="p">,</span> <span class="s">"minimal wildlife"</span><span class="p">],</span>
            <span class="s">"traffic_level"</span><span class="p">:</span> <span class="p">[</span><span class="s">"light"</span><span class="p">,</span> <span class="s">"moderate"</span><span class="p">,</span> <span class="s">"heavy"</span><span class="p">,</span> <span class="s">"occasional"</span><span class="p">,</span> <span class="s">"distant"</span><span class="p">,</span> <span class="s">"none"</span><span class="p">],</span>
            <span class="s">"crowd_level"</span><span class="p">:</span> <span class="p">[</span><span class="s">"quiet"</span><span class="p">,</span> <span class="s">"moderate"</span><span class="p">,</span> <span class="s">"busy"</span><span class="p">,</span> <span class="s">"sparse"</span><span class="p">,</span> <span class="s">"loud"</span><span class="p">,</span> <span class="s">"none"</span><span class="p">],</span>
            <span class="s">"spacecraft"</span><span class="p">:</span> <span class="p">[</span><span class="s">"engine hum"</span><span class="p">,</span> <span class="s">"control room beeps"</span><span class="p">,</span> <span class="s">"airlock"</span><span class="p">,</span> <span class="s">"life support systems"</span><span class="p">,</span> <span class="s">"computers"</span><span class="p">],</span>
            <span class="s">"activity"</span><span class="p">:</span> <span class="p">[</span><span class="s">"crew movement"</span><span class="p">,</span> <span class="s">"mechanical work"</span><span class="p">,</span> <span class="s">"communication signals"</span><span class="p">,</span> <span class="s">"docking procedures"</span><span class="p">],</span>
            <span class="s">"events"</span><span class="p">:</span> <span class="p">[</span><span class="s">"asteroid impacts"</span><span class="p">,</span> <span class="s">"space debris"</span><span class="p">,</span> <span class="s">"alien signals"</span><span class="p">,</span> <span class="s">"warp drive"</span><span class="p">,</span> <span class="s">"distant explosions"</span><span class="p">]</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">generate_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_type</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s">"environments"</span><span class="p">):</span>
        <span class="s">"""
        Generate a complete audio environment.
        
        Args:
            env_type (str): Environment type ('forest', 'ocean', 'city', 'space')
            params (dict): Parameters to customize the environment
            duration (float): Length of audio in seconds
            output_dir (str): Directory to save output files
        """</span>
        <span class="k">if</span> <span class="n">env_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">environment_templates</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s">"Unknown environment type: </span><span class="si">{</span><span class="n">env_type</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
        <span class="c1"># Use default parameters if none provided
</span>        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># Fill in default parameters for any missing ones
</span>        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="c1"># Use first option as default
</span>                <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Create output directory
</span>        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Format the prompts with parameters
</span>        <span class="n">music_template</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">environment_templates</span><span class="p">[</span><span class="n">env_type</span><span class="p">][</span><span class="s">"music"</span><span class="p">]</span>
        <span class="n">ambient_template</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">environment_templates</span><span class="p">[</span><span class="n">env_type</span><span class="p">][</span><span class="s">"ambient"</span><span class="p">]</span>
        
        <span class="n">music_prompt</span> <span class="o">=</span> <span class="n">music_template</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="n">ambient_prompt</span> <span class="o">=</span> <span class="n">ambient_template</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating </span><span class="si">{</span><span class="n">env_type</span><span class="si">}</span><span class="s"> environment with:"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Music prompt: '</span><span class="si">{</span><span class="n">music_prompt</span><span class="si">}</span><span class="s">'"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Ambient prompt: '</span><span class="si">{</span><span class="n">ambient_prompt</span><span class="si">}</span><span class="s">'"</span><span class="p">)</span>
        
        <span class="c1"># Generate both components
</span>        <span class="n">music_audio</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">pipeline</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">music_prompt</span><span class="p">,</span> <span class="s">"music"</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">ambient_audio</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">pipeline</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">ambient_prompt</span><span class="p">,</span> <span class="s">"audio"</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        
        <span class="c1"># Save individual components
</span>        <span class="n">music_file</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">pipeline</span><span class="p">.</span><span class="n">save_audio</span><span class="p">(</span><span class="n">music_audio</span><span class="p">,</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">env_type</span><span class="si">}</span><span class="s">_music"</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>
        <span class="n">ambient_file</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">pipeline</span><span class="p">.</span><span class="n">save_audio</span><span class="p">(</span><span class="n">ambient_audio</span><span class="p">,</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">env_type</span><span class="si">}</span><span class="s">_ambient"</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>
        
        <span class="c1"># Mix them together
</span>        <span class="n">mixed_audio</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">pipeline</span><span class="p">.</span><span class="n">mix_audio</span><span class="p">([</span><span class="n">music_audio</span><span class="p">,</span> <span class="n">ambient_audio</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
        <span class="n">mixed_file</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">pipeline</span><span class="p">.</span><span class="n">save_audio</span><span class="p">(</span><span class="n">mixed_audio</span><span class="p">,</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">env_type</span><span class="si">}</span><span class="s">_environment"</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">"music"</span><span class="p">:</span> <span class="n">music_file</span><span class="p">,</span>
            <span class="s">"ambient"</span><span class="p">:</span> <span class="n">ambient_file</span><span class="p">,</span>
            <span class="s">"mixed"</span><span class="p">:</span> <span class="n">mixed_file</span>
        <span class="p">}</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Generate dynamic audio environments'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--type'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'forest'</span><span class="p">,</span> 
                        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">'forest'</span><span class="p">,</span> <span class="s">'ocean'</span><span class="p">,</span> <span class="s">'city'</span><span class="p">,</span> <span class="s">'space'</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">'Environment type'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--mood'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'calm'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">'Mood of the music'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--instrument'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'piano'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">'Primary instrument for music'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--time'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'morning'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">'Time of day'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--weather'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'clear'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">'Weather conditions'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--duration'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">'Duration in seconds'</span><span class="p">)</span>
    
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>
    
    <span class="c1"># Create the environment generator
</span>    <span class="n">env_generator</span> <span class="o">=</span> <span class="n">DynamicAudioEnvironment</span><span class="p">()</span>
    
    <span class="c1"># Generate the environment with specified parameters
</span>    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"mood"</span><span class="p">:</span> <span class="n">args</span><span class="p">.</span><span class="n">mood</span><span class="p">,</span>
        <span class="s">"instrument"</span><span class="p">:</span> <span class="n">args</span><span class="p">.</span><span class="n">instrument</span><span class="p">,</span>
        <span class="s">"time_of_day"</span><span class="p">:</span> <span class="n">args</span><span class="p">.</span><span class="n">time</span><span class="p">,</span>
        <span class="s">"weather"</span><span class="p">:</span> <span class="n">args</span><span class="p">.</span><span class="n">weather</span>
    <span class="p">}</span>
    
    <span class="n">env_generator</span><span class="p">.</span><span class="n">generate_environment</span><span class="p">(</span>
        <span class="n">args</span><span class="p">.</span><span class="nb">type</span><span class="p">,</span>
        <span class="n">params</span><span class="p">,</span>
        <span class="n">duration</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">duration</span>
    <span class="p">)</span>
</code></pre></div></div>

<p>This script allows you to generate different environmental audio scenes with parameterized prompts, giving you fine-grained control over the generated output.</p>

<h2 id="creating-a-web-interface-for-text-to-audio-generation">Creating a Web Interface for Text-to-Audio Generation</h2>

<p>We can create a simple web interface for our text-to-audio pipeline using Gradio:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># text_to_audio_web.py
</span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">gradio</span> <span class="k">as</span> <span class="n">gr</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">text_to_audio_pipeline</span> <span class="kn">import</span> <span class="n">TextToAudioPipeline</span>

<span class="c1"># Initialize the pipeline
</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">TextToAudioPipeline</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">initialize_models</span><span class="p">(</span><span class="n">music_model</span><span class="p">,</span> <span class="n">audio_model</span><span class="p">):</span>
    <span class="s">"""Initialize both models."""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pipeline</span><span class="p">.</span><span class="n">load_model</span><span class="p">(</span><span class="s">"music"</span><span class="p">,</span> <span class="n">music_model</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="p">.</span><span class="n">load_model</span><span class="p">(</span><span class="s">"audio"</span><span class="p">,</span> <span class="n">audio_model</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">"Models loaded successfully!"</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s">"Error loading models: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span>

<span class="k">def</span> <span class="nf">generate_audio</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">temperature</span><span class="p">):</span>
    <span class="s">"""Generate audio from a text prompt."""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Generate audio
</span>        <span class="n">audio</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">duration</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">temperature</span><span class="p">))</span>
        
        <span class="c1"># Create a unique filename
</span>        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s">"web_output"</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"generated_</span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'web_output'</span><span class="p">))</span><span class="si">}</span><span class="s">"</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">save_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="s">"web_output"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">output_path</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span>

<span class="k">def</span> <span class="nf">generate_mixed_scene</span><span class="p">(</span><span class="n">music_prompt</span><span class="p">,</span> <span class="n">ambient_prompt</span><span class="p">,</span> <span class="n">music_weight</span><span class="p">,</span> <span class="n">ambient_weight</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
    <span class="s">"""Generate a mixed audio scene with music and ambient sounds."""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Generate both components
</span>        <span class="n">music_audio</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">music_prompt</span><span class="p">,</span> <span class="s">"music"</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">duration</span><span class="p">),</span> <span class="mf">0.7</span><span class="p">)</span>
        <span class="n">ambient_audio</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">ambient_prompt</span><span class="p">,</span> <span class="s">"audio"</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">duration</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
        
        <span class="c1"># Mix them
</span>        <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">music_weight</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ambient_weight</span><span class="p">)]</span>
        <span class="n">mixed_audio</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">mix_audio</span><span class="p">([</span><span class="n">music_audio</span><span class="p">,</span> <span class="n">ambient_audio</span><span class="p">],</span> <span class="n">weights</span><span class="p">)</span>
        
        <span class="c1"># Save the mixed audio
</span>        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s">"web_output"</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"mixed_scene_</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'web_output'</span><span class="p">))</span><span class="si">}</span><span class="s">"</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">save_audio</span><span class="p">(</span><span class="n">mixed_audio</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="s">"web_output"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">output_path</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span>

<span class="c1"># Create the web interface
</span><span class="k">with</span> <span class="n">gr</span><span class="p">.</span><span class="n">Blocks</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Text-to-Audio Generator"</span><span class="p">)</span> <span class="k">as</span> <span class="n">demo</span><span class="p">:</span>
    <span class="n">gr</span><span class="p">.</span><span class="n">Markdown</span><span class="p">(</span><span class="s">"# Text-to-Audio Generator"</span><span class="p">)</span>
    <span class="n">gr</span><span class="p">.</span><span class="n">Markdown</span><span class="p">(</span><span class="s">"Generate music, sound effects, or mixed audio scenes from text descriptions."</span><span class="p">)</span>
    
    <span class="k">with</span> <span class="n">gr</span><span class="p">.</span><span class="n">Tab</span><span class="p">(</span><span class="s">"Setup"</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">gr</span><span class="p">.</span><span class="n">Row</span><span class="p">():</span>
            <span class="n">music_model</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Dropdown</span><span class="p">(</span>
                <span class="p">[</span><span class="s">"small"</span><span class="p">,</span> <span class="s">"medium"</span><span class="p">,</span> <span class="s">"large"</span><span class="p">],</span> 
                <span class="n">label</span><span class="o">=</span><span class="s">"MusicGen Model Size"</span><span class="p">,</span> 
                <span class="n">value</span><span class="o">=</span><span class="s">"small"</span>
            <span class="p">)</span>
            <span class="n">audio_model</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Dropdown</span><span class="p">(</span>
                <span class="p">[</span><span class="s">"medium"</span><span class="p">,</span> <span class="s">"large"</span><span class="p">],</span> 
                <span class="n">label</span><span class="o">=</span><span class="s">"AudioGen Model Size"</span><span class="p">,</span> 
                <span class="n">value</span><span class="o">=</span><span class="s">"medium"</span>
            <span class="p">)</span>
        <span class="n">load_btn</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s">"Load Models"</span><span class="p">)</span>
        <span class="n">load_output</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">"Status"</span><span class="p">)</span>
        <span class="n">load_btn</span><span class="p">.</span><span class="n">click</span><span class="p">(</span><span class="n">initialize_models</span><span class="p">,</span> <span class="p">[</span><span class="n">music_model</span><span class="p">,</span> <span class="n">audio_model</span><span class="p">],</span> <span class="n">load_output</span><span class="p">)</span>
    
    <span class="k">with</span> <span class="n">gr</span><span class="p">.</span><span class="n">Tab</span><span class="p">(</span><span class="s">"Single Generation"</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">gr</span><span class="p">.</span><span class="n">Row</span><span class="p">():</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">"Text Prompt"</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">model_select</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Radio</span><span class="p">([</span><span class="s">"music"</span><span class="p">,</span> <span class="s">"audio"</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">"Model Type"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">"music"</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="n">gr</span><span class="p">.</span><span class="n">Row</span><span class="p">():</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Slider</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"Duration (seconds)"</span><span class="p">)</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Slider</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"Temperature"</span><span class="p">)</span>
        
        <span class="n">generate_btn</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s">"Generate Audio"</span><span class="p">)</span>
        <span class="n">audio_output</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Audio</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">"Generated Audio"</span><span class="p">)</span>
        
        <span class="n">generate_btn</span><span class="p">.</span><span class="n">click</span><span class="p">(</span>
            <span class="n">generate_audio</span><span class="p">,</span> 
            <span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">model_select</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">temperature</span><span class="p">],</span> 
            <span class="n">audio_output</span>
        <span class="p">)</span>
    
    <span class="k">with</span> <span class="n">gr</span><span class="p">.</span><span class="n">Tab</span><span class="p">(</span><span class="s">"Mixed Scene"</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">gr</span><span class="p">.</span><span class="n">Row</span><span class="p">():</span>
            <span class="n">music_prompt</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">"Music Prompt"</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ambient_prompt</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">"Ambient Sound Prompt"</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="n">gr</span><span class="p">.</span><span class="n">Row</span><span class="p">():</span>
            <span class="n">music_weight</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Slider</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"Music Weight"</span><span class="p">)</span>
            <span class="n">ambient_weight</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Slider</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"Ambient Weight"</span><span class="p">)</span>
            <span class="n">scene_duration</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Slider</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"Duration (seconds)"</span><span class="p">)</span>
        
        <span class="n">mix_btn</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s">"Generate Mixed Scene"</span><span class="p">)</span>
        <span class="n">mixed_output</span> <span class="o">=</span> <span class="n">gr</span><span class="p">.</span><span class="n">Audio</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">"Mixed Audio Scene"</span><span class="p">)</span>
        
        <span class="n">mix_btn</span><span class="p">.</span><span class="n">click</span><span class="p">(</span>
            <span class="n">generate_mixed_scene</span><span class="p">,</span>
            <span class="p">[</span><span class="n">music_prompt</span><span class="p">,</span> <span class="n">ambient_prompt</span><span class="p">,</span> <span class="n">music_weight</span><span class="p">,</span> <span class="n">ambient_weight</span><span class="p">,</span> <span class="n">scene_duration</span><span class="p">],</span>
            <span class="n">mixed_output</span>
        <span class="p">)</span>

<span class="c1"># Launch the app
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">demo</span><span class="p">.</span><span class="n">launch</span><span class="p">()</span>
</code></pre></div></div>

<p>To use this web interface, you’ll need to install Gradio:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>gradio
</code></pre></div></div>

<p>Then run the script to launch the web interface:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python text_to_audio_web.py
</code></pre></div></div>

<h2 id="extending-the-pipeline">Extending the Pipeline</h2>

<p>There are many ways to extend this basic text-to-audio pipeline:</p>

<h3 id="1-adding-audio-post-processing">1. Adding Audio Post-Processing</h3>

<p>You can enhance the generated audio with post-processing effects like reverb, EQ, or compression:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">apply_reverb</span><span class="p">(</span><span class="n">audio_tensor</span><span class="p">,</span> <span class="n">reverb_amount</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="s">"""Apply a simple reverb effect to an audio tensor."""</span>
    <span class="c1"># This is a simplified reverb - for production use a proper DSP library
</span>    <span class="c1"># Convert to numpy for easier manipulation
</span>    <span class="n">audio_array</span> <span class="o">=</span> <span class="n">audio_tensor</span><span class="p">.</span><span class="n">numpy</span><span class="p">()</span>
    
    <span class="c1"># Create a delayed copy of the audio (simple reverb)
</span>    <span class="n">delay_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">)</span>  <span class="c1"># 100ms delay
</span>    <span class="n">delayed</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">audio_array</span><span class="p">)</span>
    <span class="n">delayed</span><span class="p">[</span><span class="n">delay_samples</span><span class="p">:]</span> <span class="o">=</span> <span class="n">audio_array</span><span class="p">[:</span><span class="o">-</span><span class="n">delay_samples</span><span class="p">]</span>
    
    <span class="c1"># Mix with original
</span>    <span class="n">reverb_audio</span> <span class="o">=</span> <span class="n">audio_array</span> <span class="o">+</span> <span class="n">delayed</span> <span class="o">*</span> <span class="n">reverb_amount</span>
    
    <span class="c1"># Normalize
</span>    <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">reverb_audio</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">reverb_audio</span> <span class="o">=</span> <span class="n">reverb_audio</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">reverb_audio</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">reverb_audio</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-transition-between-scenes">2. Transition Between Scenes</h3>

<p>Create transitions between different audio scenes:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">crossfade</span><span class="p">(</span><span class="n">audio1</span><span class="p">,</span> <span class="n">audio2</span><span class="p">,</span> <span class="n">crossfade_duration</span><span class="o">=</span><span class="mf">3.0</span><span class="p">):</span>
    <span class="s">"""Create a crossfade between two audio tensors."""</span>
    <span class="c1"># Calculate crossfade samples
</span>    <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">sample_rate</span>
    <span class="n">fade_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">crossfade_duration</span> <span class="o">*</span> <span class="n">sample_rate</span><span class="p">)</span>
    
    <span class="c1"># Convert to numpy
</span>    <span class="n">a1</span> <span class="o">=</span> <span class="n">audio1</span><span class="p">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">audio2</span><span class="p">.</span><span class="n">numpy</span><span class="p">()</span>
    
    <span class="c1"># Calculate total length
</span>    <span class="n">total_length</span> <span class="o">=</span> <span class="n">a1</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a2</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">fade_samples</span>
    
    <span class="c1"># Create output array
</span>    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">total_length</span><span class="p">)</span>
    
    <span class="c1"># Copy first part of audio1 (before crossfade)
</span>    <span class="n">result</span><span class="p">[:</span><span class="n">a1</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">fade_samples</span><span class="p">]</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[:</span><span class="n">a1</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">fade_samples</span><span class="p">]</span>
    
    <span class="c1"># Create crossfade section
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fade_samples</span><span class="p">):</span>
        <span class="c1"># Calculate crossfade weights
</span>        <span class="n">w1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">fade_samples</span><span class="p">)</span>
        <span class="n">w2</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">fade_samples</span>
        
        <span class="c1"># Mix samples
</span>        <span class="n">idx</span> <span class="o">=</span> <span class="n">a1</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">fade_samples</span> <span class="o">+</span> <span class="n">i</span>
        <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[</span><span class="n">a1</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">fade_samples</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">w1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">w2</span>
    
    <span class="c1"># Copy remainder of audio2 (after crossfade)
</span>    <span class="n">result</span><span class="p">[</span><span class="n">a1</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:]</span> <span class="o">=</span> <span class="n">a2</span><span class="p">[</span><span class="n">fade_samples</span><span class="p">:]</span>
    
    <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">result</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-integration-with-tts-systems">3. Integration with TTS Systems</h3>

<p>Combine with text-to-speech systems for complete narratives:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_narrated_scene</span><span class="p">(</span><span class="n">narrative_text</span><span class="p">,</span> <span class="n">background_music_prompt</span><span class="p">,</span> <span class="n">ambient_sound_prompt</span><span class="p">):</span>
    <span class="s">"""Create a scene with narration, background music, and ambient sounds."""</span>
    <span class="c1"># Generate TTS narration (using a TTS system of your choice)
</span>    <span class="c1"># For example with ElevenLabs API:
</span>    <span class="n">narration_audio</span> <span class="o">=</span> <span class="n">generate_voice_elevenlabs</span><span class="p">(</span><span class="n">narrative_text</span><span class="p">)</span>
    
    <span class="c1"># Load narration from file
</span>    <span class="n">narration</span><span class="p">,</span> <span class="n">narration_sr</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">narration_audio</span><span class="p">)</span>
    <span class="n">narration</span> <span class="o">=</span> <span class="n">narration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get the first channel if stereo
</span>    
    <span class="c1"># Generate background music
</span>    <span class="n">music_audio</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">background_music_prompt</span><span class="p">,</span> <span class="s">"music"</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">15.0</span><span class="p">)</span>
    
    <span class="c1"># Generate ambient sounds
</span>    <span class="n">ambient_audio</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">ambient_sound_prompt</span><span class="p">,</span> <span class="s">"audio"</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">15.0</span><span class="p">)</span>
    
    <span class="c1"># Resample narration if needed
</span>    <span class="k">if</span> <span class="n">narration_sr</span> <span class="o">!=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">:</span>
        <span class="n">narration</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="p">.</span><span class="n">functional</span><span class="p">.</span><span class="n">resample</span><span class="p">(</span><span class="n">narration</span><span class="p">,</span> <span class="n">narration_sr</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">)</span>
    
    <span class="c1"># Mix all three elements
</span>    <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]</span>  <span class="c1"># Narration, music, ambient
</span>    <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="n">narration</span><span class="p">,</span> <span class="n">music_audio</span><span class="p">,</span> <span class="n">ambient_audio</span><span class="p">]</span>
    
    <span class="c1"># Mix and save
</span>    <span class="n">mixed_audio</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">mix_audio</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">save_audio</span><span class="p">(</span><span class="n">mixed_audio</span><span class="p">,</span> <span class="s">"narrated_scene"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="exercises">Exercises</h2>

<ol>
  <li>
    <p><strong>Dynamic Soundscape</strong>: Create a script that generates an evolving soundscape that changes over time.</p>
  </li>
  <li>
    <p><strong>Interactive Audio</strong>: Build an interactive system where generated audio responds to user input or environmental conditions.</p>
  </li>
  <li>
    <p><strong>Themed Audio Generator</strong>: Create a specialized generator for a specific theme, like horror movie sounds or nature documentaries.</p>
  </li>
  <li>
    <p><strong>Audio Loop Creator</strong>: Develop a tool that generates seamless audio loops for games or websites.</p>
  </li>
</ol>

<h2 id="next-steps">Next Steps</h2>

<p>Now that you understand the basics of text-to-audio pipeline development, you can:</p>

<ol>
  <li>Experiment with different combinations of models and parameters</li>
  <li>Integrate with other audio processing libraries for enhanced effects</li>
  <li>Explore advanced techniques like conditional generation or fine-tuning</li>
  <li>Build domain-specific audio generation applications</li>
</ol>

<h2 id="conclusion">Conclusion</h2>

<p>By combining AudioCraft’s different models, you can create a flexible text-to-audio pipeline that spans music, sound effects, and complete audio environments. This opens up exciting possibilities for creative applications, game development, multimedia production, and more.</p>

  </div>

</article>

        </div>
      </main>

      <footer class="site-footer">
        <div class="container">
          <div class="footer-col-wrapper">
            <div class="footer-col">
              <p>A hands-on guide to creating music, sound effects, and audio experiences with AI</p>
              <p>
                <a href="https://github.com/facebookresearch/audiocraft">AudioCraft GitHub Repository</a>
              </p>
            </div>
            <div class="footer-col">
              <p class="copyright">
                Copyright © 2025 Scott Friedman.<br>
                Licensed under <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a>.
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>