<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Docker Containerization for AudioCraft</title>
  <meta name="description" content="A hands-on guide to creating music, sound effects, and audio experiences with AI">
  <link rel="canonical" href="https://scttfrdmn.github.io/practical-meta-audiocraft/tutorials/deployment/docker_containerization/">
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      margin: 0;
      padding: 0;
    }
    .wrapper {
      max-width: 100%;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 0 20px;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    h1 { color: #1a73e8; }
    h2 { color: #34a853; }
    a {
      color: #1a73e8;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .site-header {
      border-bottom: 1px solid #eee;
      padding: 15px 0;
      margin-bottom: 30px;
    }
    .site-title {
      margin: 0;
      font-size: 1.8rem;
    }
    .site-title a {
      color: #1a73e8;
      text-decoration: none;
    }
    .site-nav {
      float: right;
      margin-top: 10px;
    }
    .site-nav .page-link {
      margin-left: 20px;
    }
    .nav-trigger {
      display: none;
    }
    .menu-icon {
      display: none;
    }
    .page-content {
      padding: 20px 0;
    }
    .site-footer {
      border-top: 1px solid #eee;
      padding: 30px 0;
      margin-top: 60px;
    }
    .footer-col-wrapper {
      display: flex;
      flex-wrap: wrap;
    }
    .footer-col {
      flex: 1;
      min-width: 200px;
      padding-right: 20px;
    }
    code {
      background-color: #f5f5f5;
      padding: 2px 5px;
      border-radius: 3px;
    }
    pre {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
    .highlight {
      background-color: #f5f5f5;
      border-radius: 5px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px 12px;
    }
    th {
      background-color: #f5f5f5;
      text-align: left;
    }
    button, .button {
      display: inline-block;
      background-color: #1a73e8;
      color: white !important;
      padding: 10px 20px;
      border-radius: 4px;
      font-weight: bold;
      margin-top: 20px;
      border: none;
      cursor: pointer;
      text-decoration: none !important;
    }
    button:hover, .button:hover {
      background-color: #0d65d9;
    }
    .feature {
      background-color: #f5f5f5;
      border-radius: 8px;
      padding: 20px;
      border-left: 4px solid #1a73e8;
      margin-bottom: 20px;
    }
    
    @media screen and (max-width: 600px) {
      .site-nav {
        position: absolute;
        top: 70px;
        right: 20px;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        text-align: right;
        padding: 0;
        z-index: 1;
      }
      .site-nav .page-link {
        display: block;
        padding: 10px;
        margin: 0;
      }
      .site-nav .menu-icon {
        display: block;
        float: right;
        width: 36px;
        height: 26px;
        line-height: 0;
        padding-top: 10px;
        text-align: center;
      }
      .site-nav .trigger {
        clear: both;
        display: none;
      }
      .site-nav input:checked ~ .trigger {
        display: block;
        padding-bottom: 5px;
      }
      .footer-col-wrapper {
        flex-direction: column;
      }
      .footer-col {
        margin-bottom: 20px;
      }
    }
  </style>
</head><body>
    <div class="wrapper">
      <header class="site-header">
        <div class="container">
          <h1 class="site-title"><a href="/practical-meta-audiocraft/">Practical Meta AudioCraft</a></h1>
          <nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
              <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                  <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484c0-0.82,0.665-1.485,1.484-1.485 h15.032C17.335,0,18,0.665,18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516 c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,6.031,18,6.696,18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516c0-0.82,0.665-1.483,1.484-1.483h15.032 C17.335,12.031,18,12.696,18,13.516z"/>
                </svg>
              </span>
            </label>

            <div class="trigger">
              <a class="page-link" href="/practical-meta-audiocraft/">Home</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part1/introduction/">Getting Started</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part2/basic-music/">MusicGen</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part3/introduction-to-audiogen/">AudioGen</a>
              <a class="page-link" href="/practical-meta-audiocraft/tutorials/getting-started/">Tutorials</a>
            </div>
          </nav>
        </div>
      </header>

      <main class="page-content" aria-label="Content">
        <div class="container">
          <h1 id="docker-containerization-for-audiocraft">Docker Containerization for AudioCraft</h1>

<p>This guide explains how to containerize AudioCraft applications using Docker, allowing for consistent deployment across different environments. We’ll cover creating optimized Docker images, implementing multi-container setups, and deploying to various platforms.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li>Docker installed on your system</li>
  <li>Basic understanding of Docker concepts</li>
  <li>AudioCraft API or application code ready for containerization</li>
</ul>

<h2 id="why-containerize-audiocraft">Why Containerize AudioCraft?</h2>

<p>Containerizing AudioCraft offers several advantages:</p>

<ol>
  <li><strong>Consistency</strong>: Same environment across development, testing, and production</li>
  <li><strong>Isolation</strong>: Dependencies packaged with the application</li>
  <li><strong>Portability</strong>: Run anywhere Docker is supported</li>
  <li><strong>Scalability</strong>: Easy to scale with orchestration tools like Kubernetes</li>
  <li><strong>Version Control</strong>: Track environment changes alongside code</li>
</ol>

<h2 id="basic-dockerfile-for-audiocraft">Basic Dockerfile for AudioCraft</h2>

<p>Let’s start with a basic Dockerfile for an AudioCraft application:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Base image with PyTorch and CUDA support</span>
<span class="k">FROM</span><span class="s"> pytorch/pytorch:2.1.0-cuda11.8-cudnn8-runtime</span>

<span class="c"># Set working directory</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Install system dependencies</span>
<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="se">\
</span>    ffmpeg <span class="se">\
</span>    libsndfile1 <span class="se">\
</span>    <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>

<span class="c"># Copy requirements file</span>
<span class="k">COPY</span><span class="s"> requirements.txt .</span>

<span class="c"># Install Python dependencies</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">-r</span> requirements.txt

<span class="c"># Install AudioCraft</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> audiocraft

<span class="c"># Copy application code</span>
<span class="k">COPY</span><span class="s"> . .</span>

<span class="c"># Expose the port the app runs on</span>
<span class="k">EXPOSE</span><span class="s"> 5000</span>

<span class="c"># Command to run the application</span>
<span class="k">CMD</span><span class="s"> ["gunicorn", "--bind", "0.0.0.0:5000", "app:app"]</span>
</code></pre></div></div>

<p>Create a <code class="language-plaintext highlighter-rouge">requirements.txt</code> file with your application dependencies:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>flask==2.3.3
flask-cors==4.0.0
gunicorn==21.2.0
pydub==0.25.1
soundfile==0.12.1
celery==5.3.4
redis==5.0.1
</code></pre></div></div>

<h2 id="building-the-docker-image">Building the Docker Image</h2>

<p>Build your Docker image:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> audiocraft-api <span class="nb">.</span>
</code></pre></div></div>

<p>Run the container:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-p</span> 5000:5000 audiocraft-api
</code></pre></div></div>

<h2 id="cpu-vs-gpu-dockerfiles">CPU vs. GPU Dockerfiles</h2>

<h3 id="for-cpu-only-environments">For CPU-only Environments</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Smaller base image without CUDA</span>
<span class="k">FROM</span><span class="s"> python:3.9-slim</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Install system dependencies</span>
<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="se">\
</span>    ffmpeg <span class="se">\
</span>    libsndfile1 <span class="se">\
</span>    <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>

<span class="c"># Copy requirements</span>
<span class="k">COPY</span><span class="s"> requirements.txt .</span>

<span class="c"># Install dependencies and AudioCraft</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">-r</span> requirements.txt
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="s2">"torch&gt;=2.1.0"</span> <span class="s2">"torchaudio&gt;=2.1.0"</span> <span class="nt">--index-url</span> https://download.pytorch.org/whl/cpu
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> audiocraft

<span class="c"># Copy application code</span>
<span class="k">COPY</span><span class="s"> . .</span>

<span class="c"># Set environment variables for CPU optimization</span>
<span class="k">ENV</span><span class="s"> OMP_NUM_THREADS=4</span>
<span class="k">ENV</span><span class="s"> MKL_NUM_THREADS=4</span>

<span class="k">EXPOSE</span><span class="s"> 5000</span>

<span class="k">CMD</span><span class="s"> ["gunicorn", "--bind", "0.0.0.0:5000", "--workers", "2", "app:app"]</span>
</code></pre></div></div>

<h3 id="for-gpu-environments">For GPU Environments</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> nvidia/cuda:11.8.0-cudnn8-runtime-ubuntu22.04</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Install Python and dependencies</span>
<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="se">\
</span>    python3.9 <span class="se">\
</span>    python3-pip <span class="se">\
</span>    python3-dev <span class="se">\
</span>    ffmpeg <span class="se">\
</span>    libsndfile1 <span class="se">\
</span>    <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>

<span class="c"># Set Python aliases</span>
<span class="k">RUN </span><span class="nb">ln</span> <span class="nt">-sf</span> /usr/bin/python3.9 /usr/bin/python <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">ln</span> <span class="nt">-sf</span> /usr/bin/pip3 /usr/bin/pip

<span class="c"># Copy requirements</span>
<span class="k">COPY</span><span class="s"> requirements.txt .</span>

<span class="c"># Install dependencies and AudioCraft</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">-r</span> requirements.txt
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nv">torch</span><span class="o">==</span>2.1.0 <span class="nv">torchaudio</span><span class="o">==</span>2.1.0 <span class="nt">--index-url</span> https://download.pytorch.org/whl/cu118
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> audiocraft

<span class="c"># Copy application code</span>
<span class="k">COPY</span><span class="s"> . .</span>

<span class="k">EXPOSE</span><span class="s"> 5000</span>

<span class="k">CMD</span><span class="s"> ["gunicorn", "--bind", "0.0.0.0:5000", "--workers", "2", "app:app"]</span>
</code></pre></div></div>

<p>To run the GPU container, you’ll need to use NVIDIA’s Container Toolkit:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--gpus</span> all <span class="nt">-p</span> 5000:5000 audiocraft-api-gpu
</code></pre></div></div>

<h2 id="multi-container-setup-with-docker-compose">Multi-Container Setup with Docker Compose</h2>

<p>For a complete application with Redis for task queuing and a separate worker container:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.yml</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># API server</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5000:5000"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">REDIS_URL=redis://redis:6379/0</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./generated_audio:/app/generated_audio</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Celery worker for background processing</span>
  <span class="na">worker</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.worker</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">REDIS_URL=redis://redis:6379/0</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./generated_audio:/app/generated_audio</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">celery -A tasks worker --loglevel=info</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">devices</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
              <span class="na">count</span><span class="pi">:</span> <span class="m">1</span>
              <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">gpu</span><span class="pi">]</span>

  <span class="c1"># Redis for task queue and caching</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7-alpine</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">6379:6379"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis-data:/data</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">redis-data</span><span class="pi">:</span>
</code></pre></div></div>

<p>Create a separate Dockerfile for the worker:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Dockerfile.worker</span>
<span class="k">FROM</span><span class="s"> nvidia/cuda:11.8.0-cudnn8-runtime-ubuntu22.04</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Install Python and dependencies</span>
<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="se">\
</span>    python3.9 <span class="se">\
</span>    python3-pip <span class="se">\
</span>    python3-dev <span class="se">\
</span>    ffmpeg <span class="se">\
</span>    libsndfile1 <span class="se">\
</span>    <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>

<span class="c"># Set Python aliases</span>
<span class="k">RUN </span><span class="nb">ln</span> <span class="nt">-sf</span> /usr/bin/python3.9 /usr/bin/python <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">ln</span> <span class="nt">-sf</span> /usr/bin/pip3 /usr/bin/pip

<span class="c"># Copy requirements</span>
<span class="k">COPY</span><span class="s"> requirements.txt .</span>

<span class="c"># Install dependencies and AudioCraft</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">-r</span> requirements.txt
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nv">torch</span><span class="o">==</span>2.1.0 <span class="nv">torchaudio</span><span class="o">==</span>2.1.0 <span class="nt">--index-url</span> https://download.pytorch.org/whl/cu118
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> audiocraft

<span class="c"># Copy application code</span>
<span class="k">COPY</span><span class="s"> . .</span>

<span class="c"># Default command is set in docker-compose.yml</span>
</code></pre></div></div>

<p>Start the multi-container setup:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up <span class="nt">-d</span>
</code></pre></div></div>

<h2 id="optimizing-docker-images">Optimizing Docker Images</h2>

<h3 id="multi-stage-builds">Multi-stage Builds</h3>

<p>For smaller images, use multi-stage builds:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Build stage</span>
<span class="k">FROM</span><span class="s"> python:3.9 AS builder</span>

<span class="k">WORKDIR</span><span class="s"> /build</span>

<span class="k">COPY</span><span class="s"> requirements.txt .</span>

<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">--prefix</span><span class="o">=</span>/install <span class="nt">-r</span> requirements.txt
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">--prefix</span><span class="o">=</span>/install audiocraft

<span class="c"># Runtime stage</span>
<span class="k">FROM</span><span class="s"> python:3.9-slim</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Install runtime dependencies</span>
<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="se">\
</span>    ffmpeg <span class="se">\
</span>    libsndfile1 <span class="se">\
</span>    <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>

<span class="c"># Copy installed Python packages from builder</span>
<span class="k">COPY</span><span class="s"> --from=builder /install /usr/local</span>

<span class="c"># Copy application code</span>
<span class="k">COPY</span><span class="s"> . .</span>

<span class="k">EXPOSE</span><span class="s"> 5000</span>

<span class="k">CMD</span><span class="s"> ["gunicorn", "--bind", "0.0.0.0:5000", "app:app"]</span>
</code></pre></div></div>

<h3 id="layer-caching-optimization">Layer Caching Optimization</h3>

<p>Organize your Dockerfile to take advantage of layer caching:</p>

<ol>
  <li>Install dependencies that change less frequently first</li>
  <li>Copy application code last (since it changes most frequently)</li>
  <li>Use <code class="language-plaintext highlighter-rouge">.dockerignore</code> to exclude unnecessary files</li>
</ol>

<p>Example <code class="language-plaintext highlighter-rouge">.dockerignore</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.git
__pycache__
*.pyc
*.pyo
*.pyd
.Python
env/
venv/
.vscode/
.idea/
generated_audio/
*.wav
*.mp3
*.ogg
node_modules/
</code></pre></div></div>

<h2 id="model-management-strategies">Model Management Strategies</h2>

<h3 id="pre-downloading-models">Pre-downloading Models</h3>

<p>For faster container startup, pre-download models during build:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># After installing AudioCraft</span>
<span class="k">RUN </span>python <span class="nt">-c</span> <span class="s2">"from audiocraft.models import MusicGen; MusicGen.get_pretrained('small')"</span>
</code></pre></div></div>

<h3 id="external-volume-for-models">External Volume for Models</h3>

<p>Use a Docker volume to persist models between container restarts:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># In docker-compose.yml</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="c1"># ... other config</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./generated_audio:/app/generated_audio</span>
      <span class="pi">-</span> <span class="s">model-cache:/root/.cache/torch/hub</span>
      
<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">model-cache</span><span class="pi">:</span>
</code></pre></div></div>

<h2 id="deployment-examples">Deployment Examples</h2>

<h3 id="aws-elastic-container-service-ecs">AWS Elastic Container Service (ECS)</h3>

<ol>
  <li>Build and push your Docker image to Amazon ECR:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create ECR repository</span>
aws ecr create-repository <span class="nt">--repository-name</span> audiocraft-api

<span class="c"># Log in to ECR</span>
aws ecr get-login-password | docker login <span class="nt">--username</span> AWS <span class="nt">--password-stdin</span> your-account-id.dkr.ecr.region.amazonaws.com

<span class="c"># Tag and push the image</span>
docker tag audiocraft-api your-account-id.dkr.ecr.region.amazonaws.com/audiocraft-api:latest
docker push your-account-id.dkr.ecr.region.amazonaws.com/audiocraft-api:latest
</code></pre></div></div>

<ol>
  <li>Create an ECS task definition:</li>
</ol>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"family"</span><span class="p">:</span><span class="w"> </span><span class="s2">"audiocraft-api"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"networkMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"awsvpc"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"executionRoleArn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::your-account-id:role/ecsTaskExecutionRole"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"containerDefinitions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"audiocraft-api"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"your-account-id.dkr.ecr.region.amazonaws.com/audiocraft-api:latest"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"essential"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"portMappings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"containerPort"</span><span class="p">:</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span><span class="w">
          </span><span class="nl">"hostPort"</span><span class="p">:</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span><span class="w">
          </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tcp"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"logConfiguration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"logDriver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"awslogs"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"awslogs-group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/ecs/audiocraft-api"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"awslogs-region"</span><span class="p">:</span><span class="w"> </span><span class="s2">"region"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"awslogs-stream-prefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ecs"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"memory"</span><span class="p">:</span><span class="w"> </span><span class="mi">8192</span><span class="p">,</span><span class="w">
      </span><span class="nl">"cpu"</span><span class="p">:</span><span class="w"> </span><span class="mi">2048</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"requiresCompatibilities"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"FARGATE"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"cpu"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2048"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"memory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8192"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ol>
  <li>Create a service in your ECS cluster to run the task.</li>
</ol>

<h3 id="google-cloud-run">Google Cloud Run</h3>

<ol>
  <li>Build and push your Docker image to Google Container Registry:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Build the image</span>
docker build <span class="nt">-t</span> gcr.io/your-project-id/audiocraft-api <span class="nb">.</span>

<span class="c"># Push to GCR</span>
docker push gcr.io/your-project-id/audiocraft-api
</code></pre></div></div>

<ol>
  <li>Deploy to Cloud Run:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcloud run deploy audiocraft-api <span class="se">\</span>
  <span class="nt">--image</span> gcr.io/your-project-id/audiocraft-api <span class="se">\</span>
  <span class="nt">--platform</span> managed <span class="se">\</span>
  <span class="nt">--region</span> us-central1 <span class="se">\</span>
  <span class="nt">--memory</span> 8Gi <span class="se">\</span>
  <span class="nt">--cpu</span> 4 <span class="se">\</span>
  <span class="nt">--port</span> 5000
</code></pre></div></div>

<h3 id="kubernetes-deployment">Kubernetes Deployment</h3>

<ol>
  <li>Create a Kubernetes deployment file:</li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># audiocraft-deployment.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">audiocraft-api</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">audiocraft-api</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">audiocraft-api</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">audiocraft-api</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">your-registry/audiocraft-api:latest</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">5000</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">requests</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4Gi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2"</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">8Gi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4"</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">model-cache</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/root/.cache/torch/hub</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">model-cache</span>
        <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
          <span class="na">claimName</span><span class="pi">:</span> <span class="s">model-cache-pvc</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">audiocraft-api</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">audiocraft-api</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">5000</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>
</code></pre></div></div>

<ol>
  <li>Apply the deployment:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> audiocraft-deployment.yaml
</code></pre></div></div>

<h2 id="production-considerations">Production Considerations</h2>

<h3 id="health-checks">Health Checks</h3>

<p>Add a health check endpoint to your API:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/health"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"GET"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">health_check</span><span class="p">():</span>
    <span class="s">"""API health check endpoint."""</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s">"status"</span><span class="p">:</span> <span class="s">"healthy"</span><span class="p">,</span>
        <span class="s">"version"</span><span class="p">:</span> <span class="s">"1.0.0"</span><span class="p">,</span>
        <span class="s">"models_loaded"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="p">})</span>
</code></pre></div></div>

<p>Configure health checks in your Docker Compose file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="c1"># ... other config</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:5000/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">40s</span>
</code></pre></div></div>

<h3 id="resource-allocation">Resource Allocation</h3>

<p>Properly allocate resources based on model size:</p>

<table>
  <thead>
    <tr>
      <th>Model Size</th>
      <th>Minimum Memory</th>
      <th>Recommended CPU</th>
      <th>GPU Memory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>small</td>
      <td>4GB</td>
      <td>2 cores</td>
      <td>2GB</td>
    </tr>
    <tr>
      <td>medium</td>
      <td>8GB</td>
      <td>4 cores</td>
      <td>4GB</td>
    </tr>
    <tr>
      <td>large</td>
      <td>16GB</td>
      <td>8 cores</td>
      <td>8GB</td>
    </tr>
  </tbody>
</table>

<h3 id="logging-and-monitoring">Logging and Monitoring</h3>

<p>Implement structured logging in your application:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># Configure structured logging
</span><span class="k">class</span> <span class="nc">JSONFormatter</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">log_record</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"timestamp"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">formatTime</span><span class="p">(</span><span class="n">record</span><span class="p">),</span>
            <span class="s">"level"</span><span class="p">:</span> <span class="n">record</span><span class="p">.</span><span class="n">levelname</span><span class="p">,</span>
            <span class="s">"message"</span><span class="p">:</span> <span class="n">record</span><span class="p">.</span><span class="n">getMessage</span><span class="p">(),</span>
            <span class="s">"module"</span><span class="p">:</span> <span class="n">record</span><span class="p">.</span><span class="n">module</span><span class="p">,</span>
            <span class="s">"function"</span><span class="p">:</span> <span class="n">record</span><span class="p">.</span><span class="n">funcName</span><span class="p">,</span>
            <span class="s">"line"</span><span class="p">:</span> <span class="n">record</span><span class="p">.</span><span class="n">lineno</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s">'request_id'</span><span class="p">):</span>
            <span class="n">log_record</span><span class="p">[</span><span class="s">'request_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">record</span><span class="p">.</span><span class="n">request_id</span>
        <span class="k">if</span> <span class="n">record</span><span class="p">.</span><span class="n">exc_info</span><span class="p">:</span>
            <span class="n">log_record</span><span class="p">[</span><span class="s">'exception'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">formatException</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">exc_info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">log_record</span><span class="p">)</span>

<span class="c1"># Set up logger
</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">"audiocraft-api"</span><span class="p">)</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">StreamHandler</span><span class="p">()</span>
<span class="n">handler</span><span class="p">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">JSONFormatter</span><span class="p">())</span>
<span class="n">logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
<span class="n">logger</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1"># Usage
</span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Generated audio"</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
    <span class="s">"request_id"</span><span class="p">:</span> <span class="n">request_id</span><span class="p">,</span>
    <span class="s">"prompt"</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span>
    <span class="s">"model_size"</span><span class="p">:</span> <span class="n">model_size</span><span class="p">,</span>
    <span class="s">"generation_time"</span><span class="p">:</span> <span class="n">generation_time</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Direct logs to stdout/stderr in your container:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># In your Dockerfile</span>
<span class="k">ENV</span><span class="s"> PYTHONUNBUFFERED=1</span>
</code></pre></div></div>

<h2 id="example-complete-docker-compose-setup-with-monitoring">Example: Complete Docker Compose Setup with Monitoring</h2>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># API server</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5000:5000"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">REDIS_URL=redis://redis:6379/0</span>
      <span class="pi">-</span> <span class="s">LOG_LEVEL=INFO</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./generated_audio:/app/generated_audio</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:5000/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
    <span class="na">logging</span><span class="pi">:</span>
      <span class="na">driver</span><span class="pi">:</span> <span class="s2">"</span><span class="s">json-file"</span>
      <span class="na">options</span><span class="pi">:</span>
        <span class="na">max-size</span><span class="pi">:</span> <span class="s2">"</span><span class="s">100m"</span>
        <span class="na">max-file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>

  <span class="c1"># Celery worker for background processing</span>
  <span class="na">worker</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.worker</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">REDIS_URL=redis://redis:6379/0</span>
      <span class="pi">-</span> <span class="s">LOG_LEVEL=INFO</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./generated_audio:/app/generated_audio</span>
      <span class="pi">-</span> <span class="s">model-cache:/root/.cache/torch/hub</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">celery -A tasks worker --loglevel=info</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">devices</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
              <span class="na">count</span><span class="pi">:</span> <span class="m">1</span>
              <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">gpu</span><span class="pi">]</span>
    <span class="na">logging</span><span class="pi">:</span>
      <span class="na">driver</span><span class="pi">:</span> <span class="s2">"</span><span class="s">json-file"</span>
      <span class="na">options</span><span class="pi">:</span>
        <span class="na">max-size</span><span class="pi">:</span> <span class="s2">"</span><span class="s">100m"</span>
        <span class="na">max-file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>

  <span class="c1"># Redis for task queue and caching</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7-alpine</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">6379:6379"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis-data:/data</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Prometheus for metrics collection</span>
  <span class="na">prometheus</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">prom/prometheus</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9090:9090"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./prometheus.yml:/etc/prometheus/prometheus.yml</span>
      <span class="pi">-</span> <span class="s">prometheus-data:/prometheus</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Grafana for visualization</span>
  <span class="na">grafana</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">grafana/grafana</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">grafana-data:/var/lib/grafana</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">GF_SECURITY_ADMIN_PASSWORD=secret</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">redis-data</span><span class="pi">:</span>
  <span class="na">model-cache</span><span class="pi">:</span>
  <span class="na">prometheus-data</span><span class="pi">:</span>
  <span class="na">grafana-data</span><span class="pi">:</span>
</code></pre></div></div>

<p>Create a <code class="language-plaintext highlighter-rouge">prometheus.yml</code> configuration file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">global</span><span class="pi">:</span>
  <span class="na">scrape_interval</span><span class="pi">:</span> <span class="s">15s</span>

<span class="na">scrape_configs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">audiocraft-api'</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">api:5000'</span><span class="pi">]</span>
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>This guide has covered the essentials of containerizing AudioCraft applications using Docker. By following these practices, you can create portable, scalable, and maintainable deployments for your audio generation services.</p>

<p>Remember that ML model serving has unique requirements compared to traditional web applications:</p>

<ol>
  <li><strong>Resource Intensive</strong>: Properly allocate memory and CPU/GPU resources</li>
  <li><strong>Cold Starts</strong>: Consider model preloading strategies</li>
  <li><strong>Scaling</strong>: ML workloads often benefit from vertical scaling (larger machines)</li>
  <li><strong>Persistence</strong>: Use volumes for model caching and generated content</li>
</ol>

<p>For additional optimization techniques, see the <a href="performance_tuning.md">Performance Tuning</a> guide.</p>

<h2 id="next-steps">Next Steps</h2>

<ul>
  <li>Implement <a href="api_security.md">API Security</a> for your containerized application</li>
  <li>Learn how to set up <a href="monitoring_logging.md">Monitoring and Logging</a> for production</li>
  <li>Explore <a href="scaling_strategies.md">Scaling Strategies</a> for high-traffic deployments</li>
</ul>

        </div>
      </main>

      <footer class="site-footer">
        <div class="container">
          <div class="footer-col-wrapper">
            <div class="footer-col">
              <p>A hands-on guide to creating music, sound effects, and audio experiences with AI</p>
              <p>
                <a href="https://github.com/facebookresearch/audiocraft">AudioCraft GitHub Repository</a>
              </p>
            </div>
            <div class="footer-col">
              <p class="copyright">
                Copyright © 2025 Scott Friedman.<br>
                Licensed under <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a>.
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>