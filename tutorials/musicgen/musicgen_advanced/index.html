<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Advanced MusicGen Techniques</title>
  <meta name="description" content="A hands-on guide to creating music, sound effects, and audio experiences with AI">
  <link rel="canonical" href="https://scttfrdmn.github.io/practical-meta-audiocraft/tutorials/musicgen/musicgen_advanced/">
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      margin: 0;
      padding: 0;
    }
    .wrapper {
      max-width: 100%;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 0 20px;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    h1 { color: #1a73e8; }
    h2 { color: #34a853; }
    a {
      color: #1a73e8;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .site-header {
      border-bottom: 1px solid #eee;
      padding: 15px 0;
      margin-bottom: 30px;
    }
    .site-title {
      margin: 0;
      font-size: 1.8rem;
    }
    .site-title a {
      color: #1a73e8;
      text-decoration: none;
    }
    .site-nav {
      float: right;
      margin-top: 10px;
    }
    .site-nav .page-link {
      margin-left: 20px;
    }
    .nav-trigger {
      display: none;
    }
    .menu-icon {
      display: none;
    }
    .page-content {
      padding: 20px 0;
    }
    .site-footer {
      border-top: 1px solid #eee;
      padding: 30px 0;
      margin-top: 60px;
    }
    .footer-col-wrapper {
      display: flex;
      flex-wrap: wrap;
    }
    .footer-col {
      flex: 1;
      min-width: 200px;
      padding-right: 20px;
    }
    code {
      background-color: #f5f5f5;
      padding: 2px 5px;
      border-radius: 3px;
    }
    pre {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
    .highlight {
      background-color: #f5f5f5;
      border-radius: 5px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px 12px;
    }
    th {
      background-color: #f5f5f5;
      text-align: left;
    }
    button, .button {
      display: inline-block;
      background-color: #1a73e8;
      color: white !important;
      padding: 10px 20px;
      border-radius: 4px;
      font-weight: bold;
      margin-top: 20px;
      border: none;
      cursor: pointer;
      text-decoration: none !important;
    }
    button:hover, .button:hover {
      background-color: #0d65d9;
    }
    .feature {
      background-color: #f5f5f5;
      border-radius: 8px;
      padding: 20px;
      border-left: 4px solid #1a73e8;
      margin-bottom: 20px;
    }
    
    @media screen and (max-width: 600px) {
      .site-nav {
        position: absolute;
        top: 70px;
        right: 20px;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        text-align: right;
        padding: 0;
        z-index: 1;
      }
      .site-nav .page-link {
        display: block;
        padding: 10px;
        margin: 0;
      }
      .site-nav .menu-icon {
        display: block;
        float: right;
        width: 36px;
        height: 26px;
        line-height: 0;
        padding-top: 10px;
        text-align: center;
      }
      .site-nav .trigger {
        clear: both;
        display: none;
      }
      .site-nav input:checked ~ .trigger {
        display: block;
        padding-bottom: 5px;
      }
      .footer-col-wrapper {
        flex-direction: column;
      }
      .footer-col {
        margin-bottom: 20px;
      }
    }
  </style>
</head><body>
    <div class="wrapper">
      <header class="site-header">
        <div class="container">
          <h1 class="site-title"><a href="/practical-meta-audiocraft/">Practical Meta AudioCraft</a></h1>
          <nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
              <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                  <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484c0-0.82,0.665-1.485,1.484-1.485 h15.032C17.335,0,18,0.665,18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516 c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,6.031,18,6.696,18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516c0-0.82,0.665-1.483,1.484-1.483h15.032 C17.335,12.031,18,12.696,18,13.516z"/>
                </svg>
              </span>
            </label>

            <div class="trigger">
              <a class="page-link" href="/practical-meta-audiocraft/">Home</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part1/introduction/">Getting Started</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part2/basic-music/">MusicGen</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part3/introduction-to-audiogen/">AudioGen</a>
              <a class="page-link" href="/practical-meta-audiocraft/tutorials/getting-started/">Tutorials</a>
            </div>
          </nav>
        </div>
      </header>

      <main class="page-content" aria-label="Content">
        <div class="container">
          <article class="post">

  <header class="post-header">
    <h1 class="post-title">Advanced MusicGen Techniques</h1>
  </header>

  <div class="post-content">
    <h1 id="advanced-musicgen-techniques">Advanced MusicGen Techniques</h1>

<p>This tutorial explores advanced techniques for music generation with MusicGen, including melody conditioning, extended generation, and fine-grained control of the generation process.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>Before proceeding with this tutorial, you should:</p>
<ul>
  <li>Have completed the <a href="/practical-meta-audiocraft/tutorials/musicgen/musicgen_basics/">Basic MusicGen Tutorial</a></li>
  <li>Be familiar with PyTorch and audio processing concepts</li>
  <li>Have sufficient GPU resources (at least 4GB VRAM recommended)</li>
</ul>

<h2 id="melody-conditioning">Melody Conditioning</h2>

<p>One of MusicGen’s most powerful features is the ability to condition the generation on a reference melody. This allows you to provide a melodic structure that the model will follow while generating the rest of the music.</p>

<h3 id="how-melody-conditioning-works">How Melody Conditioning Works</h3>

<p>MusicGen uses a chroma representation of the reference audio to extract melodic information. The chroma features capture the prominence of each pitch class (C, C#, D, etc.) over time, providing the model with melodic guidance while allowing it to generate complementary elements like harmony, rhythm, and instrumentation.</p>

<h3 id="basic-melody-conditioning-example">Basic Melody Conditioning Example</h3>

<p>Here’s a simple example of melody conditioning:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># melody_conditioning_basic.py
</span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchaudio</span>
<span class="kn">from</span> <span class="nn">audiocraft.models</span> <span class="kn">import</span> <span class="n">MusicGen</span>
<span class="kn">from</span> <span class="nn">audiocraft.data.audio</span> <span class="kn">import</span> <span class="n">audio_write</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">generate_with_melody</span><span class="p">(</span>
    <span class="n">text_prompt</span><span class="p">,</span>
    <span class="n">melody_path</span><span class="p">,</span>
    <span class="n">output_path</span><span class="o">=</span><span class="s">"melody_output"</span><span class="p">,</span>
    <span class="n">duration</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">model_size</span><span class="o">=</span><span class="s">"medium"</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span>
<span class="p">):</span>
    <span class="s">"""
    Generate music conditioned on both text and melody.
    
    Args:
        text_prompt (str): Text description of the music to generate
        melody_path (str): Path to the melody audio file
        output_path (str): Directory to save output files
        duration (float): Length of audio in seconds
        model_size (str): Size of model to use
        temperature (float): Controls randomness (higher = more random)
    """</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Determine device
</span>    <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">backends</span><span class="p">.</span><span class="n">mps</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"mps"</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Using MPS (Metal) for generation"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cuda"</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Using CUDA for generation"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cpu"</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Using CPU for generation (this will be slow)"</span><span class="p">)</span>
    
    <span class="c1"># Load the model
</span>    <span class="n">model</span> <span class="o">=</span> <span class="n">MusicGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="n">model_size</span><span class="p">)</span>
    <span class="n">model</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    
    <span class="c1"># Set generation parameters
</span>    <span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span>
        <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">top_k</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
        <span class="n">top_p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># Load the melody file
</span>    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Loading melody from: </span><span class="si">{</span><span class="n">melody_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">melody_waveform</span><span class="p">,</span> <span class="n">melody_sample_rate</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">melody_path</span><span class="p">)</span>
    
    <span class="c1"># Ensure the melody is mono (if it's stereo, take the first channel)
</span>    <span class="k">if</span> <span class="n">melody_waveform</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">melody_waveform</span> <span class="o">=</span> <span class="n">melody_waveform</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Generate with text and melody conditioning
</span>    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating with text prompt: '</span><span class="si">{</span><span class="n">text_prompt</span><span class="si">}</span><span class="s">'"</span><span class="p">)</span>
    <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate_with_chroma</span><span class="p">(</span>
        <span class="n">descriptions</span><span class="o">=</span><span class="p">[</span><span class="n">text_prompt</span><span class="p">],</span>
        <span class="n">melody_wavs</span><span class="o">=</span><span class="n">melody_waveform</span><span class="p">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>  <span class="c1"># Add batch dimension
</span>        <span class="n">melody_sample_rate</span><span class="o">=</span><span class="n">melody_sample_rate</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># Save the generated audio
</span>    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"melody_conditioned_</span><span class="si">{</span><span class="n">model_size</span><span class="si">}</span><span class="s">"</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">audio_write</span><span class="p">(</span>
        <span class="n">output_file</span><span class="p">,</span>
        <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">(),</span>
        <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
        <span class="n">strategy</span><span class="o">=</span><span class="s">"loudness"</span>
    <span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generated audio saved to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s">.wav"</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s">.wav"</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="c1"># Example usage
</span>    <span class="n">text_prompt</span> <span class="o">=</span> <span class="s">"An orchestral arrangement with strings, brass, and woodwinds"</span>
    <span class="n">melody_path</span> <span class="o">=</span> <span class="s">"path/to/your/melody.mp3"</span>  <span class="c1"># Replace with a real melody file path
</span>    
    <span class="n">generate_with_melody</span><span class="p">(</span>
        <span class="n">text_prompt</span><span class="o">=</span><span class="n">text_prompt</span><span class="p">,</span>
        <span class="n">melody_path</span><span class="o">=</span><span class="n">melody_path</span><span class="p">,</span>
        <span class="n">duration</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
        <span class="n">model_size</span><span class="o">=</span><span class="s">"medium"</span>
    <span class="p">)</span>
</code></pre></div></div>

<h3 id="tips-for-effective-melody-conditioning">Tips for Effective Melody Conditioning</h3>

<ol>
  <li><strong>Choose Clear Melodies</strong>: Reference audio with a distinct, audible melody works best.</li>
  <li><strong>Shorter Durations</strong>: Start with shorter melody segments (5-10 seconds) for more predictable results.</li>
  <li><strong>Complementary Prompts</strong>: Make your text prompt complement the melody, describing instrumentation and style.</li>
  <li><strong>Match Genres</strong>: For best results, use text prompts that match the genre of your melody.</li>
  <li><strong>Clean References</strong>: Use clean, high-quality reference audio without background noise.</li>
</ol>

<h3 id="advanced-options-for-melody-conditioning">Advanced Options for Melody Conditioning</h3>

<p>MusicGen provides additional parameters for fine-tuning the melody conditioning:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Melody conditioning with fine-tuning
</span><span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate_with_chroma</span><span class="p">(</span>
    <span class="n">descriptions</span><span class="o">=</span><span class="p">[</span><span class="n">text_prompt</span><span class="p">],</span>
    <span class="n">melody_wavs</span><span class="o">=</span><span class="n">melody_waveform</span><span class="p">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">melody_sample_rate</span><span class="o">=</span><span class="n">melody_sample_rate</span><span class="p">,</span>
    <span class="n">chroma_coefficient</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># Controls how strictly to follow the melody (0.0-1.0)
</span>    <span class="n">progress</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>           <span class="c1"># Show progress bar
</span><span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">chroma_coefficient</code> parameter controls how closely the generated music follows the reference melody. Higher values (closer to 1.0) enforce stricter adherence to the melody, while lower values allow more creative freedom.</p>

<h2 id="extended-generation-techniques">Extended Generation Techniques</h2>

<p>MusicGen officially supports generating up to 30 seconds of audio. For longer pieces, we need to employ extended generation techniques.</p>

<h3 id="continuation-generation">Continuation Generation</h3>

<p>One approach for creating longer pieces is to generate music in segments, where each new segment continues from the previous one:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># extended_generation.py
</span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchaudio</span>
<span class="kn">from</span> <span class="nn">audiocraft.models</span> <span class="kn">import</span> <span class="n">MusicGen</span>
<span class="kn">from</span> <span class="nn">audiocraft.data.audio</span> <span class="kn">import</span> <span class="n">audio_write</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">def</span> <span class="nf">generate_extended_music</span><span class="p">(</span>
    <span class="n">prompt</span><span class="p">,</span>
    <span class="n">total_duration</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
    <span class="n">segment_duration</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
    <span class="n">output_path</span><span class="o">=</span><span class="s">"extended_output"</span><span class="p">,</span>
    <span class="n">model_size</span><span class="o">=</span><span class="s">"medium"</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">crossfade_duration</span><span class="o">=</span><span class="mf">2.0</span>
<span class="p">):</span>
    <span class="s">"""
    Generate an extended music piece by creating and concatenating multiple segments.
    
    Args:
        prompt (str): Text description of the music to generate
        total_duration (float): Total desired duration in seconds
        segment_duration (float): Duration of each segment in seconds
        output_path (str): Directory to save output files
        model_size (str): Size of model to use
        temperature (float): Controls randomness (higher = more random)
        crossfade_duration (float): Duration of crossfade between segments
    """</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Determine device
</span>    <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">backends</span><span class="p">.</span><span class="n">mps</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"mps"</span>
    <span class="k">elif</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cuda"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cpu"</span>
    
    <span class="c1"># Load the model
</span>    <span class="n">model</span> <span class="o">=</span> <span class="n">MusicGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="n">model_size</span><span class="p">)</span>
    <span class="n">model</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    
    <span class="c1"># Set generation parameters
</span>    <span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span>
        <span class="n">duration</span><span class="o">=</span><span class="n">segment_duration</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">top_k</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
        <span class="n">top_p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># Calculate number of segments needed
</span>    <span class="n">num_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">total_duration</span> <span class="o">/</span> <span class="n">segment_duration</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating </span><span class="si">{</span><span class="n">num_segments</span><span class="si">}</span><span class="s"> segments for a total of approximately </span><span class="si">{</span><span class="n">total_duration</span><span class="si">}</span><span class="s"> seconds"</span><span class="p">)</span>
    
    <span class="c1"># Generate the first segment
</span>    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating segment 1/</span><span class="si">{</span><span class="n">num_segments</span><span class="si">}</span><span class="s"> with prompt: '</span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s">'"</span><span class="p">)</span>
    <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">([</span><span class="n">prompt</span><span class="p">])</span>
    
    <span class="c1"># Convert to numpy for easier manipulation
</span>    <span class="n">all_audio</span> <span class="o">=</span> <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">().</span><span class="n">numpy</span><span class="p">()</span>
    
    <span class="c1"># Save the first segment
</span>    <span class="n">audio_write</span><span class="p">(</span>
        <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s">"segment_1"</span><span class="p">),</span>
        <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">(),</span>
        <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
        <span class="n">strategy</span><span class="o">=</span><span class="s">"loudness"</span>
    <span class="p">)</span>
    
    <span class="c1"># Generate subsequent segments with continuation
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_segments</span><span class="p">):</span>
        <span class="c1"># Get the end of the previous segment to use as a prompt
</span>        <span class="n">continuation_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">5.0</span> <span class="o">*</span> <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">)</span>  <span class="c1"># Use last 5 seconds as conditioning
</span>        <span class="n">audio_prompt</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">all_audio</span><span class="p">[</span><span class="o">-</span><span class="n">continuation_samples</span><span class="p">:]).</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating segment </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">num_segments</span><span class="si">}</span><span class="s"> (continuation)"</span><span class="p">)</span>
        
        <span class="c1"># Generate continuation
</span>        <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate_continuation</span><span class="p">(</span>
            <span class="n">prompt_or_tokens</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>  <span class="c1"># No text prompt for continuation
</span>            <span class="n">prompt_sample</span><span class="o">=</span><span class="n">audio_prompt</span><span class="p">,</span>
            <span class="n">prompt_sample_rate</span><span class="o">=</span><span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="n">segment_audio</span> <span class="o">=</span> <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">().</span><span class="n">numpy</span><span class="p">()</span>
        
        <span class="c1"># Save individual segment
</span>        <span class="n">audio_write</span><span class="p">(</span>
            <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="sa">f</span><span class="s">"segment_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">"</span><span class="p">),</span>
            <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">(),</span>
            <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
            <span class="n">strategy</span><span class="o">=</span><span class="s">"loudness"</span>
        <span class="p">)</span>
        
        <span class="c1"># Apply crossfade between segments
</span>        <span class="n">crossfade_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">crossfade_duration</span> <span class="o">*</span> <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">)</span>
        
        <span class="c1"># Create crossfade weights
</span>        <span class="n">fade_out</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">crossfade_samples</span><span class="p">)</span>
        <span class="n">fade_in</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">crossfade_samples</span><span class="p">)</span>
        
        <span class="c1"># Apply crossfade
</span>        <span class="n">all_audio</span><span class="p">[</span><span class="o">-</span><span class="n">crossfade_samples</span><span class="p">:]</span> <span class="o">=</span> <span class="n">all_audio</span><span class="p">[</span><span class="o">-</span><span class="n">crossfade_samples</span><span class="p">:]</span> <span class="o">*</span> <span class="n">fade_out</span> <span class="o">+</span> <span class="n">segment_audio</span><span class="p">[:</span><span class="n">crossfade_samples</span><span class="p">]</span> <span class="o">*</span> <span class="n">fade_in</span>
        
        <span class="c1"># Append the new segment (excluding the crossfaded part)
</span>        <span class="n">all_audio</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">all_audio</span><span class="p">,</span> <span class="n">segment_audio</span><span class="p">[</span><span class="n">crossfade_samples</span><span class="p">:]])</span>
    
    <span class="c1"># Convert final audio back to tensor
</span>    <span class="n">final_audio</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">all_audio</span><span class="p">)</span>
    
    <span class="c1"># Save the complete extended audio
</span>    <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="sa">f</span><span class="s">"extended_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">total_duration</span><span class="p">)</span><span class="si">}</span><span class="s">s"</span><span class="p">)</span>
    <span class="n">torchaudio</span><span class="p">.</span><span class="n">save</span><span class="p">(</span>
        <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s">.wav"</span><span class="p">,</span>
        <span class="n">final_audio</span><span class="p">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>  <span class="c1"># Add channel dimension
</span>        <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Extended audio generation complete. Total duration: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_audio</span><span class="p">)</span> <span class="o">/</span> <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Final audio saved to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s">.wav"</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s">.wav"</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="c1"># Example usage
</span>    <span class="n">prompt</span> <span class="o">=</span> <span class="s">"Ambient electronic music with evolving synthesizer pads and gentle rhythm"</span>
    
    <span class="n">generate_extended_music</span><span class="p">(</span>
        <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
        <span class="n">total_duration</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>    <span class="c1"># 1 minute
</span>        <span class="n">segment_duration</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>  <span class="c1"># 15 seconds per segment
</span>        <span class="n">model_size</span><span class="o">=</span><span class="s">"medium"</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="mf">0.8</span>         <span class="c1"># Slightly lower temperature for continuity
</span>    <span class="p">)</span>
</code></pre></div></div>

<p>This technique generates music in segments and uses each previous segment to condition the generation of the next, creating a coherent extended piece.</p>

<h3 id="tips-for-extended-generation">Tips for Extended Generation</h3>

<ol>
  <li><strong>Use Lower Temperature</strong>: A slightly lower temperature (0.7-0.9) helps maintain consistency between segments.</li>
  <li><strong>Overlapping Segments</strong>: Use a longer crossfade for smoother transitions (2-4 seconds).</li>
  <li><strong>Same Prompt Throughout</strong>: For stylistic consistency, use the same text prompt for all segments.</li>
  <li><strong>Check for Repetition</strong>: If the music becomes too repetitive, try increasing the temperature for later segments.</li>
  <li><strong>Monitor Memory Usage</strong>: Extended generation can consume significant memory over time, so monitor system resources.</li>
</ol>

<h2 id="advanced-parameter-tuning">Advanced Parameter Tuning</h2>

<p>MusicGen offers several parameters that allow fine-grained control over the generation process.</p>

<h3 id="classifier-free-guidance">Classifier-Free Guidance</h3>

<p>Classifier-Free Guidance (CFG) is a technique that enhances the model’s adherence to the text prompt:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Set generation parameters with CFG
</span><span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span>
    <span class="n">duration</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
    <span class="n">top_p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">cfg_coef</span><span class="o">=</span><span class="mf">3.0</span>  <span class="c1"># Classifier-free guidance scale
</span><span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">cfg_coef</code> parameter controls how strongly the generation follows the text description:</p>
<ul>
  <li><strong>Lower values (1.0-2.0)</strong>: More creative, potentially less aligned with the prompt</li>
  <li><strong>Medium values (3.0-5.0)</strong>: Good balance between adherence and creativity</li>
  <li><strong>Higher values (6.0-10.0)</strong>: Strictly follows the prompt, potentially less creative</li>
</ul>

<h3 id="sampling-parameters">Sampling Parameters</h3>

<p>Fine-tuning the sampling parameters can significantly impact the quality and diversity of generated music:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span>
    <span class="n">duration</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>    <span class="c1"># Controls randomness
</span>    <span class="n">top_k</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>           <span class="c1"># Limits token selection to top k options
</span>    <span class="n">top_p</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>          <span class="c1"># Uses nucleus sampling with probability threshold
</span>    <span class="n">repetition_penalty</span><span class="o">=</span><span class="mf">1.2</span>  <span class="c1"># Penalizes repeated tokens
</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><strong>top_k</strong>: Limits token selection to the k most likely tokens. Lower values (50-100) create more focused outputs, while higher values (250-1000) allow more diversity.</li>
  <li><strong>top_p</strong>: Nucleus sampling parameter that dynamically selects tokens whose cumulative probability exceeds the threshold p. Values around 0.9 work well when enabled.</li>
  <li><strong>repetition_penalty</strong>: Discourages the model from repeating the same patterns by penalizing previously generated tokens.</li>
</ul>

<h3 id="experimenting-with-parameters">Experimenting with Parameters</h3>

<p>To understand how different parameters affect generation, create a parameter exploration script:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># parameter_explorer.py
</span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">audiocraft.models</span> <span class="kn">import</span> <span class="n">MusicGen</span>
<span class="kn">from</span> <span class="nn">audiocraft.data.audio</span> <span class="kn">import</span> <span class="n">audio_write</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">explore_parameters</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s">"parameter_exploration"</span><span class="p">):</span>
    <span class="s">"""Explore different generation parameters with the same prompt."""</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Parameter combinations to explore
</span>    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Temperature variations
</span>        <span class="p">{</span><span class="s">"temp"</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">"top_k"</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s">"top_p"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">"cfg"</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"temp"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">"top_k"</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s">"top_p"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">"cfg"</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"temp"</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s">"top_k"</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s">"top_p"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">"cfg"</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">},</span>
        
        <span class="c1"># CFG variations
</span>        <span class="p">{</span><span class="s">"temp"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">"top_k"</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s">"top_p"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">"cfg"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"temp"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">"top_k"</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s">"top_p"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">"cfg"</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"temp"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">"top_k"</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s">"top_p"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">"cfg"</span><span class="p">:</span> <span class="mf">8.0</span><span class="p">},</span>
        
        <span class="c1"># Sampling strategy variations
</span>        <span class="p">{</span><span class="s">"temp"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">"top_k"</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s">"top_p"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">"cfg"</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"temp"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">"top_k"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"top_p"</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s">"cfg"</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"temp"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">"top_k"</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s">"top_p"</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s">"cfg"</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">},</span>
    <span class="p">]</span>
    
    <span class="c1"># Determine device
</span>    <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">backends</span><span class="p">.</span><span class="n">mps</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"mps"</span>
    <span class="k">elif</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cuda"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cpu"</span>
    
    <span class="c1"># Load model (use "small" for faster exploration)
</span>    <span class="n">model</span> <span class="o">=</span> <span class="n">MusicGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="s">"small"</span><span class="p">)</span>
    <span class="n">model</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    
    <span class="c1"># Generate with each parameter set
</span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating sample </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="si">}</span><span class="s"> with parameters: </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
        <span class="c1"># Set parameters
</span>        <span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span>
            <span class="n">duration</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>  <span class="c1"># Short duration for exploration
</span>            <span class="n">temperature</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s">"temp"</span><span class="p">],</span>
            <span class="n">top_k</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s">"top_k"</span><span class="p">],</span>
            <span class="n">top_p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s">"top_p"</span><span class="p">],</span>
            <span class="n">cfg_coef</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s">"cfg"</span><span class="p">]</span>
        <span class="p">)</span>
        
        <span class="c1"># Generate
</span>        <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">([</span><span class="n">prompt</span><span class="p">])</span>
        
        <span class="c1"># Save with parameter information in filename
</span>        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"temp</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'temp'</span><span class="p">]</span><span class="si">}</span><span class="s">_topk</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'top_k'</span><span class="p">]</span><span class="si">}</span><span class="s">_topp</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'top_p'</span><span class="p">]</span><span class="si">}</span><span class="s">_cfg</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'cfg'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">audio_write</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">(),</span> <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Saved to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="s">"An electronic dance track with driving beat and synthesizer melody"</span>
    <span class="n">explore_parameters</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
</code></pre></div></div>

<p>This script will generate multiple samples with different parameter combinations, allowing you to hear how each parameter affects the output.</p>

<h2 id="combining-advanced-techniques">Combining Advanced Techniques</h2>

<p>For the most sophisticated music generation, you can combine melody conditioning with parameter tuning and extended generation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># advanced_music_project.py
</span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchaudio</span>
<span class="kn">from</span> <span class="nn">audiocraft.models</span> <span class="kn">import</span> <span class="n">MusicGen</span>
<span class="kn">from</span> <span class="nn">audiocraft.data.audio</span> <span class="kn">import</span> <span class="n">audio_write</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">def</span> <span class="nf">generate_advanced_music_project</span><span class="p">(</span>
    <span class="n">text_prompt</span><span class="p">,</span>
    <span class="n">melody_path</span><span class="p">,</span>
    <span class="n">total_duration</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
    <span class="n">segment_duration</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s">"advanced_project"</span><span class="p">,</span>
    <span class="n">model_size</span><span class="o">=</span><span class="s">"large"</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
    <span class="n">cfg_coef</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span>
    <span class="n">crossfade_duration</span><span class="o">=</span><span class="mf">3.0</span>
<span class="p">):</span>
    <span class="s">"""
    Create an advanced music project using melody conditioning, parameter tuning,
    and extended generation techniques.
    """</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Determine device
</span>    <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">backends</span><span class="p">.</span><span class="n">mps</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"mps"</span>
    <span class="k">elif</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cuda"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cpu"</span>
    
    <span class="c1"># Load the model
</span>    <span class="n">model</span> <span class="o">=</span> <span class="n">MusicGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="n">model_size</span><span class="p">)</span>
    <span class="n">model</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    
    <span class="c1"># Load the melody file
</span>    <span class="n">melody_waveform</span><span class="p">,</span> <span class="n">melody_sample_rate</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">melody_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">melody_waveform</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">melody_waveform</span> <span class="o">=</span> <span class="n">melody_waveform</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Convert to mono if needed
</span>    
    <span class="c1"># Calculate number of segments needed
</span>    <span class="n">num_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">total_duration</span> <span class="o">/</span> <span class="n">segment_duration</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating </span><span class="si">{</span><span class="n">num_segments</span><span class="si">}</span><span class="s"> segments for a total of approximately </span><span class="si">{</span><span class="n">total_duration</span><span class="si">}</span><span class="s"> seconds"</span><span class="p">)</span>
    
    <span class="c1"># Set parameters for the first segment
</span>    <span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span>
        <span class="n">duration</span><span class="o">=</span><span class="n">segment_duration</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">top_k</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
        <span class="n">top_p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">cfg_coef</span><span class="o">=</span><span class="n">cfg_coef</span>
    <span class="p">)</span>
    
    <span class="c1"># Generate the first segment with melody conditioning
</span>    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating segment 1/</span><span class="si">{</span><span class="n">num_segments</span><span class="si">}</span><span class="s"> with melody conditioning"</span><span class="p">)</span>
    <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate_with_chroma</span><span class="p">(</span>
        <span class="n">descriptions</span><span class="o">=</span><span class="p">[</span><span class="n">text_prompt</span><span class="p">],</span>
        <span class="n">melody_wavs</span><span class="o">=</span><span class="n">melody_waveform</span><span class="p">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">melody_sample_rate</span><span class="o">=</span><span class="n">melody_sample_rate</span>
    <span class="p">)</span>
    
    <span class="c1"># Convert to numpy for easier manipulation
</span>    <span class="n">all_audio</span> <span class="o">=</span> <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">().</span><span class="n">numpy</span><span class="p">()</span>
    
    <span class="c1"># Save the first segment
</span>    <span class="n">audio_write</span><span class="p">(</span>
        <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s">"segment_1"</span><span class="p">),</span>
        <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">(),</span>
        <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
        <span class="n">strategy</span><span class="o">=</span><span class="s">"loudness"</span>
    <span class="p">)</span>
    
    <span class="c1"># Generate subsequent segments with continuation and gradually increasing temperature
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_segments</span><span class="p">):</span>
        <span class="c1"># Slightly increase temperature for each segment to add variation
</span>        <span class="n">current_temperature</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">temperature</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">),</span> <span class="mf">1.3</span><span class="p">)</span>
        
        <span class="c1"># Set parameters for this segment
</span>        <span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">segment_duration</span><span class="p">,</span>
            <span class="n">temperature</span><span class="o">=</span><span class="n">current_temperature</span><span class="p">,</span>
            <span class="n">top_k</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
            <span class="n">top_p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">cfg_coef</span><span class="o">=</span><span class="n">cfg_coef</span>
        <span class="p">)</span>
        
        <span class="c1"># Get the end of the previous segment to use as a prompt
</span>        <span class="n">continuation_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">5.0</span> <span class="o">*</span> <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">)</span>  <span class="c1"># Use last 5 seconds as conditioning
</span>        <span class="n">audio_prompt</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">all_audio</span><span class="p">[</span><span class="o">-</span><span class="n">continuation_samples</span><span class="p">:]).</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating segment </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">num_segments</span><span class="si">}</span><span class="s"> (continuation, temp=</span><span class="si">{</span><span class="n">current_temperature</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
        
        <span class="c1"># Generate continuation with the original text prompt for guidance
</span>        <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate_continuation</span><span class="p">(</span>
            <span class="n">prompt_or_tokens</span><span class="o">=</span><span class="p">[</span><span class="n">text_prompt</span><span class="p">],</span>  <span class="c1"># Use text prompt for guidance
</span>            <span class="n">prompt_sample</span><span class="o">=</span><span class="n">audio_prompt</span><span class="p">,</span>
            <span class="n">prompt_sample_rate</span><span class="o">=</span><span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="n">segment_audio</span> <span class="o">=</span> <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">().</span><span class="n">numpy</span><span class="p">()</span>
        
        <span class="c1"># Save individual segment
</span>        <span class="n">audio_write</span><span class="p">(</span>
            <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s">"segment_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">"</span><span class="p">),</span>
            <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">(),</span>
            <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
            <span class="n">strategy</span><span class="o">=</span><span class="s">"loudness"</span>
        <span class="p">)</span>
        
        <span class="c1"># Apply crossfade between segments
</span>        <span class="n">crossfade_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">crossfade_duration</span> <span class="o">*</span> <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">)</span>
        
        <span class="c1"># Create crossfade weights
</span>        <span class="n">fade_out</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">crossfade_samples</span><span class="p">)</span>
        <span class="n">fade_in</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">crossfade_samples</span><span class="p">)</span>
        
        <span class="c1"># Apply crossfade
</span>        <span class="n">all_audio</span><span class="p">[</span><span class="o">-</span><span class="n">crossfade_samples</span><span class="p">:]</span> <span class="o">=</span> <span class="n">all_audio</span><span class="p">[</span><span class="o">-</span><span class="n">crossfade_samples</span><span class="p">:]</span> <span class="o">*</span> <span class="n">fade_out</span> <span class="o">+</span> <span class="n">segment_audio</span><span class="p">[:</span><span class="n">crossfade_samples</span><span class="p">]</span> <span class="o">*</span> <span class="n">fade_in</span>
        
        <span class="c1"># Append the new segment (excluding the crossfaded part)
</span>        <span class="n">all_audio</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">all_audio</span><span class="p">,</span> <span class="n">segment_audio</span><span class="p">[</span><span class="n">crossfade_samples</span><span class="p">:]])</span>
    
    <span class="c1"># Convert final audio back to tensor
</span>    <span class="n">final_audio</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">all_audio</span><span class="p">)</span>
    
    <span class="c1"># Save the complete extended audio
</span>    <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s">"advanced_project_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">total_duration</span><span class="p">)</span><span class="si">}</span><span class="s">s"</span><span class="p">)</span>
    <span class="n">torchaudio</span><span class="p">.</span><span class="n">save</span><span class="p">(</span>
        <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s">.wav"</span><span class="p">,</span>
        <span class="n">final_audio</span><span class="p">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># Apply post-processing: 
</span>    <span class="c1"># 1. Normalize audio levels
</span>    <span class="n">normalized_audio</span> <span class="o">=</span> <span class="n">final_audio</span> <span class="o">/</span> <span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">final_audio</span><span class="p">))</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
    
    <span class="c1"># 2. Add fade-in and fade-out
</span>    <span class="n">fade_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">)</span>  <span class="c1"># 3-second fades
</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">normalized_audio</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">fade_samples</span><span class="p">:</span>
        <span class="n">fade_in</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">fade_samples</span><span class="p">)</span>
        <span class="n">fade_out</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">fade_samples</span><span class="p">)</span>
        
        <span class="n">normalized_audio</span><span class="p">[:</span><span class="n">fade_samples</span><span class="p">]</span> <span class="o">*=</span> <span class="n">fade_in</span>
        <span class="n">normalized_audio</span><span class="p">[</span><span class="o">-</span><span class="n">fade_samples</span><span class="p">:]</span> <span class="o">*=</span> <span class="n">fade_out</span>
    
    <span class="c1"># Save the processed final version
</span>    <span class="n">output_file_processed</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s">"advanced_project_processed_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">total_duration</span><span class="p">)</span><span class="si">}</span><span class="s">s"</span><span class="p">)</span>
    <span class="n">torchaudio</span><span class="p">.</span><span class="n">save</span><span class="p">(</span>
        <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_file_processed</span><span class="si">}</span><span class="s">.wav"</span><span class="p">,</span>
        <span class="n">normalized_audio</span><span class="p">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Advanced music project complete. Total duration: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_audio</span><span class="p">)</span> <span class="o">/</span> <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Final audio saved to </span><span class="si">{</span><span class="n">output_file_processed</span><span class="si">}</span><span class="s">.wav"</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_file_processed</span><span class="si">}</span><span class="s">.wav"</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">text_prompt</span> <span class="o">=</span> <span class="s">"An epic orchestral piece with evolving sections, starting gentle and building to a powerful climax"</span>
    <span class="n">melody_path</span> <span class="o">=</span> <span class="s">"path/to/your/melody.mp3"</span>  <span class="c1"># Replace with actual path
</span>    
    <span class="n">generate_advanced_music_project</span><span class="p">(</span>
        <span class="n">text_prompt</span><span class="o">=</span><span class="n">text_prompt</span><span class="p">,</span>
        <span class="n">melody_path</span><span class="o">=</span><span class="n">melody_path</span><span class="p">,</span>
        <span class="n">total_duration</span><span class="o">=</span><span class="mf">120.0</span><span class="p">,</span>  <span class="c1"># 2 minutes
</span>        <span class="n">model_size</span><span class="o">=</span><span class="s">"large"</span>     <span class="c1"># Use large model for highest quality
</span>    <span class="p">)</span>
</code></pre></div></div>

<p>This advanced script combines melody conditioning, extended generation with crossfades, temperature variation, and post-processing into a comprehensive music generation pipeline.</p>

<h2 id="performance-optimization">Performance Optimization</h2>

<p>When working with advanced techniques, performance optimization becomes important:</p>

<h3 id="memory-management">Memory Management</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Clear GPU memory after generation
</span><span class="k">def</span> <span class="nf">clear_gpu_memory</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">empty_cache</span><span class="p">()</span>
    <span class="kn">import</span> <span class="nn">gc</span>
    <span class="n">gc</span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>

<span class="c1"># Use in your generation loop
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_segments</span><span class="p">):</span>
    <span class="c1"># Generate segment
</span>    <span class="c1"># ...
</span>    
    <span class="c1"># Clear memory
</span>    <span class="n">clear_gpu_memory</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="batch-processing">Batch Processing</h3>

<p>For generating multiple variations efficiently:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generate multiple variations in a single batch
</span><span class="n">prompts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"Epic orchestral music with brass and strings"</span><span class="p">,</span>
    <span class="s">"Epic orchestral music with choir and percussion"</span><span class="p">,</span>
    <span class="s">"Epic orchestral music with solo violin and piano"</span>
<span class="p">]</span>

<span class="c1"># Generate all variations at once
</span><span class="n">wavs</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompts</span><span class="p">)</span>

<span class="c1"># Save all variations
</span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">wav</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wavs</span><span class="p">):</span>
    <span class="n">audio_write</span><span class="p">(</span><span class="sa">f</span><span class="s">"variation_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="n">wav</span><span class="p">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="exercises">Exercises</h2>

<ol>
  <li>
    <p><strong>Melody Transformation</strong>: Take a simple melody (like a piano recording of “Twinkle Twinkle Little Star”) and use melody conditioning with different style prompts (jazz, rock, orchestral, electronic).</p>
  </li>
  <li>
    <p><strong>Extended Composition</strong>: Create a 2-minute piece that evolves between different moods by changing the text prompt for each segment.</p>
  </li>
  <li>
    <p><strong>Parameter Exploration</strong>: Systematically explore how different values of <code class="language-plaintext highlighter-rouge">cfg_coef</code> affect generation with the same prompt and melody.</p>
  </li>
  <li>
    <p><strong>Genre Fusion</strong>: Use melody conditioning and carefully crafted prompts to blend two distinct genres (e.g., “Electronic dance music with classical orchestral elements”).</p>
  </li>
</ol>

<h2 id="next-steps">Next Steps</h2>

<p>After mastering these advanced techniques, explore:</p>

<ul>
  <li>Fine-tuning the MusicGen model on your own data</li>
  <li>Building a web interface for your generation pipeline</li>
  <li>Creating an audio post-processing chain for mastering</li>
  <li>Integrating MusicGen with live performance tools</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>The advanced techniques covered in this tutorial allow you to push MusicGen to its full potential, creating sophisticated, expressive, and extended musical compositions. By combining melody conditioning, parameter tuning, and extended generation strategies, you can achieve results that go well beyond basic text-to-music generation.</p>

<p>Remember that generating high-quality music still requires careful prompt engineering, parameter tuning, and often manual selection of the best results. MusicGen is a powerful tool, but making the most of it requires both technical understanding and musical intuition.</p>

  </div>

</article>

        </div>
      </main>

      <footer class="site-footer">
        <div class="container">
          <div class="footer-col-wrapper">
            <div class="footer-col">
              <p>A hands-on guide to creating music, sound effects, and audio experiences with AI</p>
              <p>
                <a href="https://github.com/facebookresearch/audiocraft">AudioCraft GitHub Repository</a>
              </p>
            </div>
            <div class="footer-col">
              <p class="copyright">
                Copyright © 2025 Scott Friedman.<br>
                Licensed under <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a>.
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>