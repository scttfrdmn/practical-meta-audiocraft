<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chapter 6: Prompt Engineering for Music</title>
  <meta name="description" content="Chapter 6: Prompt Engineering for Music">
  <link rel="canonical" href="https://scttfrdmn.github.io/practical-meta-audiocraft/chapters/part2/prompt-engineering/">
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      margin: 0;
      padding: 0;
    }
    .wrapper {
      max-width: 100%;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 0 20px;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    h1 { color: #1a73e8; }
    h2 { color: #34a853; }
    a {
      color: #1a73e8;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .site-header {
      border-bottom: 1px solid #eee;
      padding: 15px 0;
      margin-bottom: 30px;
    }
    .site-title {
      margin: 0;
      font-size: 1.8rem;
    }
    .site-title a {
      color: #1a73e8;
      text-decoration: none;
    }
    .site-nav {
      float: right;
      margin-top: 10px;
    }
    .site-nav .page-link {
      margin-left: 20px;
    }
    .nav-trigger {
      display: none;
    }
    .menu-icon {
      display: none;
    }
    .page-content {
      padding: 20px 0;
    }
    .site-footer {
      border-top: 1px solid #eee;
      padding: 30px 0;
      margin-top: 60px;
    }
    .footer-col-wrapper {
      display: flex;
      flex-wrap: wrap;
    }
    .footer-col {
      flex: 1;
      min-width: 200px;
      padding-right: 20px;
    }
    code {
      background-color: #f5f5f5;
      padding: 2px 5px;
      border-radius: 3px;
    }
    pre {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
    .highlight {
      background-color: #f5f5f5;
      border-radius: 5px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px 12px;
    }
    th {
      background-color: #f5f5f5;
      text-align: left;
    }
    button, .button {
      display: inline-block;
      background-color: #1a73e8;
      color: white !important;
      padding: 10px 20px;
      border-radius: 4px;
      font-weight: bold;
      margin-top: 20px;
      border: none;
      cursor: pointer;
      text-decoration: none !important;
    }
    button:hover, .button:hover {
      background-color: #0d65d9;
    }
    .feature {
      background-color: #f5f5f5;
      border-radius: 8px;
      padding: 20px;
      border-left: 4px solid #1a73e8;
      margin-bottom: 20px;
    }
    
    @media screen and (max-width: 600px) {
      .site-nav {
        position: absolute;
        top: 70px;
        right: 20px;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        text-align: right;
        padding: 0;
        z-index: 1;
      }
      .site-nav .page-link {
        display: block;
        padding: 10px;
        margin: 0;
      }
      .site-nav .menu-icon {
        display: block;
        float: right;
        width: 36px;
        height: 26px;
        line-height: 0;
        padding-top: 10px;
        text-align: center;
      }
      .site-nav .trigger {
        clear: both;
        display: none;
      }
      .site-nav input:checked ~ .trigger {
        display: block;
        padding-bottom: 5px;
      }
      .footer-col-wrapper {
        flex-direction: column;
      }
      .footer-col {
        margin-bottom: 20px;
      }
    }
  </style>
</head><body>
    <div class="wrapper">
      <header class="site-header">
        <div class="container">
          <h1 class="site-title"><a href="/practical-meta-audiocraft/">Practical Meta AudioCraft</a></h1>
          <nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
              <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                  <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484c0-0.82,0.665-1.485,1.484-1.485 h15.032C17.335,0,18,0.665,18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516 c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,6.031,18,6.696,18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516c0-0.82,0.665-1.483,1.484-1.483h15.032 C17.335,12.031,18,12.696,18,13.516z"/>
                </svg>
              </span>
            </label>

            <div class="trigger">
              <a class="page-link" href="/practical-meta-audiocraft/">Home</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part1/introduction/">Getting Started</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part2/basic-music/">MusicGen</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part3/introduction-to-audiogen/">AudioGen</a>
              <a class="page-link" href="/practical-meta-audiocraft/tutorials/getting-started/">Tutorials</a>
            </div>
          </nav>
        </div>
      </header>

      <main class="page-content" aria-label="Content">
        <div class="container">
          <div class="chapter">
  <div class="chapter-header">
    <div class="chapter-metadata">
      <span class="difficulty intermediate">Intermediate</span>
      <span class="estimated-time">2.5 hours</span>
    </div>
    <h1>Chapter 6: Prompt Engineering for Music</h1>
  </div>
  
  
  <div class="scenario-quote">
    <blockquote>
      <p>"I've been using MusicGen for my projects, but I'm frustrated with the inconsistent results. Sometimes I get exactly what I want, but other times the music is completely off. I need to figure out a more reliable approach to crafting prompts so I can consistently get the kind of music I'm looking for."</p>
      <cite>— Jamie Nguyen, Independent Filmmaker</cite>
    </blockquote>
  </div>
  
  
  <h1 id="chapter-6-prompt-engineering-for-music">Chapter 6: Prompt Engineering for Music</h1>

<h2 id="the-challenge">The Challenge</h2>

<p>You’ve learned the basics of music generation with MusicGen, but you’ve discovered that the quality and relevance of the output heavily depends on how you formulate your prompts. Sometimes the generated music captures your vision perfectly, while other times it feels disconnected from what you described. This inconsistency can be frustrating, especially when you have specific musical needs for a project.</p>

<p>Creating truly effective prompts requires more than just basic descriptions. You need a systematic approach that leverages MusicGen’s training and capabilities while avoiding common pitfalls. Different musical styles, moods, and contexts demand different prompt strategies, and knowing how to adapt your approach can be the difference between a generic result and a perfect musical match.</p>

<p>In this chapter, we’ll develop advanced prompt engineering techniques specifically for music generation. You’ll learn how to analyze and deconstruct music into promptable elements, build prompts with deliberate structure, and create specialized prompts for different musical contexts. By the end, you’ll have a reliable framework for crafting prompts that consistently produce the music you need.</p>

<h2 id="learning-objectives">Learning Objectives</h2>

<p>By the end of this chapter, you’ll be able to:</p>

<ul>
  <li>Apply systematic prompt engineering techniques for music generation</li>
  <li>Analyze and deconstruct music into promptable components</li>
  <li>Create structured, effective prompts for different musical styles and contexts</li>
  <li>Use specialized music terminology to guide generation more precisely</li>
  <li>Develop prompt templates for consistent results across multiple generations</li>
  <li>Test and refine prompts through systematic experimentation</li>
  <li>Troubleshoot and improve problematic prompts</li>
</ul>

<h2 id="understanding-the-musicgen-prompt-space">Understanding the MusicGen Prompt Space</h2>

<p>Before diving into specific techniques, it’s important to understand how MusicGen “thinks” about music based on its training. Unlike traditional composition software that works with notes, scales, and explicit musical elements, MusicGen operates in a higher-level semantic space where text descriptions are connected to audio patterns.</p>

<h3 id="how-musicgen-interprets-prompts">How MusicGen Interprets Prompts</h3>

<p>MusicGen was trained on a large dataset of music paired with text descriptions. During this training, it learned to associate certain words and phrases with specific musical patterns, textures, and structures. This means that the prompt vocabulary you use directly activates particular “regions” of the model’s learned space.</p>

<p>Think of it like this: When you use the word “jazz” in a prompt, you’re not just giving the model a general category - you’re activating a complex network of associations that includes:</p>

<ul>
  <li>Typical jazz instrumentation (piano, bass, drums, saxophone)</li>
  <li>Common jazz chord progressions and harmonies</li>
  <li>Characteristic rhythmic patterns and swing feel</li>
  <li>Production aesthetics associated with jazz recordings</li>
</ul>

<p>The same applies to descriptive terms like “upbeat,” “melancholic,” or “epic” - each word triggers specific patterns the model has learned. Understanding this connection between language and music is key to crafting effective prompts.</p>

<h3 id="the-hierarchy-of-musical-elements-in-prompts">The Hierarchy of Musical Elements in Prompts</h3>

<p>When constructing prompts, it helps to understand the hierarchy of influence that different elements have on the generated music:</p>

<ol>
  <li><strong>Genre and Style</strong>: The strongest influence, setting the fundamental character</li>
  <li><strong>Instrumentation</strong>: Strongly shapes the sound palette and texture</li>
  <li><strong>Mood/Emotion</strong>: Guides harmonic choices and expressive elements</li>
  <li><strong>Tempo/Rhythm</strong>: Establishes the energy and movement</li>
  <li><strong>Structure</strong>: Influences how the music develops over time</li>
  <li><strong>Technical Elements</strong>: Specific musical techniques or production details</li>
</ol>

<p>In general, elements higher in this hierarchy have more influence on the output. For example, specifying “jazz” (genre) has a stronger effect than specifying “with a bridge section” (structure).</p>

<h2 id="systematic-prompt-engineering-framework">Systematic Prompt Engineering Framework</h2>

<p>Let’s develop a systematic framework for constructing effective music prompts:</p>

<h3 id="1-the-genre-mood-inst-tech-framework">1. The GENRE-MOOD-INST-TECH Framework</h3>

<p>A reliable structure for building prompts is the GENRE-MOOD-INST-TECH framework:</p>

<ul>
  <li><strong>GENRE</strong>: The musical style or genre</li>
  <li><strong>MOOD</strong>: The emotional character or atmosphere</li>
  <li><strong>INST</strong>: Key instrumentation or sonic elements</li>
  <li><strong>TECH</strong>: Technical aspects like tempo, key, or structure</li>
</ul>

<p>Here’s how to apply this framework:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A [GENRE] piece with [MOOD] atmosphere, featuring [INST] with [TECH] characteristics.
</code></pre></div></div>

<p><strong>Example</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A jazz fusion piece with energetic and playful atmosphere, featuring electric piano, slap bass, and saxophone with complex chord progressions and a moderate tempo.
</code></pre></div></div>

<h3 id="2-the-mood-first-approach">2. The Mood-First Approach</h3>

<p>For projects where emotion is the primary concern, you can use a mood-first approach:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A [MOOD] piece that creates a feeling of [EMOTION DETAILS], using [INST] in a [GENRE] style with [TECH] elements.
</code></pre></div></div>

<p><strong>Example</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A melancholic piece that creates a feeling of gentle nostalgia and reflection, using piano and subtle string accompaniment in a contemporary classical style with a slow tempo and minor key harmonies.
</code></pre></div></div>

<h3 id="3-the-cinematic-structure-approach">3. The Cinematic Structure Approach</h3>

<p>For film-like music with narrative development:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A [GENRE] piece that begins with [SECTION 1 DESCRIPTION], then develops into [SECTION 2 DESCRIPTION], before concluding with [SECTION 3 DESCRIPTION]. The music features [INST] and conveys [MOOD].
</code></pre></div></div>

<p><strong>Example</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>An orchestral piece that begins with quiet, mysterious strings and subtle percussion, then develops into a tense section with brass stabs and driving rhythms, before concluding with a triumphant, full orchestral resolution. The music features french horns, timpani, and string sections, and conveys a journey from uncertainty to victory.
</code></pre></div></div>

<h2 id="music-specific-vocabulary-for-prompts">Music-Specific Vocabulary for Prompts</h2>

<p>Using precise musical terminology can significantly improve your prompts. Here’s a guide to effective musical vocabulary:</p>

<h3 id="instrumentation-terminology">Instrumentation Terminology</h3>

<p>Instead of vague terms like “instruments,” use specific instrument names:</p>

<p><strong>Basic</strong>:</p>
<ul>
  <li>Piano, guitar, drums, bass</li>
  <li>Strings, brass, woodwinds, percussion</li>
  <li>Synthesizer, electronic drums</li>
</ul>

<p><strong>More Specific</strong>:</p>
<ul>
  <li>Upright piano, acoustic guitar, drum kit, double bass</li>
  <li>Violin section, trumpet ensemble, flute solo, timpani</li>
  <li>Analog synthesizer, TR-808 drum machine</li>
</ul>

<p><strong>Examples</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Vague prompt
"A piece with keyboard and drums"

# Improved prompt
"A piece featuring a bright grand piano with jazz drum kit playing with brushes"
</code></pre></div></div>

<h3 id="music-theory-elements">Music Theory Elements</h3>

<p>Incorporating music theory concepts can guide the harmonic and structural qualities:</p>

<p><strong>Harmonic Terms</strong>:</p>
<ul>
  <li>Major/minor key</li>
  <li>Modal (Dorian, Lydian, etc.)</li>
  <li>Chromatic, dissonant, consonant</li>
  <li>Chord progressions, arpeggios</li>
</ul>

<p><strong>Rhythm Terms</strong>:</p>
<ul>
  <li>Tempo descriptors (allegro, adagio, moderato)</li>
  <li>Time signatures (4/4, 3/4, 6/8)</li>
  <li>Rhythmic patterns (syncopated, steady, polyrhythmic)</li>
</ul>

<p><strong>Examples</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Basic prompt
"A happy sounding classical piece"

# Improved prompt
"A classical piece in D major with a moderate tempo (allegro moderato), featuring flowing arpeggios and a waltz-like 3/4 time signature"
</code></pre></div></div>

<h3 id="production-and-mixing-terms">Production and Mixing Terms</h3>

<p>For modern music, production aesthetics matter:</p>

<ul>
  <li>Reverb, delay, echo</li>
  <li>Compressed, distorted, clean</li>
  <li>Lo-fi, hi-fi, vintage, modern</li>
  <li>Stereo field, panning, depth</li>
</ul>

<p><strong>Examples</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Basic prompt
"An electronic track"

# Improved prompt
"An electronic track with heavily compressed drums, a wide stereo field for synthesizer pads, and vintage tape saturation for warmth"
</code></pre></div></div>

<h2 id="genre-specific-prompt-techniques">Genre-Specific Prompt Techniques</h2>

<p>Different musical genres respond to different prompt strategies:</p>

<h3 id="orchestralfilm-music-prompts">Orchestral/Film Music Prompts</h3>

<p>Orchestral music benefits from narrative structure and specific instrument sections:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">orchestral_prompt</span> <span class="o">=</span> <span class="s">"""
A dynamic orchestral piece that begins with soft, mysterious string passages and delicate harp arpeggios. 
The music gradually builds tension with french horns and woodwinds joining, introducing a noble theme. 
The middle section intensifies with percussion and brass, creating a sense of conflict and drama,
before resolving into a triumphant finale with full orchestra playing in a major key.
The piece features prominent brass fanfares, timpani rolls, and soaring violin melodies.
"""</span>
</code></pre></div></div>

<p><strong>Key techniques</strong>:</p>
<ul>
  <li>Describe the narrative arc (beginning, middle, end)</li>
  <li>Specify instrument sections rather than just “orchestra”</li>
  <li>Include dynamics (soft, building, intense, etc.)</li>
  <li>Reference thematic elements (noble theme, conflict, resolution)</li>
</ul>

<h3 id="electronic-music-prompts">Electronic Music Prompts</h3>

<p>Electronic music responds well to technical and production details:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">electronic_prompt</span> <span class="o">=</span> <span class="s">"""
A high-energy electronic dance track with a driving four-on-the-floor kick at 128 BPM.
The track features a punchy, sidechained bass synth, arpeggiated lead synthesizers with moderate resonance,
and atmospheric pad sounds with long reverb tails. The arrangement follows a clear build-up structure
with a filtered breakdown in the middle, leading to an euphoric drop with wide, detuned synth chords.
The production has a modern, clean character with tight, compressed drums and deep sub-bass.
"""</span>
</code></pre></div></div>

<p><strong>Key techniques</strong>:</p>
<ul>
  <li>Specify BPM (beats per minute)</li>
  <li>Describe synth characteristics (arpeggiated, resonance, detuned)</li>
  <li>Include production elements (sidechained, reverb, compressed)</li>
  <li>Detail the arrangement structure (build-up, breakdown, drop)</li>
</ul>

<h3 id="jazz-prompts">Jazz Prompts</h3>

<p>Jazz generation benefits from references to playing styles and harmonic approaches:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">jazz_prompt</span> <span class="o">=</span> <span class="s">"""
A cool jazz piece in the style of Miles Davis' modal period, featuring a muted trumpet playing a relaxed,
melodic line over sophisticated chord voicings from a piano. The rhythm section maintains a laid-back swing feel,
with a walking bass line and brushed drums providing a subtle, responsive foundation. The harmonic language
uses extended chords and occasional modal passages, while maintaining a cohesive, bluesy sensibility throughout.
The piece includes space for brief improvisational solos from the trumpet and piano.
"""</span>
</code></pre></div></div>

<p><strong>Key techniques</strong>:</p>
<ul>
  <li>Reference specific artists or eras for stylistic guidance</li>
  <li>Describe playing techniques (muted trumpet, brushed drums)</li>
  <li>Include jazz-specific concepts (modal, walking bass, swing)</li>
  <li>Mention improvisational elements</li>
</ul>

<h3 id="poprock-prompts">Pop/Rock Prompts</h3>

<p>Pop and rock benefit from structural clarity and production references:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pop_prompt</span> <span class="o">=</span> <span class="s">"""
An upbeat pop rock song with a catchy, radio-friendly chorus featuring bright electric guitars and a driving rhythm section.
The verses have a more restrained energy with clean electric guitar arpeggios and a four-on-the-floor kick pattern.
The pre-chorus builds tension with increasing dynamics and added synthesizer pads, leading to an anthemic chorus
with distorted power chords and a memorable melodic hook. The bridge section introduces a new perspective with
a half-time feel and atmospheric elements before returning to the final chorus with added harmonies and energy.
"""</span>
</code></pre></div></div>

<p><strong>Key techniques</strong>:</p>
<ul>
  <li>Clearly define song sections (verse, chorus, bridge)</li>
  <li>Contrast elements between sections</li>
  <li>Specify guitar tones and playing styles</li>
  <li>Include structural development (building, increasing, etc.)</li>
</ul>

<h2 id="advanced-prompt-construction-techniques">Advanced Prompt Construction Techniques</h2>

<p>Beyond the basic frameworks, here are advanced techniques to further improve your results:</p>

<h3 id="1-reference-artist-technique">1. Reference Artist Technique</h3>

<p>MusicGen has been trained on diverse musical styles and can often recognize artist references:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">artist_reference_prompt</span> <span class="o">=</span> <span class="s">"""
A neo-soul track in the style of D'Angelo, with warm Rhodes electric piano, deep pocket drumming,
and layered vocal harmonies. The music has an organic, slightly loose feel with complex jazz-influenced
chord progressions and a gentle head-nodding groove around 85 BPM.
"""</span>
</code></pre></div></div>

<p>This technique works best when the artist has a distinctive, well-known sound. Be careful not to simply ask for a specific artist’s song, as this might not work well. Instead, describe the characteristic elements of their style.</p>

<h3 id="2-era-and-production-reference">2. Era and Production Reference</h3>

<p>Referencing specific time periods or production eras can help achieve consistent aesthetic results:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">era_reference_prompt</span> <span class="o">=</span> <span class="s">"""
A 1980s synthwave track with gated reverb drums, analog synthesizer arpeggios, and retro production aesthetics.
The music evokes the sound of vintage science fiction soundtracks with warm analog pads, punchy bass synths,
and a cinematic atmosphere reminiscent of early electronic film scores.
"""</span>
</code></pre></div></div>

<p>This works especially well for genres that have strong associations with particular time periods or production techniques.</p>

<h3 id="3-emotional-trajectory-mapping">3. Emotional Trajectory Mapping</h3>

<p>For pieces where emotional development is important, map the emotional journey:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">emotional_trajectory_prompt</span> <span class="o">=</span> <span class="s">"""
A piano-led instrumental that begins with a sense of uncertainty and gentle melancholy,
gradually building confidence and warmth as new elements are introduced. The middle section
introduces hopeful string elements that lift the piece emotionally, leading to a sense
of peaceful resolution and acceptance in the final section, where the piano returns to
the initial themes but transforms them into a major key with confident expression.
"""</span>
</code></pre></div></div>

<p>This technique is particularly effective for narrative contexts like film music or game soundtracks.</p>

<h3 id="4-technical-constraint-injection">4. Technical Constraint Injection</h3>

<p>Sometimes explicitly including technical constraints helps focus the generation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">technical_constraint_prompt</span> <span class="o">=</span> <span class="s">"""
A folk-inspired acoustic piece in 6/8 time signature and D minor, featuring fingerpicked
guitar with occasional hammer-ons and pull-offs. The melody stays primarily within a
middle octave range, with subtle dynamic variations rather than dramatic changes.
The piece maintains a consistent tempo around 70 BPM without tempo changes.
"""</span>
</code></pre></div></div>

<p>This is useful when you need the music to fit specific technical requirements, like suitable background music for voice-over that needs to stay in a certain dynamic range.</p>

<h2 id="prompt-testing-and-refinement-process">Prompt Testing and Refinement Process</h2>

<p>Crafting the perfect prompt often requires experimentation and refinement. Here’s a systematic approach:</p>

<h3 id="1-the-ab-testing-method">1. The A/B Testing Method</h3>

<p>Start with a basic prompt and create variations that test one element at a time:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Base prompt
</span><span class="n">base_prompt</span> <span class="o">=</span> <span class="s">"An upbeat electronic track with melodic synths and driving rhythm"</span>

<span class="c1"># A/B test - Genre specificity 
</span><span class="n">variation_a</span> <span class="o">=</span> <span class="s">"An upbeat synthwave track with melodic synths and driving rhythm"</span>
<span class="n">variation_b</span> <span class="o">=</span> <span class="s">"An upbeat electronic dance music track with melodic synths and driving rhythm"</span>

<span class="c1"># A/B test - Instrumentation detail
</span><span class="n">variation_c</span> <span class="o">=</span> <span class="s">"An upbeat electronic track with arpeggiated analog synthesizers, warm pad sounds, and driving 808 drum patterns"</span>
<span class="n">variation_d</span> <span class="o">=</span> <span class="s">"An upbeat electronic track with melodic lead synthesizers, atmospheric textures, and driving drum machine rhythms"</span>
</code></pre></div></div>

<p>Generate music with each variation and compare the results to understand which changes produce the desired effects.</p>

<h3 id="2-the-iterative-expansion-method">2. The Iterative Expansion Method</h3>

<p>Start with a minimal prompt and progressively add detail based on results:</p>

<p><strong>Iteration 1</strong>: “A jazz piano trio”</p>

<p><strong>Iteration 2</strong>: “A jazz piano trio with a relaxed swing feel and bluesy harmony”</p>

<p><strong>Iteration 3</strong>: “A jazz piano trio with a relaxed swing feel and bluesy harmony, featuring a conversational interplay between piano and upright bass, with subtle brushed drums maintaining the groove”</p>

<p>This approach helps you identify which details actually matter for your desired outcome.</p>

<h3 id="3-the-subtraction-method">3. The Subtraction Method</h3>

<p>Start with a detailed prompt and remove elements to see what’s essential:</p>

<p><strong>Original</strong>: “A cinematic orchestral piece with dramatic string passages, powerful brass fanfares, thunderous percussion, and a heroic theme in a major key, building to an emotional climax with full orchestra”</p>

<p><strong>Subtraction 1</strong>: “A cinematic orchestral piece with dramatic string passages, powerful brass, and a heroic theme building to an emotional climax” (Removed percussion details and key specification)</p>

<p><strong>Subtraction 2</strong>: “A cinematic orchestral piece with dramatic strings and brass, building to an emotional climax” (Further simplification)</p>

<p>This helps identify which elements are most influential and which can be removed without affecting the core result.</p>

<h2 id="implementing-a-prompt-engineering-workflow">Implementing a Prompt Engineering Workflow</h2>

<p>Let’s implement a systematic prompt engineering workflow that incorporates these techniques:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># prompt_engineering_workflow.py
</span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">audiocraft.models</span> <span class="kn">import</span> <span class="n">MusicGen</span>
<span class="kn">from</span> <span class="nn">audiocraft.data.audio</span> <span class="kn">import</span> <span class="n">audio_write</span>

<span class="k">class</span> <span class="nc">MusicPromptEngineer</span><span class="p">:</span>
    <span class="s">"""A system for developing and testing music generation prompts."""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_size</span><span class="o">=</span><span class="s">"medium"</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s">"prompt_experiments"</span><span class="p">):</span>
        <span class="s">"""Initialize the prompt engineering system."""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">model_size</span> <span class="o">=</span> <span class="n">model_size</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_get_device</span><span class="p">()</span>
        
        <span class="c1"># Create output directory
</span>        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Create experiment tracking file
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">experiments_file</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s">"experiments.json"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">experiments</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_load_experiments</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_get_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Determine the best available device."""</span>
        <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
            <span class="k">return</span> <span class="s">"cuda"</span>
        <span class="k">elif</span> <span class="n">torch</span><span class="p">.</span><span class="n">backends</span><span class="p">.</span><span class="n">mps</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
            <span class="k">return</span> <span class="s">"mps"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"cpu"</span>
    
    <span class="k">def</span> <span class="nf">_load_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Load existing experiment data or create new file."""</span>
        <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">experiments_file</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">experiments_file</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">json</span><span class="p">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s">"experiments"</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">"experiments"</span><span class="p">:</span> <span class="p">[]}</span>
    
    <span class="k">def</span> <span class="nf">_save_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Save experiment data to disk."""</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">experiments_file</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">experiments</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Load the MusicGen model."""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">MusicGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">model_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">device</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">,</span> <span class="n">prompts</span><span class="p">,</span> <span class="n">generation_params</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""
        Run a prompt engineering experiment with multiple prompts.
        
        Args:
            experiment_name (str): Name for this experiment
            prompts (dict): Dictionary of prompt name -&gt; prompt text
            generation_params (dict, optional): Parameters for generation
            
        Returns:
            dict: Experiment results with paths to generated files
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">load_model</span><span class="p">()</span>
        
        <span class="c1"># Use default parameters if none provided
</span>        <span class="k">if</span> <span class="n">generation_params</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">"duration"</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
                <span class="s">"temperature"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="s">"top_k"</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
                <span class="s">"top_p"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="s">"cfg_coef"</span><span class="p">:</span> <span class="mf">3.0</span>
            <span class="p">}</span>
        
        <span class="c1"># Create experiment directory
</span>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y%m%d_%H%M%S"</span><span class="p">)</span>
        <span class="n">experiment_dir</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">experiment_name</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Set generation parameters
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span><span class="o">**</span><span class="n">generation_params</span><span class="p">)</span>
        
        <span class="c1"># Run experiment for each prompt
</span>        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">prompt_name</span><span class="p">,</span> <span class="n">prompt_text</span> <span class="ow">in</span> <span class="n">prompts</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating for prompt: </span><span class="si">{</span><span class="n">prompt_name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="c1"># Generate music
</span>            <span class="k">try</span><span class="p">:</span>
                <span class="n">wav</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">([</span><span class="n">prompt_text</span><span class="p">])</span>
                
                <span class="c1"># Save audio
</span>                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">prompt_name</span><span class="si">}</span><span class="s">"</span>
                <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="n">audio_write</span><span class="p">(</span>
                    <span class="n">output_path</span><span class="p">,</span>
                    <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
                    <span class="n">strategy</span><span class="o">=</span><span class="s">"loudness"</span><span class="p">,</span>
                <span class="p">)</span>
                
                <span class="c1"># Record result
</span>                <span class="n">results</span><span class="p">[</span><span class="n">prompt_name</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generated: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span><span class="p">)</span>
                
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">prompt_name</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error with prompt '</span><span class="si">{</span><span class="n">prompt_name</span><span class="si">}</span><span class="s">': </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
            <span class="c1"># Clean up between generations
</span>            <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
                <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">empty_cache</span><span class="p">()</span>
        
        <span class="c1"># Save experiment details
</span>        <span class="n">experiment_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"name"</span><span class="p">:</span> <span class="n">experiment_name</span><span class="p">,</span>
            <span class="s">"timestamp"</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
            <span class="s">"prompts"</span><span class="p">:</span> <span class="n">prompts</span><span class="p">,</span>
            <span class="s">"generation_params"</span><span class="p">:</span> <span class="n">generation_params</span><span class="p">,</span>
            <span class="s">"results"</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
            <span class="s">"model_size"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">model_size</span>
        <span class="p">}</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">experiments</span><span class="p">[</span><span class="s">"experiments"</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">experiment_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_save_experiments</span><span class="p">()</span>
        
        <span class="c1"># Create HTML report
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">_create_experiment_report</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="n">experiment_data</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">results</span>
    
    <span class="k">def</span> <span class="nf">_create_experiment_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_dir</span><span class="p">,</span> <span class="n">experiment_data</span><span class="p">):</span>
        <span class="s">"""Create an HTML report for the experiment."""</span>
        <span class="n">html_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"""
        &lt;!DOCTYPE html&gt;
        &lt;html&gt;
        &lt;head&gt;
            &lt;title&gt;Prompt Experiment: </span><span class="si">{</span><span class="n">experiment_data</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span><span class="si">}</span><span class="s">&lt;/title&gt;
            &lt;style&gt;
                body 
                h1, h2 
                .prompt-container 
                .prompt-text 
                .parameters 
                audio 
            &lt;/style&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;h1&gt;Prompt Experiment: </span><span class="si">{</span><span class="n">experiment_data</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span><span class="si">}</span><span class="s">&lt;/h1&gt;
            &lt;p&gt;Timestamp: </span><span class="si">{</span><span class="n">experiment_data</span><span class="p">[</span><span class="s">'timestamp'</span><span class="p">]</span><span class="si">}</span><span class="s">&lt;/p&gt;
            &lt;p&gt;Model: MusicGen </span><span class="si">{</span><span class="n">experiment_data</span><span class="p">[</span><span class="s">'model_size'</span><span class="p">]</span><span class="si">}</span><span class="s">&lt;/p&gt;
            
            &lt;div class="parameters"&gt;
                &lt;h3&gt;Generation Parameters:&lt;/h3&gt;
                &lt;ul&gt;
        """</span>
        
        <span class="c1"># Add parameters
</span>        <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">experiment_data</span><span class="p">[</span><span class="s">'generation_params'</span><span class="p">].</span><span class="n">items</span><span class="p">():</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"&lt;li&gt;&lt;strong&gt;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s">:&lt;/strong&gt; </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s">&lt;/li&gt;</span><span class="se">\n</span><span class="s">"</span>
        
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"""
                &lt;/ul&gt;
            &lt;/div&gt;
            
            &lt;h2&gt;Prompts and Results:&lt;/h2&gt;
        """</span>
        
        <span class="c1"># Add each prompt and result
</span>        <span class="k">for</span> <span class="n">prompt_name</span><span class="p">,</span> <span class="n">prompt_text</span> <span class="ow">in</span> <span class="n">experiment_data</span><span class="p">[</span><span class="s">'prompts'</span><span class="p">].</span><span class="n">items</span><span class="p">():</span>
            <span class="n">result_path</span> <span class="o">=</span> <span class="n">experiment_data</span><span class="p">[</span><span class="s">'results'</span><span class="p">].</span><span class="n">get</span><span class="p">(</span><span class="n">prompt_name</span><span class="p">,</span> <span class="s">"Generation failed"</span><span class="p">)</span>
            <span class="n">audio_element</span> <span class="o">=</span> <span class="s">""</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result_path</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"Error"</span><span class="p">):</span>
                <span class="c1"># Create relative path for HTML
</span>                <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">basename</span><span class="p">(</span><span class="n">result_path</span><span class="p">)</span>
                <span class="n">audio_element</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'&lt;audio controls src="</span><span class="si">{</span><span class="n">rel_path</span><span class="si">}</span><span class="s">"&gt;&lt;/audio&gt;'</span>
            
            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"""
            &lt;div class="prompt-container"&gt;
                &lt;h3&gt;Prompt: </span><span class="si">{</span><span class="n">prompt_name</span><span class="si">}</span><span class="s">&lt;/h3&gt;
                &lt;div class="prompt-text"&gt;</span><span class="si">{</span><span class="n">prompt_text</span><span class="si">}</span><span class="s">&lt;/div&gt;
                </span><span class="si">{</span><span class="n">audio_element</span><span class="si">}</span><span class="s">
                &lt;p&gt;Result: </span><span class="si">{</span><span class="n">result_path</span><span class="si">}</span><span class="s">&lt;/p&gt;
            &lt;/div&gt;
            """</span>
        
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"""
        &lt;/body&gt;
        &lt;/html&gt;
        """</span>
        
        <span class="c1"># Write HTML file
</span>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="s">"report.html"</span><span class="p">),</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">ab_test_prompts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_prompt</span><span class="p">,</span> <span class="n">variations</span><span class="p">,</span> <span class="n">experiment_name</span><span class="o">=</span><span class="s">"A/B_Test"</span><span class="p">):</span>
        <span class="s">"""
        Run an A/B test experiment with variations on a base prompt.
        
        Args:
            base_prompt (str): The baseline prompt
            variations (dict): Dictionary of variation name -&gt; variation prompt
            experiment_name (str): Name for this experiment
            
        Returns:
            dict: Experiment results
        """</span>
        <span class="n">prompts</span> <span class="o">=</span> <span class="p">{</span><span class="s">"base"</span><span class="p">:</span> <span class="n">base_prompt</span><span class="p">}</span>
        <span class="n">prompts</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">variations</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">run_experiment</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">,</span> <span class="n">prompts</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">genre_exploration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">genres</span><span class="p">,</span> <span class="n">experiment_name</span><span class="o">=</span><span class="s">"Genre_Exploration"</span><span class="p">):</span>
        <span class="s">"""
        Explore different genres using the same prompt template.
        
        Args:
            template (str): Prompt template with {genre} placeholder
            genres (list): List of genres to test
            experiment_name (str): Name for this experiment
            
        Returns:
            dict: Experiment results
        """</span>
        <span class="n">prompts</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa">f</span><span class="s">"genre_</span><span class="si">{</span><span class="n">genre</span><span class="si">}</span><span class="s">"</span><span class="p">:</span> <span class="n">template</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">genre</span><span class="o">=</span><span class="n">genre</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">genre</span> <span class="ow">in</span> <span class="n">genres</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">run_experiment</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">,</span> <span class="n">prompts</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">detail_level_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">experiment_name</span><span class="o">=</span><span class="s">"Detail_Level_Test"</span><span class="p">):</span>
        <span class="s">"""
        Test different levels of detail for the same musical content.
        
        Args:
            content (dict): Dictionary with 'minimal', 'moderate', and 'detailed' prompts
            experiment_name (str): Name for this experiment
            
        Returns:
            dict: Experiment results
        """</span>
        <span class="c1"># Ensure we have the expected levels
</span>        <span class="n">expected_levels</span> <span class="o">=</span> <span class="p">[</span><span class="s">'minimal'</span><span class="p">,</span> <span class="s">'moderate'</span><span class="p">,</span> <span class="s">'detailed'</span><span class="p">]</span>
        <span class="n">prompts</span> <span class="o">=</span> <span class="p">{</span><span class="n">level</span><span class="p">:</span> <span class="n">content</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="s">"Missing prompt"</span><span class="p">)</span> <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">expected_levels</span><span class="p">}</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">run_experiment</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">,</span> <span class="n">prompts</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="s">"""Run example prompt engineering workflows."""</span>
    <span class="n">engineer</span> <span class="o">=</span> <span class="n">MusicPromptEngineer</span><span class="p">(</span><span class="n">model_size</span><span class="o">=</span><span class="s">"medium"</span><span class="p">)</span>
    
    <span class="c1"># Example 1: A/B testing different aspects of a prompt
</span>    <span class="n">ab_test_example</span> <span class="o">=</span> <span class="n">engineer</span><span class="p">.</span><span class="n">ab_test_prompts</span><span class="p">(</span>
        <span class="n">base_prompt</span><span class="o">=</span><span class="s">"An electronic dance track with a catchy melody"</span><span class="p">,</span>
        <span class="n">variations</span><span class="o">=</span><span class="p">{</span>
            <span class="s">"more_specific_genre"</span><span class="p">:</span> <span class="s">"A synthwave electronic dance track with a catchy melody"</span><span class="p">,</span>
            <span class="s">"more_instruments"</span><span class="p">:</span> <span class="s">"An electronic dance track with a catchy synth melody, pulsing bass, and four-on-the-floor kick drum"</span><span class="p">,</span>
            <span class="s">"more_structure"</span><span class="p">:</span> <span class="s">"An electronic dance track with a catchy melody, starting with a minimal intro, building to an energetic drop, and ending with a stripped-back outro"</span><span class="p">,</span>
            <span class="s">"more_technical"</span><span class="p">:</span> <span class="s">"An electronic dance track with a catchy melody in F minor at 128 BPM with side-chained compression on the bass"</span>
        <span class="p">}</span>
    <span class="p">)</span>
    
    <span class="c1"># Example 2: Genre exploration
</span>    <span class="n">genre_template</span> <span class="o">=</span> <span class="s">"A {genre} piece with a contemplative mood, featuring piano and subtle orchestral elements"</span>
    <span class="n">genre_example</span> <span class="o">=</span> <span class="n">engineer</span><span class="p">.</span><span class="n">genre_exploration</span><span class="p">(</span>
        <span class="n">template</span><span class="o">=</span><span class="n">genre_template</span><span class="p">,</span>
        <span class="n">genres</span><span class="o">=</span><span class="p">[</span><span class="s">"classical"</span><span class="p">,</span> <span class="s">"jazz"</span><span class="p">,</span> <span class="s">"ambient"</span><span class="p">,</span> <span class="s">"cinematic"</span><span class="p">,</span> <span class="s">"folk"</span><span class="p">]</span>
    <span class="p">)</span>
    
    <span class="c1"># Example 3: Testing level of detail
</span>    <span class="n">detail_test</span> <span class="o">=</span> <span class="n">engineer</span><span class="p">.</span><span class="n">detail_level_test</span><span class="p">({</span>
        <span class="s">"minimal"</span><span class="p">:</span> <span class="s">"A piano solo with strings"</span><span class="p">,</span>
        <span class="s">"moderate"</span><span class="p">:</span> <span class="s">"A melancholic piano solo with soft string accompaniment in a minor key"</span><span class="p">,</span>
        <span class="s">"detailed"</span><span class="p">:</span> <span class="s">"A melancholic piano solo with expressive rubato timing and delicate touch, accompanied by soft, legato string sections playing sustained chords in A minor. The piece has a gentle dynamic range with occasional swells in the strings to highlight emotional moments, and maintains a slow, contemplative tempo throughout."</span>
    <span class="p">})</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Experiments completed! Review the results in the output directory."</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>This comprehensive prompt engineering system allows you to:</p>
<ul>
  <li>Run controlled experiments with different prompt variations</li>
  <li>Test genre explorations using the same template</li>
  <li>Evaluate the effect of different levels of detail</li>
  <li>Generate HTML reports to compare results</li>
</ul>

<h2 id="genre-specific-prompt-templates">Genre-Specific Prompt Templates</h2>

<p>Let’s create a library of effective prompt templates for different genres. These templates include placeholders that you can customize for your specific needs:</p>

<h3 id="orchestralfilm-music-template">Orchestral/Film Music Template</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>An orchestral {mood} piece in a {style} style. The music features {primary_instruments} with supporting {secondary_instruments}. The piece begins with {intro_description}, develops into {middle_description}, and concludes with {finale_description}. The overall atmosphere conveys a sense of {emotion}.
</code></pre></div></div>

<p><strong>Example</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>An orchestral epic piece in a modern cinematic style. The music features french horns and timpani with supporting string sections and choir. The piece begins with quiet, mysterious string passages, develops into a powerful and driving action sequence, and concludes with a triumphant, heroic finale. The overall atmosphere conveys a sense of adventure and victory.
</code></pre></div></div>

<h3 id="electronic-music-template">Electronic Music Template</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A {subgenre} electronic track at {tempo} BPM. The production features {key_elements} with {processing_technique}. The arrangement starts with {intro}, builds with {buildup_elements}, and peaks with {climax_description}. The overall sound has a {sound_character} quality with {additional_details}.
</code></pre></div></div>

<p><strong>Example</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A deep house electronic track at 124 BPM. The production features a subby bass and filtered synth chords with sidechain compression. The arrangement starts with atmospheric pads and a minimal kick-hat pattern, builds with gradually opening filters and rising percussion layers, and peaks with a full frequency chord progression and vocal samples. The overall sound has a warm, analog quality with subtle tape saturation on the drum bus.
</code></pre></div></div>

<h3 id="jazz-template">Jazz Template</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A {jazz_style} jazz piece featuring {lead_instrument} with {rhythm_section_description}. The performance has a {feel} feel with {harmonic_approach} harmonies. The piece includes {additional_elements} and demonstrates {playing_characteristics}.
</code></pre></div></div>

<p><strong>Example</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A cool jazz piece featuring muted trumpet with a rhythm section of upright bass, piano, and brushed drums. The performance has a relaxed, late-night feel with extended harmonies and modal passages. The piece includes tasteful improvised solos and demonstrates restrained dynamics with occasional flourishes of technical skill.
</code></pre></div></div>

<h3 id="ambientatmospheric-template">Ambient/Atmospheric Template</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>An ambient {mood} soundscape with {texture_elements} creating a {atmosphere} atmosphere. The piece evolves slowly through {progression_description} with {detail_elements} adding depth and interest. The frequency spectrum emphasizes {frequency_focus} with {space_description} spatial characteristics.
</code></pre></div></div>

<p><strong>Example</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>An ambient meditative soundscape with layered synthesizer pads and processed field recordings creating a serene and otherworldly atmosphere. The piece evolves slowly through gradual timbre modulations and subtle harmonic shifts with occasional piano notes and distant bird calls adding depth and interest. The frequency spectrum emphasizes mid and high frequencies with wide, expansive spatial characteristics.
</code></pre></div></div>

<h2 id="prompt-analysis-case-studies">Prompt Analysis Case Studies</h2>

<p>Let’s analyze some real-world examples to understand what makes them effective:</p>

<h3 id="case-study-1-effective-orchestral-prompt">Case Study 1: Effective Orchestral Prompt</h3>

<p><strong>Prompt</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A majestic orchestral fantasy theme with a heroic brass melody, soaring string sections, and powerful percussion. The piece begins with a mysterious introduction featuring harp arpeggios and soft woodwinds before the main theme enters with french horns. The middle section builds intensity with timpani rolls and full string sections, developing the melodic themes with counterpoint. The piece concludes with a triumphant resolution bringing all orchestral sections together in a grand finale.
</code></pre></div></div>

<p><strong>Analysis</strong>:</p>

<ol>
  <li><strong>Genre Clarity</strong>: “Orchestral fantasy theme” immediately establishes the style</li>
  <li><strong>Instrumentation Specificity</strong>: Names specific instruments (french horns, harp, timpani) rather than just saying “orchestra”</li>
  <li><strong>Structural Guidance</strong>: Clear three-part structure (mysterious intro → building middle → triumphant conclusion)</li>
  <li><strong>Musical Techniques</strong>: Mentions specific musical elements (arpeggios, counterpoint, resolution)</li>
  <li><strong>Emotional Direction</strong>: Clear emotional journey from “mysterious” to “triumphant”</li>
</ol>

<h3 id="case-study-2-problematic-pop-prompt">Case Study 2: Problematic Pop Prompt</h3>

<p><strong>Original Prompt</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A pop song with vocals and catchy tune.
</code></pre></div></div>

<p><strong>Problems</strong>:</p>
<ol>
  <li>Too vague - “pop” spans many substyles</li>
  <li>No instrumentation details</li>
  <li>No structural elements</li>
  <li>MusicGen actually doesn’t produce lyrics/vocals effectively</li>
  <li>“Catchy” is subjective and not descriptive</li>
</ol>

<p><strong>Improved Prompt</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>An upbeat modern pop instrumental in the style of recent chart hits, featuring a bright piano and synthesizer melody, energetic drum programming with trap hi-hat patterns, and a deep 808 bass. The arrangement follows a clear verse-chorus structure with a distinctive hook that repeats throughout the chorus sections. The bridge introduces a filter sweep and half-time feel before the final chorus.
</code></pre></div></div>

<p><strong>Improvements</strong>:</p>
<ol>
  <li>Specified “instrumental” to avoid vocal generation issues</li>
  <li>Added time reference (“modern” and “recent chart hits”)</li>
  <li>Detailed specific instruments and production elements</li>
  <li>Included specific structural elements</li>
  <li>Added distinctive production techniques (filter sweep, half-time)</li>
</ol>

<h2 id="testing-prompts-across-parameters">Testing Prompts Across Parameters</h2>

<p>Different prompts may require different generation parameters. Let’s explore this relationship:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_prompt_parameter_matrix</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">experiment_name</span><span class="o">=</span><span class="s">"Parameter_Matrix_Test"</span><span class="p">):</span>
    <span class="s">"""Test a prompt across a matrix of parameters."""</span>
    <span class="n">engineer</span> <span class="o">=</span> <span class="n">MusicPromptEngineer</span><span class="p">(</span><span class="n">model_size</span><span class="o">=</span><span class="s">"medium"</span><span class="p">)</span>
    
    <span class="c1"># Define parameter combinations to test
</span>    <span class="n">temperatures</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>
    <span class="n">cfg_coefs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]</span>
    
    <span class="n">all_prompts</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># Create a version for each parameter combination
</span>    <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">temperatures</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">cfg_coefs</span><span class="p">:</span>
            <span class="n">prompt_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"temp_</span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s">_cfg_</span><span class="si">{</span><span class="n">cfg</span><span class="si">}</span><span class="s">"</span>
            <span class="n">all_prompts</span><span class="p">[</span><span class="n">prompt_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt</span>
    
    <span class="c1"># Create parameter sets for each combination
</span>    <span class="n">param_sets</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">prompt_name</span> <span class="ow">in</span> <span class="n">all_prompts</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prompt_name</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"_"</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prompt_name</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"_"</span><span class="p">)[</span><span class="mi">3</span><span class="p">])</span>
        
        <span class="n">param_sets</span><span class="p">[</span><span class="n">prompt_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"duration"</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
            <span class="s">"temperature"</span><span class="p">:</span> <span class="n">temp</span><span class="p">,</span>
            <span class="s">"top_k"</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
            <span class="s">"top_p"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s">"cfg_coef"</span><span class="p">:</span> <span class="n">cfg</span>
        <span class="p">}</span>
    
    <span class="c1"># Run a customized experiment with different parameters per prompt
</span>    <span class="n">engineer</span><span class="p">.</span><span class="n">load_model</span><span class="p">()</span>
    
    <span class="c1"># Create experiment directory
</span>    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y%m%d_%H%M%S"</span><span class="p">)</span>
    <span class="n">experiment_dir</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">engineer</span><span class="p">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">experiment_name</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Run experiment for each prompt with its specific parameters
</span>    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">prompt_name</span><span class="p">,</span> <span class="n">prompt_text</span> <span class="ow">in</span> <span class="n">all_prompts</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating for </span><span class="si">{</span><span class="n">prompt_name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
        <span class="c1"># Set specific parameters for this prompt
</span>        <span class="n">params</span> <span class="o">=</span> <span class="n">param_sets</span><span class="p">[</span><span class="n">prompt_name</span><span class="p">]</span>
        <span class="n">engineer</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        
        <span class="c1"># Generate music
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">wav</span> <span class="o">=</span> <span class="n">engineer</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">([</span><span class="n">prompt_text</span><span class="p">])</span>
            
            <span class="c1"># Save audio
</span>            <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="n">prompt_name</span><span class="p">)</span>
            <span class="n">audio_write</span><span class="p">(</span>
                <span class="n">output_path</span><span class="p">,</span>
                <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">(),</span>
                <span class="n">engineer</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>
                <span class="n">strategy</span><span class="o">=</span><span class="s">"loudness"</span><span class="p">,</span>
            <span class="p">)</span>
            
            <span class="c1"># Record result
</span>            <span class="n">results</span><span class="p">[</span><span class="n">prompt_name</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generated: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">prompt_name</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error with </span><span class="si">{</span><span class="n">prompt_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
        <span class="c1"># Clean up between generations
</span>        <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
            <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">empty_cache</span><span class="p">()</span>
    
    <span class="c1"># Save experiment details
</span>    <span class="n">experiment_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"name"</span><span class="p">:</span> <span class="n">experiment_name</span><span class="p">,</span>
        <span class="s">"timestamp"</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
        <span class="s">"base_prompt"</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span>
        <span class="s">"parameter_sets"</span><span class="p">:</span> <span class="n">param_sets</span><span class="p">,</span>
        <span class="s">"results"</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
        <span class="s">"model_size"</span><span class="p">:</span> <span class="n">engineer</span><span class="p">.</span><span class="n">model_size</span>
    <span class="p">}</span>
    
    <span class="n">engineer</span><span class="p">.</span><span class="n">experiments</span><span class="p">[</span><span class="s">"experiments"</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">experiment_data</span><span class="p">)</span>
    <span class="n">engineer</span><span class="p">.</span><span class="n">_save_experiments</span><span class="p">()</span>
    
    <span class="c1"># Create HTML report
</span>    <span class="n">create_parameter_matrix_report</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="n">experiment_data</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">results</span>

<span class="k">def</span> <span class="nf">create_parameter_matrix_report</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="n">experiment_data</span><span class="p">):</span>
    <span class="s">"""Create an HTML report for the parameter matrix experiment."""</span>
    <span class="n">html_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"""
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Parameter Matrix Test: </span><span class="si">{</span><span class="n">experiment_data</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span><span class="si">}</span><span class="s">&lt;/title&gt;
        &lt;style&gt;
            body 
            h1, h2 
            .prompt-box 
            table 
            th, td 
            th 
            audio 
            .temp-low 
            .temp-med 
            .temp-high 
        &lt;/style&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Parameter Matrix Test&lt;/h1&gt;
        &lt;p&gt;Experiment: </span><span class="si">{</span><span class="n">experiment_data</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span><span class="si">}</span><span class="s">&lt;/p&gt;
        &lt;p&gt;Timestamp: </span><span class="si">{</span><span class="n">experiment_data</span><span class="p">[</span><span class="s">'timestamp'</span><span class="p">]</span><span class="si">}</span><span class="s">&lt;/p&gt;
        &lt;p&gt;Model: MusicGen </span><span class="si">{</span><span class="n">experiment_data</span><span class="p">[</span><span class="s">'model_size'</span><span class="p">]</span><span class="si">}</span><span class="s">&lt;/p&gt;
        
        &lt;h2&gt;Base Prompt:&lt;/h2&gt;
        &lt;div class="prompt-box"&gt;</span><span class="si">{</span><span class="n">experiment_data</span><span class="p">[</span><span class="s">'base_prompt'</span><span class="p">]</span><span class="si">}</span><span class="s">&lt;/div&gt;
        
        &lt;h2&gt;Results Matrix (Temperature × CFG Coefficient):&lt;/h2&gt;
        &lt;table&gt;
            &lt;tr&gt;
                &lt;th&gt;CFG / Temp&lt;/th&gt;
    """</span>
    
    <span class="c1"># Extract unique temperatures and cfg values
</span>    <span class="n">temperatures</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s">"temperature"</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">experiment_data</span><span class="p">[</span><span class="s">"parameter_sets"</span><span class="p">].</span><span class="n">values</span><span class="p">()]))</span>
    <span class="n">cfg_values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s">"cfg_coef"</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">experiment_data</span><span class="p">[</span><span class="s">"parameter_sets"</span><span class="p">].</span><span class="n">values</span><span class="p">()]))</span>
    
    <span class="c1"># Create header row with temperatures
</span>    <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">temperatures</span><span class="p">:</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"&lt;th&gt;</span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s">&lt;/th&gt;</span><span class="se">\n</span><span class="s">"</span>
    
    <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"&lt;/tr&gt;</span><span class="se">\n</span><span class="s">"</span>
    
    <span class="c1"># Create rows for each CFG value
</span>    <span class="k">for</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">cfg_values</span><span class="p">:</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"&lt;tr&gt;&lt;th&gt;</span><span class="si">{</span><span class="n">cfg</span><span class="si">}</span><span class="s">&lt;/th&gt;</span><span class="se">\n</span><span class="s">"</span>
        
        <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">temperatures</span><span class="p">:</span>
            <span class="c1"># Find the matching result
</span>            <span class="n">prompt_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"temp_</span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s">_cfg_</span><span class="si">{</span><span class="n">cfg</span><span class="si">}</span><span class="s">"</span>
            <span class="n">result_path</span> <span class="o">=</span> <span class="n">experiment_data</span><span class="p">[</span><span class="s">"results"</span><span class="p">].</span><span class="n">get</span><span class="p">(</span><span class="n">prompt_name</span><span class="p">,</span> <span class="s">"Missing"</span><span class="p">)</span>
            
            <span class="n">temp_class</span> <span class="o">=</span> <span class="s">"temp-med"</span>
            <span class="k">if</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">temp_class</span> <span class="o">=</span> <span class="s">"temp-low"</span>
            <span class="k">elif</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">temp_class</span> <span class="o">=</span> <span class="s">"temp-high"</span>
            
            <span class="k">if</span> <span class="s">"Error"</span> <span class="ow">in</span> <span class="n">result_path</span> <span class="ow">or</span> <span class="n">result_path</span> <span class="o">==</span> <span class="s">"Missing"</span><span class="p">:</span>
                <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">'&lt;td class="</span><span class="si">{</span><span class="n">temp_class</span><span class="si">}</span><span class="s">"&gt;Error&lt;/td&gt;</span><span class="se">\n</span><span class="s">'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">basename</span><span class="p">(</span><span class="n">result_path</span><span class="p">)</span>
                <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">'&lt;td class="</span><span class="si">{</span><span class="n">temp_class</span><span class="si">}</span><span class="s">"&gt;&lt;audio controls src="</span><span class="si">{</span><span class="n">rel_path</span><span class="si">}</span><span class="s">"&gt;&lt;/audio&gt;&lt;/td&gt;</span><span class="se">\n</span><span class="s">'</span>
        
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"&lt;/tr&gt;</span><span class="se">\n</span><span class="s">"</span>
    
    <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"""
        &lt;/table&gt;
        
        &lt;h2&gt;Parameter Details:&lt;/h2&gt;
        &lt;ul&gt;
    """</span>
    
    <span class="c1"># Add parameter descriptions
</span>    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"&lt;li&gt;&lt;strong&gt;Temperature&lt;/strong&gt;: Controls randomness/creativity (Low: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">temperatures</span><span class="p">)</span><span class="si">}</span><span class="s"> / High: </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">temperatures</span><span class="p">)</span><span class="si">}</span><span class="s">)&lt;/li&gt;</span><span class="se">\n</span><span class="s">"</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"&lt;li&gt;&lt;strong&gt;CFG Coefficient&lt;/strong&gt;: Controls adherence to prompt (Low: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">cfg_values</span><span class="p">)</span><span class="si">}</span><span class="s"> / High: </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">cfg_values</span><span class="p">)</span><span class="si">}</span><span class="s">)&lt;/li&gt;</span><span class="se">\n</span><span class="s">"</span>
    
    <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"""
        &lt;/ul&gt;
        &lt;p&gt;Lower temperature = more consistent, predictable output&lt;/p&gt;
        &lt;p&gt;Higher temperature = more varied, potentially creative output&lt;/p&gt;
        &lt;p&gt;Lower CFG = more musical freedom, less adherence to prompt&lt;/p&gt;
        &lt;p&gt;Higher CFG = stricter adherence to prompt, potentially at expense of musical quality&lt;/p&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    """</span>
    
    <span class="c1"># Write HTML file
</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="s">"parameter_matrix_report.html"</span><span class="p">),</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="creating-a-prompt-library">Creating a Prompt Library</h2>

<p>Organizing your successful prompts can save time and ensure consistency. Here’s how to create a reusable prompt library:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MusicPromptLibrary</span><span class="p">:</span>
    <span class="s">"""A library of reusable music generation prompts."""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">library_file</span><span class="o">=</span><span class="s">"prompt_library.json"</span><span class="p">):</span>
        <span class="s">"""Initialize the prompt library."""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">library_file</span> <span class="o">=</span> <span class="n">library_file</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_load_library</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_load_library</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Load existing library or create new one."""</span>
        <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">library_file</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">library_file</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">json</span><span class="p">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s">"categories"</span><span class="p">:</span> <span class="p">{},</span> <span class="s">"templates"</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">"categories"</span><span class="p">:</span> <span class="p">{},</span> <span class="s">"templates"</span><span class="p">:</span> <span class="p">{}}</span>
    
    <span class="k">def</span> <span class="nf">_save_library</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Save library to disk."""</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">library_file</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">add_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">prompt_text</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""
        Add a prompt to the library.
        
        Args:
            name (str): Name for this prompt
            prompt_text (str): The prompt text
            category (str, optional): Category for organization
            tags (list, optional): List of tags for searching
            notes (str, optional): Additional notes about this prompt
            parameters (dict, optional): Recommended generation parameters
        """</span>
        <span class="c1"># Create entry
</span>        <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"text"</span><span class="p">:</span> <span class="n">prompt_text</span><span class="p">,</span>
            <span class="s">"category"</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
            <span class="s">"tags"</span><span class="p">:</span> <span class="n">tags</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="s">"notes"</span><span class="p">:</span> <span class="n">notes</span> <span class="ow">or</span> <span class="s">""</span><span class="p">,</span>
            <span class="s">"parameters"</span><span class="p">:</span> <span class="n">parameters</span> <span class="ow">or</span> <span class="p">{},</span>
            <span class="s">"created"</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="p">}</span>
        
        <span class="c1"># Add to library
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">"categories"</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">category</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">[</span><span class="s">"categories"</span><span class="p">].</span><span class="n">setdefault</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="p">[])</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">[</span><span class="s">"categories"</span><span class="p">][</span><span class="n">category</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        
        <span class="c1"># Store the prompt
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_save_library</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">add_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">template_text</span><span class="p">,</span> <span class="n">placeholders</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">example</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""
        Add a prompt template with placeholders.
        
        Args:
            name (str): Template name
            template_text (str): Template with {placeholders}
            placeholders (dict, optional): Description of each placeholder
            example (dict, optional): Example values for placeholders
            notes (str, optional): Usage notes
        """</span>
        <span class="c1"># Create entry
</span>        <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"text"</span><span class="p">:</span> <span class="n">template_text</span><span class="p">,</span>
            <span class="s">"placeholders"</span><span class="p">:</span> <span class="n">placeholders</span> <span class="ow">or</span> <span class="p">{},</span>
            <span class="s">"example"</span><span class="p">:</span> <span class="n">example</span> <span class="ow">or</span> <span class="p">{},</span>
            <span class="s">"notes"</span><span class="p">:</span> <span class="n">notes</span> <span class="ow">or</span> <span class="s">""</span><span class="p">,</span>
            <span class="s">"created"</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="p">}</span>
        
        <span class="c1"># Store the template
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">"templates"</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">[</span><span class="s">"templates"</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_save_library</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">get_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="s">"""Get a prompt by name."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{}).</span><span class="n">get</span><span class="p">(</span><span class="s">"text"</span><span class="p">,</span> <span class="s">"Prompt not found"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="s">"""Get a template by name."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"templates"</span><span class="p">,</span> <span class="p">{}).</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{}).</span><span class="n">get</span><span class="p">(</span><span class="s">"text"</span><span class="p">,</span> <span class="s">"Template not found"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">fill_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""
        Fill a template with provided values.
        
        Args:
            template_name (str): Name of the template
            **kwargs: Values for placeholders
            
        Returns:
            str: Filled template
        """</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">template</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">).</span><span class="n">strip</span><span class="p">(</span><span class="s">"'"</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s">"Error: Missing required placeholder '</span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s">'"</span>
    
    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">in_tags</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">in_text</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""
        Search the prompt library.
        
        Args:
            query (str): Search term
            in_tags (bool): Search in tags
            in_text (bool): Search in prompt text
            category (str, optional): Limit to a specific category
            
        Returns:
            list: Matching prompt names
        """</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Skip categories and templates entries
</span>            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"categories"</span><span class="p">,</span> <span class="s">"templates"</span><span class="p">]:</span>
                <span class="k">continue</span>
                
            <span class="c1"># Skip if category doesn't match
</span>            <span class="k">if</span> <span class="n">category</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"category"</span><span class="p">)</span> <span class="o">!=</span> <span class="n">category</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="c1"># Check tags
</span>            <span class="k">if</span> <span class="n">in_tags</span> <span class="ow">and</span> <span class="n">query</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">tag</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"tags"</span><span class="p">,</span> <span class="p">[])]:</span>
                <span class="n">results</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">continue</span>
                
            <span class="c1"># Check text
</span>            <span class="k">if</span> <span class="n">in_text</span> <span class="ow">and</span> <span class="n">query</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"text"</span><span class="p">,</span> <span class="s">""</span><span class="p">).</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">results</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">results</span>
    
    <span class="k">def</span> <span class="nf">list_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""List all categories in the library."""</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"categories"</span><span class="p">,</span> <span class="p">{}).</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="k">def</span> <span class="nf">list_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""List all templates in the library."""</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"templates"</span><span class="p">,</span> <span class="p">{}).</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="k">def</span> <span class="nf">export_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="s">"prompt_library.html"</span><span class="p">):</span>
        <span class="s">"""Export the library as an HTML document."""</span>
        <span class="n">html_content</span> <span class="o">=</span> <span class="s">"""
        &lt;!DOCTYPE html&gt;
        &lt;html&gt;
        &lt;head&gt;
            &lt;title&gt;Music Prompt Library&lt;/title&gt;
            &lt;style&gt;
                body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
                h1, h2, h3 { color: #333; }
                .category { margin-bottom: 40px; }
                .prompt { margin-bottom: 30px; border: 1px solid #ddd; padding: 15px; border-radius: 5px; }
                .prompt-text { background-color: #f5f5f5; padding: 15px; border-radius: 5px; white-space: pre-wrap; margin: 10px 0; }
                .template { margin-bottom: 30px; border: 1px solid #4d94ff; padding: 15px; border-radius: 5px; background-color: #f0f7ff; }
                .template-text { background-color: #ffffff; padding: 15px; border-radius: 5px; white-space: pre-wrap; margin: 10px 0; }
                .tags { margin-top: 10px; }
                .tag { display: inline-block; background-color: #e6e6e6; padding: 3px 8px; border-radius: 10px; margin-right: 5px; font-size: 0.8em; }
                .parameters { background-color: #f9f9f9; padding: 10px; border-radius: 5px; margin-top: 10px; }
                .notes { font-style: italic; margin-top: 10px; }
                .placeholders { margin-top: 10px; }
                .placeholder { margin-bottom: 5px; }
            &lt;/style&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;h1&gt;Music Prompt Library&lt;/h1&gt;
            &lt;p&gt;Generated: """</span> <span class="o">+</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y-%m-%d %H:%M:%S"</span><span class="p">)</span> <span class="o">+</span> <span class="s">"""&lt;/p&gt;
            
            &lt;h2&gt;Templates&lt;/h2&gt;
            &lt;div class="templates"&gt;
        """</span>
        
        <span class="c1"># Add templates
</span>        <span class="k">for</span> <span class="n">template_name</span><span class="p">,</span> <span class="n">template</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"templates"</span><span class="p">,</span> <span class="p">{}).</span><span class="n">items</span><span class="p">():</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"""
            &lt;div class="template"&gt;
                &lt;h3&gt;</span><span class="si">{</span><span class="n">template_name</span><span class="si">}</span><span class="s">&lt;/h3&gt;
                &lt;div class="template-text"&gt;</span><span class="si">{</span><span class="n">template</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'text'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="si">}</span><span class="s">&lt;/div&gt;
            """</span>
            
            <span class="c1"># Add placeholders
</span>            <span class="k">if</span> <span class="n">template</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"placeholders"</span><span class="p">):</span>
                <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"&lt;div class='placeholders'&gt;&lt;strong&gt;Placeholders:&lt;/strong&gt;&lt;ul&gt;"</span>
                <span class="k">for</span> <span class="n">ph_name</span><span class="p">,</span> <span class="n">ph_desc</span> <span class="ow">in</span> <span class="n">template</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"placeholders"</span><span class="p">,</span> <span class="p">{}).</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"&lt;li class='placeholder'&gt;&lt;code&gt;</span><span class="si">{</span><span class="n">ph_name</span><span class="si">}</span><span class="s">&lt;/code&gt;: </span><span class="si">{</span><span class="n">ph_desc</span><span class="si">}</span><span class="s">&lt;/li&gt;"</span>
                <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"&lt;/ul&gt;&lt;/div&gt;"</span>
            
            <span class="c1"># Add example
</span>            <span class="k">if</span> <span class="n">template</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"example"</span><span class="p">):</span>
                <span class="n">example_text</span> <span class="o">=</span> <span class="n">template</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"text"</span><span class="p">,</span> <span class="s">""</span><span class="p">).</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="n">template</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"example"</span><span class="p">,</span> <span class="p">{}))</span>
                <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"""
                &lt;div class='example'&gt;
                    &lt;strong&gt;Example:&lt;/strong&gt;
                    &lt;div class='prompt-text'&gt;</span><span class="si">{</span><span class="n">example_text</span><span class="si">}</span><span class="s">&lt;/div&gt;
                    &lt;strong&gt;Values:&lt;/strong&gt;&lt;ul&gt;
                """</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">template</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"example"</span><span class="p">,</span> <span class="p">{}).</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"&lt;li&gt;&lt;code&gt;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s">&lt;/code&gt;: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s">&lt;/li&gt;"</span>
                <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"&lt;/ul&gt;&lt;/div&gt;"</span>
            
            <span class="c1"># Add notes
</span>            <span class="k">if</span> <span class="n">template</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"notes"</span><span class="p">):</span>
                <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"&lt;div class='notes'&gt;&lt;strong&gt;Notes:&lt;/strong&gt; </span><span class="si">{</span><span class="n">template</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'notes'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="si">}</span><span class="s">&lt;/div&gt;"</span>
                
            <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"&lt;/div&gt;"</span>
        
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"""
            &lt;/div&gt;
            
            &lt;h2&gt;Prompts by Category&lt;/h2&gt;
        """</span>
        
        <span class="c1"># Add prompts by category
</span>        <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">prompt_names</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"categories"</span><span class="p">,</span> <span class="p">{}).</span><span class="n">items</span><span class="p">():</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"""
            &lt;div class="category"&gt;
                &lt;h3&gt;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s">&lt;/h3&gt;
            """</span>
            
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">prompt_names</span><span class="p">:</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">prompts</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span>
                
                <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"""
                &lt;div class="prompt"&gt;
                    &lt;h4&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">&lt;/h4&gt;
                    &lt;div class="prompt-text"&gt;</span><span class="si">{</span><span class="n">prompt</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'text'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="si">}</span><span class="s">&lt;/div&gt;
                """</span>
                
                <span class="c1"># Add tags
</span>                <span class="k">if</span> <span class="n">prompt</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"tags"</span><span class="p">):</span>
                    <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"&lt;div class='tags'&gt;"</span>
                    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">prompt</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"tags"</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"&lt;span class='tag'&gt;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s">&lt;/span&gt;"</span>
                    <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"&lt;/div&gt;"</span>
                
                <span class="c1"># Add parameters
</span>                <span class="k">if</span> <span class="n">prompt</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"parameters"</span><span class="p">):</span>
                    <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"&lt;div class='parameters'&gt;&lt;strong&gt;Recommended Parameters:&lt;/strong&gt;&lt;ul&gt;"</span>
                    <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">prompt</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"parameters"</span><span class="p">,</span> <span class="p">{}).</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"&lt;li&gt;&lt;code&gt;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s">&lt;/code&gt;: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s">&lt;/li&gt;"</span>
                    <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"&lt;/ul&gt;&lt;/div&gt;"</span>
                
                <span class="c1"># Add notes
</span>                <span class="k">if</span> <span class="n">prompt</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"notes"</span><span class="p">):</span>
                    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"&lt;div class='notes'&gt;&lt;strong&gt;Notes:&lt;/strong&gt; </span><span class="si">{</span><span class="n">prompt</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'notes'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="si">}</span><span class="s">&lt;/div&gt;"</span>
                
                <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"&lt;/div&gt;"</span>
                
            <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"&lt;/div&gt;"</span>
        
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s">"""
        &lt;/body&gt;
        &lt;/html&gt;
        """</span>
        
        <span class="c1"># Write HTML file
</span>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">output_file</span>
</code></pre></div></div>

<p>This prompt library system allows you to:</p>
<ul>
  <li>Save successful prompts with metadata</li>
  <li>Organize prompts by categories and tags</li>
  <li>Create reusable templates with placeholders</li>
  <li>Search your prompt collection</li>
  <li>Export a browsable HTML version of your library</li>
</ul>

<h2 id="hands-on-challenge">Hands-on Challenge</h2>

<p>Now it’s your turn to apply what you’ve learned. Try this multi-step challenge to explore prompt engineering in depth:</p>

<h3 id="challenge-genre-transformation-prompts">Challenge: Genre Transformation Prompts</h3>

<ol>
  <li>Choose a specific musical piece or style as a reference</li>
  <li>Create prompts to transform this reference into at least three different genres</li>
  <li>For each genre transformation:
    <ul>
      <li>Create three variations of the prompt with different levels of detail</li>
      <li>Test each prompt with at least two different temperature settings</li>
    </ul>
  </li>
  <li>Compare the results and document which prompt strategies were most effective for each genre</li>
  <li>Create a final “optimized” prompt for each genre transformation</li>
</ol>

<p>This challenge will help you develop intuition for how different prompt elements influence generation across genres.</p>

<h2 id="key-takeaways">Key Takeaways</h2>

<ul>
  <li>Effective music prompts follow specific frameworks (GENRE-MOOD-INST-TECH)</li>
  <li>Different musical genres respond better to different prompt structures</li>
  <li>A systematic approach to testing and refining prompts yields better results</li>
  <li>Technical and music-specific vocabulary significantly improves generations</li>
  <li>Prompt libraries and templates provide consistency across projects</li>
  <li>Parameter settings interact with prompts in complex ways</li>
</ul>

<h2 id="next-steps">Next Steps</h2>

<p>Now that you’ve mastered prompt engineering for music, you’re ready to explore:</p>

<ul>
  <li><a href="/chapters/part2/parameter-optimization/">Parameter Optimization</a>: Fine-tune generation parameters for better results</li>
  <li><a href="/chapters/part2/melody-conditioning/">Melody Conditioning</a>: Guide music generation with reference melodies</li>
  <li><a href="/chapters/part2/advanced-techniques/">Advanced Music Generation Techniques</a>: Learn sophisticated approaches to music generation</li>
</ul>

<h2 id="further-reading">Further Reading</h2>

<ul>
  <li><a href="https://www.musictheory.net/">Music Theory Basics</a>: Learn musical terminology for more precise prompts</li>
  <li><a href="https://arxiv.org/abs/2306.05284">MusicGen Research Paper</a>: Simple and Controllable Music Generation</li>
  <li><a href="https://www.promptingguide.ai/">Prompt Engineering Guide</a>: General techniques for effective prompting</li>
</ul>

  
  
  
  
  
  
  <div class="next-steps">
    <h2>Next Steps</h2>
    <p>Now that you've mastered 6 prompt engineering for music, you're ready to explore:</p>
    <ul>
      
      <li>
        <a href="/chapters/part2/parameter-optimization/">Parameter Optimization</a>: Fine-tune generation parameters for better results
      </li>
      
      <li>
        <a href="/chapters/part2/melody-conditioning/">Melody Conditioning</a>: Guide music generation with reference melodies
      </li>
      
      <li>
        <a href="/chapters/part2/advanced-techniques/">Advanced Music Generation Techniques</a>: Learn sophisticated approaches to music generation
      </li>
      
    </ul>
  </div>
  
  
  
  <div class="further-reading">
    <h2>Further Reading</h2>
    <ul>
      
      <li>
        
        <a href="https://www.musictheory.net/" target="_blank">Music Theory Basics</a>
        
        
        - Learn musical terminology for more precise prompts
        
      </li>
      
      <li>
        
        <a href="https://arxiv.org/abs/2306.05284" target="_blank">MusicGen Research Paper</a>
        
        
        - Simple and Controllable Music Generation
        
      </li>
      
      <li>
        
        <a href="https://www.promptingguide.ai/" target="_blank">Prompt Engineering Guide</a>
        
        
        - General techniques for effective prompting
        
      </li>
      
    </ul>
  </div>
  
</div>

<div class="chapter-navigation">
  
  <a href="/chapters/part2/parameter-optimization/" class="prev-chapter">
    <span class="nav-label">Previous</span>
    <span class="nav-title">Parameter Optimization for Music Generation</span>
  </a>
  
  
  
  <a href="/chapters/part3/audio-scene-composition/" class="next-chapter">
    <span class="nav-label">Next</span>
    <span class="nav-title">Audio Scene Composition</span>
  </a>
  
</div>

<!-- Copyright footer for all chapter pages -->
<div class="copyright-footer">
  <hr>
  <p>
    Copyright © 2025 Scott Friedman.
    <br>
    This work is licensed under the <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.
  </p>
</div>


        </div>
      </main>

      <footer class="site-footer">
        <div class="container">
          <div class="footer-col-wrapper">
            <div class="footer-col">
              <p>A hands-on guide to creating music, sound effects, and audio experiences with AI</p>
              <p>
                <a href="https://github.com/facebookresearch/audiocraft">AudioCraft GitHub Repository</a>
              </p>
            </div>
            <div class="footer-col">
              <p class="copyright">
                Copyright © 2025 Scott Friedman.<br>
                Licensed under <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a>.
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>