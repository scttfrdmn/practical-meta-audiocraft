<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chapter 2: Setting Up Your Environment</title>
  <meta name="description" content="Chapter 2: Setting Up Your Environment">
  <link rel="canonical" href="https://scttfrdmn.github.io/practical-meta-audiocraft/chapters/part1/setup/">
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      margin: 0;
      padding: 0;
    }
    .wrapper {
      max-width: 100%;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 0 20px;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    h1 { color: #1a73e8; }
    h2 { color: #34a853; }
    a {
      color: #1a73e8;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .site-header {
      border-bottom: 1px solid #eee;
      padding: 15px 0;
      margin-bottom: 30px;
    }
    .site-title {
      margin: 0;
      font-size: 1.8rem;
    }
    .site-title a {
      color: #1a73e8;
      text-decoration: none;
    }
    .site-nav {
      float: right;
      margin-top: 10px;
    }
    .site-nav .page-link {
      margin-left: 20px;
    }
    .nav-trigger {
      display: none;
    }
    .menu-icon {
      display: none;
    }
    .page-content {
      padding: 20px 0;
    }
    .site-footer {
      border-top: 1px solid #eee;
      padding: 30px 0;
      margin-top: 60px;
    }
    .footer-col-wrapper {
      display: flex;
      flex-wrap: wrap;
    }
    .footer-col {
      flex: 1;
      min-width: 200px;
      padding-right: 20px;
    }
    code {
      background-color: #f5f5f5;
      padding: 2px 5px;
      border-radius: 3px;
    }
    pre {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
    .highlight {
      background-color: #f5f5f5;
      border-radius: 5px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px 12px;
    }
    th {
      background-color: #f5f5f5;
      text-align: left;
    }
    button, .button {
      display: inline-block;
      background-color: #1a73e8;
      color: white !important;
      padding: 10px 20px;
      border-radius: 4px;
      font-weight: bold;
      margin-top: 20px;
      border: none;
      cursor: pointer;
      text-decoration: none !important;
    }
    button:hover, .button:hover {
      background-color: #0d65d9;
    }
    .feature {
      background-color: #f5f5f5;
      border-radius: 8px;
      padding: 20px;
      border-left: 4px solid #1a73e8;
      margin-bottom: 20px;
    }
    
    @media screen and (max-width: 600px) {
      .site-nav {
        position: absolute;
        top: 70px;
        right: 20px;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        text-align: right;
        padding: 0;
        z-index: 1;
      }
      .site-nav .page-link {
        display: block;
        padding: 10px;
        margin: 0;
      }
      .site-nav .menu-icon {
        display: block;
        float: right;
        width: 36px;
        height: 26px;
        line-height: 0;
        padding-top: 10px;
        text-align: center;
      }
      .site-nav .trigger {
        clear: both;
        display: none;
      }
      .site-nav input:checked ~ .trigger {
        display: block;
        padding-bottom: 5px;
      }
      .footer-col-wrapper {
        flex-direction: column;
      }
      .footer-col {
        margin-bottom: 20px;
      }
    }
  </style>
</head><body>
    <div class="wrapper">
      <header class="site-header">
        <div class="container">
          <h1 class="site-title"><a href="/practical-meta-audiocraft/">Practical Meta AudioCraft</a></h1>
          <nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
              <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                  <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484c0-0.82,0.665-1.485,1.484-1.485 h15.032C17.335,0,18,0.665,18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516 c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,6.031,18,6.696,18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516c0-0.82,0.665-1.483,1.484-1.483h15.032 C17.335,12.031,18,12.696,18,13.516z"/>
                </svg>
              </span>
            </label>

            <div class="trigger">
              <a class="page-link" href="/practical-meta-audiocraft/">Home</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part1/introduction/">Getting Started</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part2/basic-music/">MusicGen</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part3/introduction-to-audiogen/">AudioGen</a>
              <a class="page-link" href="/practical-meta-audiocraft/tutorials/getting-started/">Tutorials</a>
            </div>
          </nav>
        </div>
      </header>

      <main class="page-content" aria-label="Content">
        <div class="container">
          <div class="chapter">
  <div class="chapter-header">
    <div class="chapter-metadata">
      <span class="difficulty beginner">Beginner</span>
      <span class="estimated-time">2 hours</span>
    </div>
    <h1>Chapter 2: Setting Up Your Environment</h1>
  </div>
  
  
  <div class="scenario-quote">
    <blockquote>
      <p>"I'm excited to try generating AI audio, but I've hit a roadblock with the setup. I'm not sure which version of Python to use, how to handle GPU support, or why I'm getting dependency errors. I just want a reliable environment where I can experiment without fighting with installation issues."</p>
      <cite>— Jordan Kim, Game Developer</cite>
    </blockquote>
  </div>
  
  
  <h1 id="chapter-2-setting-up-your-environment">Chapter 2: Setting Up Your Environment</h1>

<h2 id="the-challenge">The Challenge</h2>

<p>Setting up a proper development environment for AI audio generation can be surprisingly challenging. Unlike standard Python applications, machine learning frameworks like AudioCraft require specific versions of PyTorch, CUDA drivers for NVIDIA GPUs, or Metal Performance Shaders for Apple Silicon. Getting these dependencies right is crucial for performance—the difference between waiting 30 seconds or 10 minutes for a generation can be simply having the right environment configuration.</p>

<p>While AudioCraft itself can be installed with a single pip command, ensuring it runs efficiently requires careful setup of the underlying machine learning infrastructure. The process varies significantly between operating systems and hardware configurations, making it easy to fall into compatibility pitfalls.</p>

<p>In this chapter, we’ll establish a robust, efficient environment for AudioCraft that will serve as the foundation for all our future work. We’ll cover multiple hardware configurations (CPU, NVIDIA GPU, and Apple Silicon) across different operating systems, ensuring you get optimal performance from your specific setup.</p>

<h2 id="learning-objectives">Learning Objectives</h2>

<p>By the end of this chapter, you’ll be able to:</p>

<ul>
  <li>Create an isolated Python environment for AudioCraft</li>
  <li>Install the correct PyTorch version for your hardware</li>
  <li>Set up AudioCraft with all dependencies</li>
  <li>Configure GPU acceleration (if applicable)</li>
  <li>Verify your environment works correctly</li>
  <li>Troubleshoot common installation issues</li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<p>Before we begin, make sure you have:</p>

<ul>
  <li>Administrative access to your computer (for installing software)</li>
  <li>At least 5GB of free disk space</li>
  <li>Internet connection for downloading packages</li>
  <li>Basic familiarity with command line operations</li>
</ul>

<h2 id="environment-setup-strategies">Environment Setup Strategies</h2>

<p>There are multiple ways to set up a Python environment for AudioCraft. We’ll cover three main approaches:</p>

<h3 id="1-conda-environment-recommended">1. Conda Environment (Recommended)</h3>

<p>Using Conda provides the most reliable isolation and dependency management across all platforms. This approach:</p>

<ul>
  <li>Creates a fully isolated environment</li>
  <li>Handles complex dependencies automatically</li>
  <li>Works consistently across platforms</li>
  <li>Makes it easy to switch between projects</li>
</ul>

<h3 id="2-virtual-environment-with-venv">2. Virtual Environment with venv</h3>

<p>Python’s built-in venv module provides a lighter-weight alternative:</p>

<ul>
  <li>Creates a basic isolated environment</li>
  <li>Requires more manual dependency management</li>
  <li>Uses less disk space than Conda</li>
  <li>Works well for simpler setups</li>
</ul>

<h3 id="3-direct-installation">3. Direct Installation</h3>

<p>While not recommended for most users, direct installation is the simplest approach:</p>

<ul>
  <li>Installs packages in your system Python</li>
  <li>May cause conflicts with other projects</li>
  <li>Requires less initial setup</li>
  <li>More likely to encounter dependency issues</li>
</ul>

<p>We’ll focus primarily on the Conda approach as it offers the best balance of reliability and ease of use, while noting differences for the other methods where relevant.</p>

<h2 id="hardware-specific-setup">Hardware-Specific Setup</h2>

<p>AudioCraft’s performance varies significantly based on your hardware. Let’s explore the setup process for different configurations.</p>

<h3 id="setting-up-for-nvidia-gpus-windowslinux">Setting Up for NVIDIA GPUs (Windows/Linux)</h3>

<p>NVIDIA GPUs with CUDA support offer the fastest generation times for AudioCraft. Here’s how to set up your environment for NVIDIA hardware:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. Install Miniconda (if not already installed)
# Download from https://docs.conda.io/en/latest/miniconda.html
</span>
<span class="c1"># 2. Create a new Conda environment
</span><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">audiocraft</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.9</span>
<span class="n">conda</span> <span class="n">activate</span> <span class="n">audiocraft</span>

<span class="c1"># 3. Install PyTorch with CUDA support
# For CUDA 11.8 (most common)
</span><span class="n">conda</span> <span class="n">install</span> <span class="n">pytorch</span><span class="o">==</span><span class="mf">2.1</span><span class="p">.</span><span class="mi">0</span> <span class="n">torchaudio</span><span class="o">==</span><span class="mf">2.1</span><span class="p">.</span><span class="mi">0</span> <span class="n">pytorch</span><span class="o">-</span><span class="n">cuda</span><span class="o">=</span><span class="mf">11.8</span> <span class="o">-</span><span class="n">c</span> <span class="n">pytorch</span> <span class="o">-</span><span class="n">c</span> <span class="n">nvidia</span>

<span class="c1"># 4. Install AudioCraft
</span><span class="n">pip</span> <span class="n">install</span> <span class="n">audiocraft</span>
</code></pre></div></div>

<h4 id="important-nvidia-specific-considerations">Important NVIDIA-Specific Considerations:</h4>

<ol>
  <li>
    <p><strong>CUDA Version</strong>: Ensure your NVIDIA driver supports the CUDA version you install. You can check your driver’s supported CUDA version with <code class="language-plaintext highlighter-rouge">nvidia-smi</code>.</p>
  </li>
  <li><strong>Memory Requirements</strong>: AudioCraft models have different VRAM requirements:
    <ul>
      <li>Small model: ~2GB VRAM</li>
      <li>Medium model: ~4GB VRAM</li>
      <li>Large model: ~8GB VRAM</li>
    </ul>
  </li>
  <li><strong>Windows-Specific Note</strong>: On Windows, you may need to install Visual C++ Build Tools if you encounter compilation errors.</li>
</ol>

<h3 id="setting-up-for-apple-silicon-m1m2m3m4-macs">Setting Up for Apple Silicon (M1/M2/M3/M4 Macs)</h3>

<p>Apple Silicon Macs use Metal Performance Shaders (MPS) for GPU acceleration:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. Install Miniconda (if not already installed)
# Download from https://docs.conda.io/en/latest/miniconda.html
</span>
<span class="c1"># 2. Create a new Conda environment
</span><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">audiocraft</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.9</span>
<span class="n">conda</span> <span class="n">activate</span> <span class="n">audiocraft</span>

<span class="c1"># 3. Install PyTorch with MPS support
</span><span class="n">pip</span> <span class="n">install</span> <span class="n">torch</span><span class="o">==</span><span class="mf">2.1</span><span class="p">.</span><span class="mi">0</span> <span class="n">torchaudio</span><span class="o">==</span><span class="mf">2.1</span><span class="p">.</span><span class="mi">0</span>

<span class="c1"># 4. Install AudioCraft
</span><span class="n">pip</span> <span class="n">install</span> <span class="n">audiocraft</span>
</code></pre></div></div>

<h4 id="important-apple-silicon-considerations">Important Apple Silicon Considerations:</h4>

<ol>
  <li>
    <p><strong>Metal Device</strong>: PyTorch automatically uses the Metal device when available. You’ll access it with <code class="language-plaintext highlighter-rouge">device = "mps"</code> in your code.</p>
  </li>
  <li><strong>Performance</strong>: While not as fast as high-end NVIDIA GPUs, M-series chips provide significant acceleration compared to CPU. Expect:
    <ul>
      <li>M1: 2-3x faster than CPU</li>
      <li>M2: 3-4x faster than CPU</li>
      <li>M3/M4: 4-5x faster than CPU</li>
    </ul>
  </li>
  <li><strong>Memory Sharing</strong>: MPS uses shared memory with your system RAM, so ensure you have sufficient free memory (at least 8GB recommended, 16GB preferred).</li>
</ol>

<h3 id="setting-up-for-cpu-only-all-platforms">Setting Up for CPU-Only (All Platforms)</h3>

<p>If you don’t have a compatible GPU, you can still run AudioCraft on CPU:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. Install Miniconda (if not already installed)
# Download from https://docs.conda.io/en/latest/miniconda.html
</span>
<span class="c1"># 2. Create a new Conda environment
</span><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">audiocraft</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.9</span>
<span class="n">conda</span> <span class="n">activate</span> <span class="n">audiocraft</span>

<span class="c1"># 3. Install PyTorch CPU version
</span><span class="n">pip</span> <span class="n">install</span> <span class="n">torch</span><span class="o">==</span><span class="mf">2.1</span><span class="p">.</span><span class="mi">0</span> <span class="n">torchaudio</span><span class="o">==</span><span class="mf">2.1</span><span class="p">.</span><span class="mi">0</span> <span class="o">--</span><span class="n">index</span><span class="o">-</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="p">.</span><span class="n">pytorch</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">whl</span><span class="o">/</span><span class="n">cpu</span>

<span class="c1"># 4. Install AudioCraft
</span><span class="n">pip</span> <span class="n">install</span> <span class="n">audiocraft</span>
</code></pre></div></div>

<h4 id="important-cpu-considerations">Important CPU Considerations:</h4>

<ol>
  <li><strong>Performance</strong>: CPU generation is significantly slower:
    <ul>
      <li>Small model: 1-2 minutes per 10-second clip</li>
      <li>Medium model: 3-5 minutes per 10-second clip</li>
      <li>Large model: 8-15 minutes per 10-second clip</li>
    </ul>
  </li>
  <li><strong>Memory Usage</strong>: CPU generation uses more system RAM:
    <ul>
      <li>Small model: ~4GB RAM</li>
      <li>Medium model: ~8GB RAM</li>
      <li>Large model: ~16GB RAM</li>
    </ul>
  </li>
  <li><strong>Optimization</strong>: The smaller models are strongly recommended for CPU-only setups.</li>
</ol>

<h2 id="step-by-step-installation-guide">Step-by-Step Installation Guide</h2>

<p>Now let’s walk through a complete installation process that will work for most users.</p>

<h3 id="1-installing-miniconda">1. Installing Miniconda</h3>

<p>Miniconda gives us a lightweight Python distribution with the Conda package manager:</p>

<h4 id="windows">Windows:</h4>
<ol>
  <li>Download the Miniconda installer from <a href="https://docs.conda.io/en/latest/miniconda.html">the official site</a></li>
  <li>Run the installer and follow the prompts</li>
  <li>Select “Add Miniconda to PATH” when prompted</li>
  <li>Open a new Command Prompt or PowerShell window</li>
</ol>

<h4 id="macos">macOS:</h4>
<ol>
  <li>Download the Miniconda installer from <a href="https://docs.conda.io/en/latest/miniconda.html">the official site</a></li>
  <li>Open Terminal and navigate to the download location</li>
  <li>Run <code class="language-plaintext highlighter-rouge">bash Miniconda3-latest-MacOSX-arm64.sh</code> (for Apple Silicon) or <code class="language-plaintext highlighter-rouge">bash Miniconda3-latest-MacOSX-x86_64.sh</code> (for Intel)</li>
  <li>Follow the prompts and let it initialize Conda</li>
  <li>Close and reopen Terminal</li>
</ol>

<h4 id="linux">Linux:</h4>
<ol>
  <li>Download the Miniconda installer from <a href="https://docs.conda.io/en/latest/miniconda.html">the official site</a></li>
  <li>Open a terminal and navigate to the download location</li>
  <li>Run <code class="language-plaintext highlighter-rouge">bash Miniconda3-latest-Linux-x86_64.sh</code></li>
  <li>Follow the prompts and let it initialize Conda</li>
  <li>Close and reopen your terminal</li>
</ol>

<h3 id="2-creating-a-conda-environment">2. Creating a Conda Environment</h3>

<p>Now we’ll create an isolated environment for AudioCraft:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create a new environment with Python 3.9</span>
conda create <span class="nt">-n</span> audiocraft <span class="nv">python</span><span class="o">=</span>3.9

<span class="c"># Activate the environment</span>
conda activate audiocraft
</code></pre></div></div>

<p>You should see <code class="language-plaintext highlighter-rouge">(audiocraft)</code> at the beginning of your command prompt, indicating the environment is active.</p>

<h3 id="3-installing-pytorch">3. Installing PyTorch</h3>

<p>Next, we’ll install PyTorch with the appropriate configuration for your hardware:</p>

<h4 id="for-nvidia-gpus">For NVIDIA GPUs:</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Check your CUDA version first (if you have the NVIDIA toolkit installed)</span>
nvcc <span class="nt">--version</span>

<span class="c"># For CUDA 11.8</span>
conda <span class="nb">install </span><span class="nv">pytorch</span><span class="o">==</span>2.1.0 <span class="nv">torchaudio</span><span class="o">==</span>2.1.0 pytorch-cuda<span class="o">=</span>11.8 <span class="nt">-c</span> pytorch <span class="nt">-c</span> nvidia

<span class="c"># For CUDA 12.1</span>
conda <span class="nb">install </span><span class="nv">pytorch</span><span class="o">==</span>2.1.0 <span class="nv">torchaudio</span><span class="o">==</span>2.1.0 pytorch-cuda<span class="o">=</span>12.1 <span class="nt">-c</span> pytorch <span class="nt">-c</span> nvidia
</code></pre></div></div>

<h4 id="for-apple-silicon">For Apple Silicon:</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span><span class="nv">torch</span><span class="o">==</span>2.1.0 <span class="nv">torchaudio</span><span class="o">==</span>2.1.0
</code></pre></div></div>

<h4 id="for-cpu-only">For CPU-only:</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span><span class="nv">torch</span><span class="o">==</span>2.1.0 <span class="nv">torchaudio</span><span class="o">==</span>2.1.0 <span class="nt">--index-url</span> https://download.pytorch.org/whl/cpu
</code></pre></div></div>

<h3 id="4-installing-audiocraft">4. Installing AudioCraft</h3>

<p>With PyTorch properly installed, we can now install AudioCraft:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>audiocraft
</code></pre></div></div>

<p>This command installs the latest stable version of AudioCraft and its dependencies.</p>

<h3 id="5-installing-additional-helpful-packages">5. Installing Additional Helpful Packages</h3>

<p>Let’s add a few packages that will be useful throughout this book:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># For visualization and audio playback</span>
pip <span class="nb">install </span>matplotlib jupyterlab ipywidgets

<span class="c"># For web interfaces (we'll use this in later chapters)</span>
pip <span class="nb">install </span>gradio

<span class="c"># For audio processing</span>
pip <span class="nb">install </span>librosa soundfile
</code></pre></div></div>

<h2 id="testing-your-installation">Testing Your Installation</h2>

<p>Let’s verify everything works correctly by running a simple test:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a file named test_audiocraft.py with the following content
</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchaudio</span>
<span class="kn">from</span> <span class="nn">audiocraft.models</span> <span class="kn">import</span> <span class="n">MusicGen</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">test_installation</span><span class="p">():</span>
    <span class="c1"># Check PyTorch installation
</span>    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"PyTorch version: </span><span class="si">{</span><span class="n">torch</span><span class="p">.</span><span class="n">__version__</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Torchaudio version: </span><span class="si">{</span><span class="n">torchaudio</span><span class="p">.</span><span class="n">__version__</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="c1"># Check device availability
</span>    <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cuda"</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"CUDA available: </span><span class="si">{</span><span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">get_device_name</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"CUDA version: </span><span class="si">{</span><span class="n">torch</span><span class="p">.</span><span class="n">version</span><span class="p">.</span><span class="n">cuda</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">torch</span><span class="p">.</span><span class="n">backends</span><span class="p">.</span><span class="n">mps</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"mps"</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"MPS (Metal Performance Shaders) available"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cpu"</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Using CPU (no GPU acceleration available)"</span><span class="p">)</span>
    
    <span class="c1"># Load a small model to test
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Loading MusicGen 'small' model (this might take a moment)..."</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MusicGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="s">'small'</span><span class="p">)</span>
    <span class="n">model</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">load_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Model loaded in </span><span class="si">{</span><span class="n">load_time</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds"</span><span class="p">)</span>
    
    <span class="c1"># Generate a tiny sample
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Generating a short test sample..."</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># Just 1 second for testing
</span>    <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">([</span><span class="s">"A short test melody"</span><span class="p">])</span>
    <span class="n">generation_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generation completed in </span><span class="si">{</span><span class="n">generation_time</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Installation test successful!"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">"device"</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span>
        <span class="s">"load_time"</span><span class="p">:</span> <span class="n">load_time</span><span class="p">,</span>
        <span class="s">"generation_time"</span><span class="p">:</span> <span class="n">generation_time</span>
    <span class="p">}</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">test_installation</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Performance Summary:"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Device: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s">'device'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Model load time: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s">'load_time'</span><span class="p">]:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generation time: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s">'generation_time'</span><span class="p">]:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds"</span><span class="p">)</span>
</code></pre></div></div>

<p>Run this script to test your installation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python test_audiocraft.py
</code></pre></div></div>

<p>You should see output showing your PyTorch version, available devices, and timing information for loading the model and generating a sample.</p>

<h3 id="expected-output">Expected Output</h3>

<p>The output will vary depending on your hardware, but here’s what you might expect:</p>

<h4 id="on-an-nvidia-gpu-system">On an NVIDIA GPU system:</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PyTorch version: 2.1.0
Torchaudio version: 2.1.0
CUDA available: NVIDIA GeForce RTX 3080
CUDA version: 11.8
Loading MusicGen 'small' model (this might take a moment)...
Model loaded in 5.43 seconds
Generating a short test sample...
Generation completed in 3.21 seconds
Installation test successful!

Performance Summary:
Device: cuda
Model load time: 5.43 seconds
Generation time: 3.21 seconds
</code></pre></div></div>

<h4 id="on-an-apple-silicon-mac">On an Apple Silicon Mac:</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PyTorch version: 2.1.0
Torchaudio version: 2.1.0
MPS (Metal Performance Shaders) available
Loading MusicGen 'small' model (this might take a moment)...
Model loaded in 7.82 seconds
Generating a short test sample...
Generation completed in 6.35 seconds
Installation test successful!

Performance Summary:
Device: mps
Model load time: 7.82 seconds
Generation time: 6.35 seconds
</code></pre></div></div>

<h4 id="on-a-cpu-only-system">On a CPU-only system:</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PyTorch version: 2.1.0
Torchaudio version: 2.1.0
Using CPU (no GPU acceleration available)
Loading MusicGen 'small' model (this might take a moment)...
Model loaded in 12.47 seconds
Generating a short test sample...
Generation completed in 26.18 seconds
Installation test successful!

Performance Summary:
Device: cpu
Model load time: 12.47 seconds
Generation time: 26.18 seconds
</code></pre></div></div>

<h2 id="common-installation-issues-and-solutions">Common Installation Issues and Solutions</h2>

<p>Let’s troubleshoot some common issues you might encounter during installation:</p>

<h3 id="cuda-not-found">CUDA Not Found</h3>

<p><strong>Problem</strong>: You have an NVIDIA GPU, but PyTorch doesn’t recognize it.</p>

<p><strong>Solutions</strong>:</p>
<ol>
  <li>Check that your NVIDIA driver is up-to-date:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nvidia-smi
</code></pre></div>    </div>
  </li>
  <li>Ensure you installed the correct CUDA version:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-c</span> <span class="s2">"import torch; print(torch.version.cuda)"</span>
</code></pre></div>    </div>
  </li>
  <li>Try reinstalling PyTorch with explicit CUDA version:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip uninstall <span class="nt">-y</span> torch torchaudio
conda <span class="nb">install </span><span class="nv">pytorch</span><span class="o">==</span>2.1.0 <span class="nv">torchaudio</span><span class="o">==</span>2.1.0 pytorch-cuda<span class="o">=</span>11.8 <span class="nt">-c</span> pytorch <span class="nt">-c</span> nvidia
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="mps-device-not-available-on-apple-silicon">MPS Device Not Available on Apple Silicon</h3>

<p><strong>Problem</strong>: You have an M-series Mac, but PyTorch doesn’t recognize the MPS device.</p>

<p><strong>Solutions</strong>:</p>
<ol>
  <li>Check that you’re using Python 3.9 or newer:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">--version</span>
</code></pre></div>    </div>
  </li>
  <li>Ensure you have PyTorch 2.0.0 or newer:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-c</span> <span class="s2">"import torch; print(torch.__version__)"</span>
</code></pre></div>    </div>
  </li>
  <li>Reinstall PyTorch:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip uninstall <span class="nt">-y</span> torch torchaudio
pip <span class="nb">install </span><span class="nv">torch</span><span class="o">==</span>2.1.0 <span class="nv">torchaudio</span><span class="o">==</span>2.1.0
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="out-of-memory-errors">Out of Memory Errors</h3>

<p><strong>Problem</strong>: You get CUDA out of memory errors or system crashes.</p>

<p><strong>Solutions</strong>:</p>
<ol>
  <li>Use a smaller model:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span> <span class="o">=</span> <span class="n">MusicGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="s">'small'</span><span class="p">)</span>  <span class="c1"># Instead of 'medium' or 'large'
</span></code></pre></div>    </div>
  </li>
  <li>Generate shorter audio segments:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>  <span class="c1"># Instead of 10.0 or higher
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Close other GPU-intensive applications</p>
  </li>
  <li>Clear cache between generations:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">empty_cache</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="dependencies-conflict">Dependencies Conflict</h3>

<p><strong>Problem</strong>: You get errors about conflicting dependencies.</p>

<p><strong>Solutions</strong>:</p>
<ol>
  <li>Start with a fresh environment:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda create <span class="nt">-n</span> audiocraft_new <span class="nv">python</span><span class="o">=</span>3.9
conda activate audiocraft_new
<span class="c"># Reinstall following the steps above</span>
</code></pre></div>    </div>
  </li>
  <li>Install dependencies in the correct order:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install PyTorch first</span>
conda <span class="nb">install </span><span class="nv">pytorch</span><span class="o">==</span>2.1.0 <span class="nv">torchaudio</span><span class="o">==</span>2.1.0 <span class="nt">-c</span> pytorch
   
<span class="c"># Then AudioCraft</span>
pip <span class="nb">install </span>audiocraft
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="environment-management-best-practices">Environment Management Best Practices</h2>

<p>To keep your AudioCraft environment healthy, follow these best practices:</p>

<h3 id="activating-and-deactivating">Activating and Deactivating</h3>

<p>Always activate your environment before working with AudioCraft:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Activate</span>
conda activate audiocraft

<span class="c"># Deactivate when done</span>
conda deactivate
</code></pre></div></div>

<h3 id="keeping-track-of-dependencies">Keeping Track of Dependencies</h3>

<p>Save your environment configuration to recreate it later:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Export environment</span>
conda <span class="nb">env export</span> <span class="o">&gt;</span> audiocraft_environment.yml

<span class="c"># Recreate environment from file</span>
conda <span class="nb">env </span>create <span class="nt">-f</span> audiocraft_environment.yml
</code></pre></div></div>

<h3 id="updating-safely">Updating Safely</h3>

<p>Update packages cautiously to avoid breaking changes:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Update AudioCraft only</span>
pip <span class="nb">install</span> <span class="nt">--upgrade</span> audiocraft

<span class="c"># Update PyTorch safely</span>
pip <span class="nb">install</span> <span class="nt">--upgrade</span> <span class="nv">torch</span><span class="o">==</span>2.1.0 <span class="nv">torchaudio</span><span class="o">==</span>2.1.0
</code></pre></div></div>

<h2 id="hardware-specific-optimizations">Hardware-Specific Optimizations</h2>

<p>To get the best performance from your specific hardware:</p>

<h3 id="nvidia-gpu-optimizations">NVIDIA GPU Optimizations</h3>

<ol>
  <li><strong>Precision Settings</strong>: Lower precision can be faster:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Use mixed precision (faster with minimal quality loss)
</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="n">float16</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Memory Management</strong>: Monitor GPU memory:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Check available memory
</span><span class="n">free_memory</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">get_device_properties</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">total_memory</span> <span class="o">-</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">memory_allocated</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Free CUDA memory: </span><span class="si">{</span><span class="n">free_memory</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> GB"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="apple-silicon-optimizations">Apple Silicon Optimizations</h3>

<ol>
  <li><strong>Memory Sharing</strong>: Be mindful of system memory usage as MPS shares RAM:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Free up memory between generations
</span><span class="kn">import</span> <span class="nn">gc</span>
<span class="n">torch</span><span class="p">.</span><span class="n">mps</span><span class="p">.</span><span class="n">empty_cache</span><span class="p">()</span>
<span class="n">gc</span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Battery Considerations</strong>: GPU acceleration uses more power:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># For battery-sensitive scenarios, consider CPU for small models
</span><span class="k">if</span> <span class="n">battery_saving_mode</span><span class="p">:</span>
    <span class="n">device</span> <span class="o">=</span> <span class="s">"cpu"</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">device</span> <span class="o">=</span> <span class="s">"mps"</span> <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">backends</span><span class="p">.</span><span class="n">mps</span><span class="p">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s">"cpu"</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="cpu-optimizations">CPU Optimizations</h3>

<ol>
  <li><strong>Thread Control</strong>: Manage CPU thread usage:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Limit threads for better system responsiveness
</span><span class="kn">import</span> <span class="nn">torch</span>
<span class="n">torch</span><span class="p">.</span><span class="n">set_num_threads</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># Adjust based on your CPU
</span></code></pre></div>    </div>
  </li>
  <li><strong>Memory Optimization</strong>: Pre-load and reuse models:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load once, use multiple times
</span><span class="n">model</span> <span class="o">=</span> <span class="n">MusicGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="s">'small'</span><span class="p">)</span>
   
<span class="c1"># Generate multiple outputs with the same model
</span><span class="k">for</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="n">prompts</span><span class="p">:</span>
    <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">([</span><span class="n">prompt</span><span class="p">])</span>
    <span class="c1"># Save or process each result
</span></code></pre></div>    </div>
  </li>
</ol>

<h2 id="complete-installation-script">Complete Installation Script</h2>

<p>Here’s a comprehensive script that automates the installation process for any platform:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# audiocraft_setup.py - Complete AudioCraft environment setup script
</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">def</span> <span class="nf">run_command</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="s">"""Run a shell command and print output."""</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Running: </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">detect_system</span><span class="p">():</span>
    <span class="s">"""Detect operating system and hardware."""</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span>
    <span class="n">machine</span> <span class="o">=</span> <span class="n">platform</span><span class="p">.</span><span class="n">machine</span><span class="p">()</span>
    
    <span class="n">is_windows</span> <span class="o">=</span> <span class="n">system</span> <span class="o">==</span> <span class="s">"Windows"</span>
    <span class="n">is_macos</span> <span class="o">=</span> <span class="n">system</span> <span class="o">==</span> <span class="s">"Darwin"</span>
    <span class="n">is_linux</span> <span class="o">=</span> <span class="n">system</span> <span class="o">==</span> <span class="s">"Linux"</span>
    
    <span class="n">is_apple_silicon</span> <span class="o">=</span> <span class="n">is_macos</span> <span class="ow">and</span> <span class="n">machine</span> <span class="o">==</span> <span class="s">"arm64"</span>
    
    <span class="c1"># Check for NVIDIA GPU
</span>    <span class="n">has_nvidia</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">is_windows</span> <span class="ow">or</span> <span class="n">is_linux</span><span class="p">:</span>
        <span class="n">nvidia_smi</span> <span class="o">=</span> <span class="n">shutil</span><span class="p">.</span><span class="n">which</span><span class="p">(</span><span class="s">"nvidia-smi"</span><span class="p">)</span>
        <span class="n">has_nvidia</span> <span class="o">=</span> <span class="n">nvidia_smi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">run_command</span><span class="p">(</span><span class="s">"nvidia-smi"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">"is_windows"</span><span class="p">:</span> <span class="n">is_windows</span><span class="p">,</span>
        <span class="s">"is_macos"</span><span class="p">:</span> <span class="n">is_macos</span><span class="p">,</span>
        <span class="s">"is_linux"</span><span class="p">:</span> <span class="n">is_linux</span><span class="p">,</span>
        <span class="s">"is_apple_silicon"</span><span class="p">:</span> <span class="n">is_apple_silicon</span><span class="p">,</span>
        <span class="s">"has_nvidia"</span><span class="p">:</span> <span class="n">has_nvidia</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">setup_environment</span><span class="p">():</span>
    <span class="s">"""Set up the AudioCraft environment based on detected system."""</span>
    <span class="n">sys_info</span> <span class="o">=</span> <span class="n">detect_system</span><span class="p">()</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">=== System Detection ==="</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Operating System: </span><span class="si">{</span><span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">platform</span><span class="p">.</span><span class="n">release</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Machine Architecture: </span><span class="si">{</span><span class="n">platform</span><span class="p">.</span><span class="n">machine</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"NVIDIA GPU Available: </span><span class="si">{</span><span class="s">'Yes'</span> <span class="k">if</span> <span class="n">sys_info</span><span class="p">[</span><span class="s">'has_nvidia'</span><span class="p">]</span> <span class="k">else</span> <span class="s">'No'</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sys_info</span><span class="p">[</span><span class="s">'is_apple_silicon'</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Apple Silicon Mac detected"</span><span class="p">)</span>
    
    <span class="c1"># Check if conda is available
</span>    <span class="n">conda_available</span> <span class="o">=</span> <span class="n">shutil</span><span class="p">.</span><span class="n">which</span><span class="p">(</span><span class="s">"conda"</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">conda_available</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Conda not found. Please install Miniconda from:"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"https://docs.conda.io/en/latest/miniconda.html"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    
    <span class="c1"># Create conda environment
</span>    <span class="n">env_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Enter environment name (default: audiocraft): "</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span> <span class="ow">or</span> <span class="s">"audiocraft"</span>
    
    <span class="k">if</span> <span class="n">run_command</span><span class="p">(</span><span class="sa">f</span><span class="s">"conda env list | grep </span><span class="si">{</span><span class="n">env_name</span><span class="si">}</span><span class="s">"</span><span class="p">):</span>
        <span class="n">action</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s">"Environment '</span><span class="si">{</span><span class="n">env_name</span><span class="si">}</span><span class="s">' already exists. [r]ecreate, [u]se existing, or [c]ancel? "</span><span class="p">).</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s">'c'</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
            <span class="n">run_command</span><span class="p">(</span><span class="sa">f</span><span class="s">"conda env remove -n </span><span class="si">{</span><span class="n">env_name</span><span class="si">}</span><span class="s"> -y"</span><span class="p">)</span>
        <span class="c1"># else use existing
</span>    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">run_command</span><span class="p">(</span><span class="sa">f</span><span class="s">"conda info --envs | grep </span><span class="si">{</span><span class="n">env_name</span><span class="si">}</span><span class="s">"</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="se">\n</span><span class="s">Creating new environment: </span><span class="si">{</span><span class="n">env_name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="n">run_command</span><span class="p">(</span><span class="sa">f</span><span class="s">"conda create -n </span><span class="si">{</span><span class="n">env_name</span><span class="si">}</span><span class="s"> python=3.9 -y"</span><span class="p">)</span>
    
    <span class="c1"># Get activation command
</span>    <span class="k">if</span> <span class="n">sys_info</span><span class="p">[</span><span class="s">'is_windows'</span><span class="p">]:</span>
        <span class="n">activate_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"conda activate </span><span class="si">{</span><span class="n">env_name</span><span class="si">}</span><span class="s">"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">activate_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"source activate </span><span class="si">{</span><span class="n">env_name</span><span class="si">}</span><span class="s">"</span>
    
    <span class="c1"># Install PyTorch based on hardware
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">=== Installing PyTorch ==="</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">sys_info</span><span class="p">[</span><span class="s">'has_nvidia'</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Installing PyTorch with CUDA support"</span><span class="p">)</span>
        <span class="n">torch_install</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">activate_cmd</span><span class="si">}</span><span class="s"> &amp;&amp; conda install pytorch==2.1.0 torchaudio==2.1.0 pytorch-cuda=11.8 -c pytorch -c nvidia -y"</span>
    <span class="k">elif</span> <span class="n">sys_info</span><span class="p">[</span><span class="s">'is_apple_silicon'</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Installing PyTorch with Metal support for Apple Silicon"</span><span class="p">)</span>
        <span class="n">torch_install</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">activate_cmd</span><span class="si">}</span><span class="s"> &amp;&amp; pip install torch==2.1.0 torchaudio==2.1.0"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Installing PyTorch for CPU"</span><span class="p">)</span>
        <span class="n">torch_install</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">activate_cmd</span><span class="si">}</span><span class="s"> &amp;&amp; pip install torch==2.1.0 torchaudio==2.1.0 --index-url https://download.pytorch.org/whl/cpu"</span>
    
    <span class="n">run_command</span><span class="p">(</span><span class="n">torch_install</span><span class="p">)</span>
    
    <span class="c1"># Install AudioCraft
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">=== Installing AudioCraft ==="</span><span class="p">)</span>
    <span class="n">run_command</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">activate_cmd</span><span class="si">}</span><span class="s"> &amp;&amp; pip install audiocraft"</span><span class="p">)</span>
    
    <span class="c1"># Install additional packages
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">=== Installing Additional Packages ==="</span><span class="p">)</span>
    <span class="n">run_command</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">activate_cmd</span><span class="si">}</span><span class="s"> &amp;&amp; pip install matplotlib jupyterlab ipywidgets gradio librosa soundfile"</span><span class="p">)</span>
    
    <span class="c1"># Create test script
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">=== Creating Test Script ==="</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"test_audiocraft.py"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"""
import torch
import torchaudio
from audiocraft.models import MusicGen
import time

def test_installation():
    # Check PyTorch installation
    print(f"PyTorch version: {torch.__version__}")
    print(f"Torchaudio version: {torchaudio.__version__}")
    
    # Check device availability
    if torch.cuda.is_available():
        device = "cuda"
        print(f"CUDA available: {torch.cuda.get_device_name(0)}")
        print(f"CUDA version: {torch.version.cuda}")
    elif torch.backends.mps.is_available():
        device = "mps"
        print("MPS (Metal Performance Shaders) available")
    else:
        device = "cpu"
        print("Using CPU (no GPU acceleration available)")
    
    # Load a small model to test
    print("Loading MusicGen 'small' model (this might take a moment)...")
    start_time = time.time()
    model = MusicGen.get_pretrained('small')
    model.to(device)
    load_time = time.time() - start_time
    print(f"Model loaded in {load_time:.2f} seconds")
    
    # Generate a tiny sample
    print("Generating a short test sample...")
    start_time = time.time()
    model.set_generation_params(duration=1.0)  # Just 1 second for testing
    wav = model.generate(["A short test melody"])
    generation_time = time.time() - start_time
    print(f"Generation completed in {generation_time:.2f} seconds")
    print("Installation test successful!")
    
    return {
        "device": device,
        "load_time": load_time,
        "generation_time": generation_time
    }

if __name__ == "__main__":
    results = test_installation()
    print("</span><span class="se">\\</span><span class="s">nPerformance Summary:")
    print(f"Device: {results['device']}")
    print(f"Model load time: {results['load_time']:.2f} seconds")
    print(f"Generation time: {results['generation_time']:.2f} seconds")
"""</span><span class="p">)</span>
    
    <span class="c1"># Create activation script
</span>    <span class="k">if</span> <span class="n">sys_info</span><span class="p">[</span><span class="s">'is_windows'</span><span class="p">]:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"activate_audiocraft.bat"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">"@echo off</span><span class="se">\n</span><span class="s">call conda activate </span><span class="si">{</span><span class="n">env_name</span><span class="si">}</span><span class="se">\n</span><span class="s">echo AudioCraft environment activated. Run 'python test_audiocraft.py' to test."</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Created activation script: activate_audiocraft.bat"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"activate_audiocraft.sh"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">"#!/bin/bash</span><span class="se">\n</span><span class="s">source activate </span><span class="si">{</span><span class="n">env_name</span><span class="si">}</span><span class="se">\n</span><span class="s">echo AudioCraft environment activated. Run 'python test_audiocraft.py' to test."</span><span class="p">)</span>
        <span class="n">run_command</span><span class="p">(</span><span class="s">"chmod +x activate_audiocraft.sh"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Created activation script: activate_audiocraft.sh"</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">=== Setup Complete ==="</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"To activate the environment:  </span><span class="si">{</span><span class="n">activate_cmd</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"To test the installation:     python test_audiocraft.py"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="bp">True</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"=== AudioCraft Environment Setup ==="</span><span class="p">)</span>
    <span class="n">setup_environment</span><span class="p">()</span>
</code></pre></div></div>

<p>You can download this script, save it as <code class="language-plaintext highlighter-rouge">audiocraft_setup.py</code>, and run it with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python audiocraft_setup.py
</code></pre></div></div>

<p>It will detect your system configuration, create an appropriate environment, and set up AudioCraft with the correct dependencies for your hardware.</p>

<h2 id="key-takeaways">Key Takeaways</h2>

<ul>
  <li>The right environment setup is crucial for efficient AudioCraft usage</li>
  <li>Conda provides the most reliable isolation for AudioCraft dependencies</li>
  <li>Hardware-specific configurations can dramatically impact performance</li>
  <li>Testing your installation verifies everything works correctly</li>
  <li>Common installation issues have straightforward solutions</li>
  <li>Different hardware configurations require different optimization strategies</li>
</ul>

<h2 id="next-steps">Next Steps</h2>

<p>Now that you have a properly configured environment for AudioCraft, you’re ready to explore:</p>

<ul>
  <li><a href="/chapters/part1/architecture/">Understanding AudioCraft Architecture</a>: Learn how AudioCraft’s components work together</li>
  <li><a href="/chapters/part1/first-generation/">Your First Audio Generation</a>: Generate your first AI audio with AudioCraft</li>
</ul>

<h2 id="further-reading">Further Reading</h2>

<ul>
  <li><a href="https://pytorch.org/get-started/locally/">PyTorch Installation Guide</a></li>
  <li><a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">Conda Environment Management</a></li>
  <li><a href="https://docs.nvidia.com/cuda/">CUDA Toolkit Documentation</a></li>
  <li><a href="https://developer.apple.com/documentation/metalperformanceshaders">Metal Performance Shaders Documentation</a></li>
</ul>

  
  
  
  
  
  
  <div class="next-steps">
    <h2>Next Steps</h2>
    <p>Now that you've mastered 2 setting up your environment, you're ready to explore:</p>
    <ul>
      
      <li>
        <a href="/chapters/part1/architecture/">Understanding AudioCraft Architecture</a>: Learn how AudioCraft's components work together
      </li>
      
      <li>
        <a href="/chapters/part1/first-generation/">Your First Audio Generation</a>: Generate your first AI audio with AudioCraft
      </li>
      
    </ul>
  </div>
  
  
  
  <div class="further-reading">
    <h2>Further Reading</h2>
    <ul>
      
      <li>
        
        <a href="https://pytorch.org/get-started/locally/" target="_blank">PyTorch Installation Guide</a>
        
        
      </li>
      
      <li>
        
        <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html" target="_blank">Conda Environment Management</a>
        
        
      </li>
      
      <li>
        
        <a href="https://docs.nvidia.com/cuda/" target="_blank">CUDA Toolkit Documentation</a>
        
        
      </li>
      
      <li>
        
        <a href="https://developer.apple.com/documentation/metalperformanceshaders" target="_blank">Metal Performance Shaders Documentation</a>
        
        
      </li>
      
    </ul>
  </div>
  
</div>

<div class="chapter-navigation">
  
  <a href="/chapters/part1/introduction/" class="prev-chapter">
    <span class="nav-label">Previous</span>
    <span class="nav-title">Chapter 1: Introduction to AI Audio Generation</span>
  </a>
  
  
  
  <a href="/chapters/part2/basic-music/" class="next-chapter">
    <span class="nav-label">Next</span>
    <span class="nav-title">Chapter 5: Basic Music Generation</span>
  </a>
  
</div>

<!-- Copyright footer for all chapter pages -->
<div class="copyright-footer">
  <hr>
  <p>
    Copyright © 2025 Scott Friedman.
    <br>
    This work is licensed under the <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.
  </p>
</div>


        </div>
      </main>

      <footer class="site-footer">
        <div class="container">
          <div class="footer-col-wrapper">
            <div class="footer-col">
              <p>A hands-on guide to creating music, sound effects, and audio experiences with AI</p>
              <p>
                <a href="https://github.com/facebookresearch/audiocraft">AudioCraft GitHub Repository</a>
              </p>
            </div>
            <div class="footer-col">
              <p class="copyright">
                Copyright © 2025 Scott Friedman.<br>
                Licensed under <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a>.
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>