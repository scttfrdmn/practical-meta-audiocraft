<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chapter 10: Sound Effect Generation with AudioGen</title>
  <meta name="description" content="A hands-on guide to creating music, sound effects, and audio experiences with AI">
  <link rel="canonical" href="https://scttfrdmn.github.io/practical-meta-audiocraft/SAMPLE_CHAPTER/">
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      margin: 0;
      padding: 0;
    }
    .wrapper {
      max-width: 100%;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 0 20px;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    h1 { color: #1a73e8; }
    h2 { color: #34a853; }
    a {
      color: #1a73e8;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .site-header {
      border-bottom: 1px solid #eee;
      padding: 15px 0;
      margin-bottom: 30px;
    }
    .site-title {
      margin: 0;
      font-size: 1.8rem;
    }
    .site-title a {
      color: #1a73e8;
      text-decoration: none;
    }
    .site-nav {
      float: right;
      margin-top: 10px;
    }
    .site-nav .page-link {
      margin-left: 20px;
    }
    .nav-trigger {
      display: none;
    }
    .menu-icon {
      display: none;
    }
    .page-content {
      padding: 20px 0;
    }
    .site-footer {
      border-top: 1px solid #eee;
      padding: 30px 0;
      margin-top: 60px;
    }
    .footer-col-wrapper {
      display: flex;
      flex-wrap: wrap;
    }
    .footer-col {
      flex: 1;
      min-width: 200px;
      padding-right: 20px;
    }
    code {
      background-color: #f5f5f5;
      padding: 2px 5px;
      border-radius: 3px;
    }
    pre {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
    .highlight {
      background-color: #f5f5f5;
      border-radius: 5px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px 12px;
    }
    th {
      background-color: #f5f5f5;
      text-align: left;
    }
    button, .button {
      display: inline-block;
      background-color: #1a73e8;
      color: white !important;
      padding: 10px 20px;
      border-radius: 4px;
      font-weight: bold;
      margin-top: 20px;
      border: none;
      cursor: pointer;
      text-decoration: none !important;
    }
    button:hover, .button:hover {
      background-color: #0d65d9;
    }
    .feature {
      background-color: #f5f5f5;
      border-radius: 8px;
      padding: 20px;
      border-left: 4px solid #1a73e8;
      margin-bottom: 20px;
    }
    
    @media screen and (max-width: 600px) {
      .site-nav {
        position: absolute;
        top: 70px;
        right: 20px;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        text-align: right;
        padding: 0;
        z-index: 1;
      }
      .site-nav .page-link {
        display: block;
        padding: 10px;
        margin: 0;
      }
      .site-nav .menu-icon {
        display: block;
        float: right;
        width: 36px;
        height: 26px;
        line-height: 0;
        padding-top: 10px;
        text-align: center;
      }
      .site-nav .trigger {
        clear: both;
        display: none;
      }
      .site-nav input:checked ~ .trigger {
        display: block;
        padding-bottom: 5px;
      }
      .footer-col-wrapper {
        flex-direction: column;
      }
      .footer-col {
        margin-bottom: 20px;
      }
    }
  </style>
</head><body>
    <div class="wrapper">
      <header class="site-header">
        <div class="container">
          <h1 class="site-title"><a href="/practical-meta-audiocraft/">Practical Meta AudioCraft</a></h1>
          <nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
              <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                  <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484c0-0.82,0.665-1.485,1.484-1.485 h15.032C17.335,0,18,0.665,18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516 c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,6.031,18,6.696,18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516c0-0.82,0.665-1.483,1.484-1.483h15.032 C17.335,12.031,18,12.696,18,13.516z"/>
                </svg>
              </span>
            </label>

            <div class="trigger">
              <a class="page-link" href="/practical-meta-audiocraft/">Home</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part1/introduction/">Getting Started</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part2/basic-music/">MusicGen</a>
              <a class="page-link" href="/practical-meta-audiocraft/chapters/part3/introduction-to-audiogen/">AudioGen</a>
              <a class="page-link" href="/practical-meta-audiocraft/tutorials/getting-started/">Tutorials</a>
            </div>
          </nav>
        </div>
      </header>

      <main class="page-content" aria-label="Content">
        <div class="container">
          <div class="chapter">
  <div class="chapter-header">
    <div class="chapter-metadata">
      <span class="difficulty beginner">Beginner</span>
      <span class="estimated-time">2 hours</span>
    </div>
    <h1>Chapter 10: Sound Effect Generation with AudioGen</h1>
  </div>
  
  
  
  <blockquote>
  <p>“I’m working on an indie game, and I need dozens of environmental sound effects - rain, wind, footsteps, machinery. I don’t have the budget for a professional sound library, and recording everything myself would take months.” — <em>Maya Chen, Indie Game Developer</em></p>
</blockquote>

<h1 id="chapter-10-sound-effect-generation-with-audiogen">Chapter 10: Sound Effect Generation with AudioGen</h1>

<h2 id="the-challenge">The Challenge</h2>

<p>Creating high-quality, diverse sound effects is a persistent challenge across many creative industries. Professional sound libraries can be expensive, recording sounds requires specialized equipment and environments, and creating synthetic sounds often demands expertise with digital audio workstations. This creates a significant barrier for indie game developers, small film productions, and digital content creators who need custom sound effects but lack the resources for traditional approaches.</p>

<p>AudioGen, part of Meta’s AudioCraft framework, offers an AI-powered solution to this challenge by generating realistic sound effects from text descriptions. In this chapter, we’ll explore how to leverage AudioGen to create custom environmental sounds, ambient effects, and sound design elements through simple text prompts.</p>

<h2 id="learning-objectives">Learning Objectives</h2>

<p>By the end of this chapter, you’ll be able to:</p>

<ul>
  <li>Generate realistic environmental sounds and effects using text prompts</li>
  <li>Craft effective prompts that produce the desired audio characteristics</li>
  <li>Optimize AudioGen’s parameters for different types of sound effects</li>
  <li>Create and save a library of custom sound effects for your projects</li>
  <li>Understand key differences between AudioGen and MusicGen models</li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<p>Before proceeding, ensure you have:</p>
<ul>
  <li>Completed the setup instructions in Chapter 2</li>
  <li>Basic understanding of the AudioCraft framework from Chapter 3</li>
  <li>Python environment with AudioCraft installed and functioning</li>
  <li>Basic familiarity with audio concepts (sample rate, duration, etc.)</li>
</ul>

<h2 id="key-concepts">Key Concepts</h2>

<h3 id="understanding-audiogen-vs-musicgen">Understanding AudioGen vs. MusicGen</h3>

<p>While both models are part of the AudioCraft framework, AudioGen and MusicGen serve distinct purposes and were trained on different datasets. MusicGen specializes in creating musical compositions with instruments, rhythm, and melody, while AudioGen focuses on non-musical sounds like environmental effects, mechanical noises, and ambient soundscapes.</p>

<p>Think of MusicGen as a composer who creates structured musical pieces, while AudioGen is more like a sound designer who crafts the ambient sounds for a film scene or game environment. The distinction is important because prompts that work well for MusicGen may not be effective for AudioGen, and vice versa.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># MusicGen example (musical content)
</span><span class="n">music_prompt</span> <span class="o">=</span> <span class="s">"An upbeat electronic track with a catchy melody"</span>

<span class="c1"># AudioGen example (non-musical content)
</span><span class="n">sound_prompt</span> <span class="o">=</span> <span class="s">"Heavy rain falling on a metal roof with occasional thunder"</span>
</code></pre></div></div>

<h3 id="sound-effect-categories">Sound Effect Categories</h3>

<p>AudioGen can generate a wide range of sound effects that generally fall into several categories:</p>

<ol>
  <li><strong>Environmental</strong>: Natural sounds like rain, wind, water, fire</li>
  <li><strong>Urban</strong>: City sounds, traffic, construction, crowds</li>
  <li><strong>Mechanical</strong>: Machines, engines, tools, electronics</li>
  <li><strong>Biological</strong>: Animal sounds, human non-speech sounds</li>
  <li><strong>Abstract</strong>: Synthetic sounds, textures, atmospheres</li>
</ol>

<p>Understanding these categories helps you craft prompts that align with AudioGen’s strengths and training data. For example, AudioGen excels at creating realistic rain sounds but may struggle with very specific musical instruments (which would be MusicGen’s strength).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Example prompts for different sound categories
</span><span class="n">environmental</span> <span class="o">=</span> <span class="s">"Forest ambience with birds chirping, leaves rustling, and a stream flowing"</span>
<span class="n">urban</span> <span class="o">=</span> <span class="s">"Busy coffee shop with espresso machines, quiet conversations, and clinking cups"</span>
<span class="n">mechanical</span> <span class="o">=</span> <span class="s">"Old mechanical clock ticking with gears turning and occasional chimes"</span>
<span class="n">biological</span> <span class="o">=</span> <span class="s">"Dogs barking and playing in a dog park with panting and paws on grass"</span>
<span class="n">abstract</span> <span class="o">=</span> <span class="s">"Ethereal atmospheric sound with shimmering textures and deep resonances"</span>
</code></pre></div></div>

<h2 id="solution-walkthrough">Solution Walkthrough</h2>

<h3 id="1-setting-up-audiogen">1. Setting Up AudioGen</h3>

<p>Let’s begin by importing the necessary libraries and setting up AudioGen. Unlike MusicGen, which comes in three sizes (small, medium, large), AudioGen only offers “medium” and “large” variants.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchaudio</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">audiocraft.models</span> <span class="kn">import</span> <span class="n">AudioGen</span>
<span class="kn">from</span> <span class="nn">audiocraft.data.audio</span> <span class="kn">import</span> <span class="n">audio_write</span>

<span class="c1"># Determine the best available device for computation
</span><span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">backends</span><span class="p">.</span><span class="n">mps</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="n">device</span> <span class="o">=</span> <span class="s">"mps"</span>  <span class="c1"># Apple Silicon GPU
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Using MPS (Metal) for generation"</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="n">device</span> <span class="o">=</span> <span class="s">"cuda"</span>  <span class="c1"># NVIDIA GPU
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Using CUDA for generation"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">device</span> <span class="o">=</span> <span class="s">"cpu"</span>  <span class="c1"># Fallback to CPU
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Using CPU for generation (this will be slow)"</span><span class="p">)</span>

<span class="c1"># Load the AudioGen model - note: only "medium" and "large" are available
</span><span class="n">model_size</span> <span class="o">=</span> <span class="s">"medium"</span>  <span class="c1"># Use "medium" for faster generation or "large" for higher quality
</span><span class="n">model</span> <span class="o">=</span> <span class="n">AudioGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="n">model_size</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># Move model to the appropriate compute device
</span></code></pre></div></div>

<h3 id="2-configuring-generation-parameters">2. Configuring Generation Parameters</h3>

<p>Now that we have AudioGen loaded, we need to set the generation parameters that control the sound output. For sound effects, we typically use shorter durations (3-15 seconds) compared to music, and we might want to experiment with different temperature values to get varied results.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Configure generation parameters
</span><span class="n">duration</span> <span class="o">=</span> <span class="mf">5.0</span>  <span class="c1"># Sound effects often work well with shorter durations (in seconds)
</span><span class="n">temperature</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Controls randomness/creativity of the generation
</span>
<span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span>
    <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>        <span class="c1"># How long the generated audio will be
</span>    <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>  <span class="c1"># Controls randomness/creativity
</span>    <span class="n">top_k</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>                <span class="c1"># Sample from top 250 token predictions
</span>    <span class="n">top_p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>                <span class="c1"># Disable nucleus sampling (use top_k instead)
</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-crafting-and-using-sound-prompts">3. Crafting and Using Sound Prompts</h3>

<p>The prompt is the most critical element for getting good results with AudioGen. Let’s create a function that allows us to generate sound effects from text descriptions:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">generate_sound_effect</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s">"sound_effects"</span><span class="p">):</span>
    <span class="s">"""Generate a sound effect based on a text description."""</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating sound: '</span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s">'"</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    
    <span class="c1"># Create output directory if it doesn't exist
</span>    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Generate the sound based on the text prompt
</span>    <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">([</span><span class="n">prompt</span><span class="p">])</span>  <span class="c1"># Model expects a list of prompts
</span>    
    <span class="c1"># Create a filesystem-safe filename based on the prompt
</span>    <span class="n">safe_prompt</span> <span class="o">=</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span> <span class="k">if</span> <span class="n">c</span><span class="p">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="k">else</span> <span class="s">"_"</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">prompt</span><span class="p">)[:</span><span class="mi">30</span><span class="p">]</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">safe_prompt</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">model_size</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s">s"</span>
    
    <span class="c1"># Save the generated audio as a WAV file
</span>    <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">audio_write</span><span class="p">(</span>
        <span class="n">output_path</span><span class="p">,</span>              <span class="c1"># Path without extension
</span>        <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">(),</span>             <span class="c1"># Audio tensor (first in batch)
</span>        <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>        <span class="c1"># Sample rate (32kHz for AudioGen)
</span>        <span class="n">strategy</span><span class="o">=</span><span class="s">"loudness"</span><span class="p">,</span>      <span class="c1"># Normalize loudness for consistent volume
</span>    <span class="p">)</span>
    
    <span class="n">generation_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generation completed in </span><span class="si">{</span><span class="n">generation_time</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Audio saved to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span>
</code></pre></div></div>

<h3 id="4-creating-a-sound-effect-library">4. Creating a Sound Effect Library</h3>

<p>Now, let’s use our function to generate a variety of sound effects across different categories. This will help us build a small sound effect library that could be used in projects:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define example prompts for different sound categories
</span><span class="n">sound_prompts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Weather and nature
</span>    <span class="s">"rain_heavy"</span><span class="p">:</span> <span class="s">"Heavy rain falling on a metal roof with water dripping and occasional thunder"</span><span class="p">,</span>
    <span class="s">"wind_forest"</span><span class="p">:</span> <span class="s">"Strong wind blowing through forest trees with leaves rustling and branches creaking"</span><span class="p">,</span>
    <span class="s">"ocean_waves"</span><span class="p">:</span> <span class="s">"Ocean waves crashing on a rocky shore with seagulls calling in the distance"</span><span class="p">,</span>
    <span class="s">"river_stream"</span><span class="p">:</span> <span class="s">"Gentle river flowing over rocks with water bubbling and splashing"</span><span class="p">,</span>
    
    <span class="c1"># Urban environments
</span>    <span class="s">"city_traffic"</span><span class="p">:</span> <span class="s">"Busy city intersection with car horns, engines revving, and distant sirens"</span><span class="p">,</span>
    <span class="s">"cafe_ambience"</span><span class="p">:</span> <span class="s">"Busy coffee shop with espresso machines, quiet conversations, and clinking cups"</span><span class="p">,</span>
    <span class="s">"construction"</span><span class="p">:</span> <span class="s">"Construction site with jackhammers, power drills, and workers shouting"</span><span class="p">,</span>
    <span class="s">"subway_station"</span><span class="p">:</span> <span class="s">"Underground subway station with train arriving, brakes screeching, and station announcements"</span><span class="p">,</span>
    
    <span class="c1"># Mechanical and electronic
</span>    <span class="s">"old_clock"</span><span class="p">:</span> <span class="s">"Old mechanical clock ticking with gears turning and a soft bell chime every few seconds"</span><span class="p">,</span>
    <span class="s">"factory_machinery"</span><span class="p">:</span> <span class="s">"Factory manufacturing floor with conveyor belts, pneumatic presses, and robotic arms"</span><span class="p">,</span>
    <span class="s">"old_computer"</span><span class="p">:</span> <span class="s">"Vintage computer with whirring fan, clicking hard drive, and electronic processing sounds"</span><span class="p">,</span>
    <span class="s">"sci_fi_spaceship"</span><span class="p">:</span> <span class="s">"Futuristic spaceship engine room with humming reactors, beeping consoles, and steam venting"</span>
<span class="p">}</span>

<span class="c1"># Generate and save each sound effect
</span><span class="k">for</span> <span class="n">sound_name</span><span class="p">,</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="n">sound_prompts</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">generate_sound_effect</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s">"sound_library"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Created </span><span class="si">{</span><span class="n">sound_name</span><span class="si">}</span><span class="s"> effect: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="complete-implementation">Complete Implementation</h2>

<p>Let’s put everything together into a complete, runnable example that demonstrates generating sound effects with AudioGen:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># audiogen_sound_library.py - Generate a library of sound effects using AudioGen
</span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">audiocraft.models</span> <span class="kn">import</span> <span class="n">AudioGen</span>
<span class="kn">from</span> <span class="nn">audiocraft.data.audio</span> <span class="kn">import</span> <span class="n">audio_write</span>

<span class="k">def</span> <span class="nf">generate_sound_effect</span><span class="p">(</span>
    <span class="n">prompt</span><span class="p">,</span>
    <span class="n">duration</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
    <span class="n">model_size</span><span class="o">=</span><span class="s">"medium"</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s">"sound_effects"</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span>
<span class="p">):</span>
    <span class="s">"""
    Generate environmental sounds and audio effects based on a text description.
    
    Args:
        prompt (str): Detailed text description of the sound to generate
        duration (float): Length of audio to generate in seconds (recommended: 3-10s)
        model_size (str): Size of model to use - only "medium" or "large" are available
        output_dir (str): Directory where generated audio will be saved
        temperature (float): Controls randomness/variability of generation
                           (higher = more random/creative, lower = more deterministic)
    
    Returns:
        str: Path to the generated audio file (.wav format)
    """</span>
    <span class="c1"># Create output directory if it doesn't exist
</span>    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating sound for prompt: '</span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s">'"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Using model size: </span><span class="si">{</span><span class="n">model_size</span><span class="si">}</span><span class="s">, duration: </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s">s"</span><span class="p">)</span>
    
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    
    <span class="c1"># Determine the best available device for computation
</span>    <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">backends</span><span class="p">.</span><span class="n">mps</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"mps"</span>  <span class="c1"># Apple Silicon GPU
</span>        <span class="k">print</span><span class="p">(</span><span class="s">"Using MPS (Metal) for generation"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cuda"</span>  <span class="c1"># NVIDIA GPU
</span>        <span class="k">print</span><span class="p">(</span><span class="s">"Using CUDA for generation"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cpu"</span>  <span class="c1"># Fallback to CPU
</span>        <span class="k">print</span><span class="p">(</span><span class="s">"Using CPU for generation (this will be slow)"</span><span class="p">)</span>
    
    <span class="c1"># Load the AudioGen model
</span>    <span class="n">model</span> <span class="o">=</span> <span class="n">AudioGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="n">model_size</span><span class="p">)</span>
    <span class="n">model</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># Move model to the appropriate compute device
</span>    
    <span class="c1"># Configure generation parameters
</span>    <span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span>
        <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>        <span class="c1"># How long the generated audio will be
</span>        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>  <span class="c1"># Controls randomness/creativity
</span>        <span class="n">top_k</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>                <span class="c1"># Sample from top 250 token predictions
</span>        <span class="n">top_p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>                <span class="c1"># Disable nucleus sampling (use top_k instead)
</span>    <span class="p">)</span>
    
    <span class="c1"># Generate the sound based on the text prompt
</span>    <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">([</span><span class="n">prompt</span><span class="p">])</span>  <span class="c1"># Model expects a list of prompts
</span>    
    <span class="c1"># Create a filesystem-safe filename based on the prompt
</span>    <span class="n">safe_prompt</span> <span class="o">=</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span> <span class="k">if</span> <span class="n">c</span><span class="p">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="k">else</span> <span class="s">"_"</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">prompt</span><span class="p">)[:</span><span class="mi">30</span><span class="p">]</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">safe_prompt</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">model_size</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s">s"</span>
    
    <span class="c1"># Save the generated audio as a WAV file
</span>    <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">audio_write</span><span class="p">(</span>
        <span class="n">output_path</span><span class="p">,</span>              <span class="c1"># Path without extension
</span>        <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">(),</span>             <span class="c1"># Audio tensor (first in batch)
</span>        <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span>        <span class="c1"># Sample rate (32kHz for AudioGen)
</span>        <span class="n">strategy</span><span class="o">=</span><span class="s">"loudness"</span><span class="p">,</span>      <span class="c1"># Normalize loudness for consistent volume
</span>    <span class="p">)</span>
    
    <span class="n">generation_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generation completed in </span><span class="si">{</span><span class="n">generation_time</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Audio saved to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span>

<span class="k">def</span> <span class="nf">create_sound_library</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s">"sound_library"</span><span class="p">):</span>
    <span class="s">"""
    Generate a library of sound effects across different categories.
    
    Args:
        category (str, optional): Specific category to generate, or None for all categories
        output_dir (str): Directory to save the sound effects
    """</span>
    <span class="c1"># Define sound effect prompts organized by category
</span>    <span class="n">sound_categories</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"weather"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"rain_light"</span><span class="p">:</span> <span class="s">"Light rainfall on leaves with occasional drips and gentle wind"</span><span class="p">,</span>
            <span class="s">"rain_heavy"</span><span class="p">:</span> <span class="s">"Heavy rain pouring down with water splashing in puddles and thunder rumbling"</span><span class="p">,</span>
            <span class="s">"wind_gentle"</span><span class="p">:</span> <span class="s">"Gentle breeze rustling leaves with occasional bird chirps"</span><span class="p">,</span>
            <span class="s">"wind_storm"</span><span class="p">:</span> <span class="s">"Howling wind of a severe storm with debris flying and trees creaking"</span><span class="p">,</span>
            <span class="s">"thunder_storm"</span><span class="p">:</span> <span class="s">"Thunderstorm with heavy rain, cracking thunder, and strong winds"</span>
        <span class="p">},</span>
        
        <span class="s">"nature"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"forest_day"</span><span class="p">:</span> <span class="s">"Daytime forest with birds chirping, leaves rustling, and a distant stream"</span><span class="p">,</span>
            <span class="s">"forest_night"</span><span class="p">:</span> <span class="s">"Nighttime forest with crickets, occasional owl hoots, and gentle breeze"</span><span class="p">,</span>
            <span class="s">"ocean_waves"</span><span class="p">:</span> <span class="s">"Ocean waves crashing on a sandy beach with seagulls in the distance"</span><span class="p">,</span>
            <span class="s">"river_stream"</span><span class="p">:</span> <span class="s">"Small stream flowing over rocks with water bubbling and splashing gently"</span><span class="p">,</span>
            <span class="s">"jungle"</span><span class="p">:</span> <span class="s">"Dense jungle with exotic birds calling, insects buzzing, and leaves rustling"</span>
        <span class="p">},</span>
        
        <span class="s">"urban"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"city_traffic"</span><span class="p">:</span> <span class="s">"Busy city street with cars passing, horns honking, and people talking"</span><span class="p">,</span>
            <span class="s">"cafe"</span><span class="p">:</span> <span class="s">"Coffee shop ambience with espresso machines, quiet conversations, and cups clinking"</span><span class="p">,</span>
            <span class="s">"restaurant"</span><span class="p">:</span> <span class="s">"Busy restaurant with utensils on plates, conversations, and kitchen sounds"</span><span class="p">,</span>
            <span class="s">"construction"</span><span class="p">:</span> <span class="s">"Construction site with jackhammers, power tools, and workers calling out"</span><span class="p">,</span>
            <span class="s">"subway"</span><span class="p">:</span> <span class="s">"Subway train arriving at station with screeching brakes and announcements"</span>
        <span class="p">},</span>
        
        <span class="s">"mechanical"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"clock"</span><span class="p">:</span> <span class="s">"Old mechanical clock with ticking gears, pendulum swinging, and occasional chimes"</span><span class="p">,</span>
            <span class="s">"factory"</span><span class="p">:</span> <span class="s">"Factory machinery with conveyor belts, hydraulic presses, and metal clanking"</span><span class="p">,</span>
            <span class="s">"engine_small"</span><span class="p">:</span> <span class="s">"Small engine running with mechanical parts whirring and occasional misfires"</span><span class="p">,</span>
            <span class="s">"engine_large"</span><span class="p">:</span> <span class="s">"Large industrial engine with powerful rhythmic pounding and steam releases"</span><span class="p">,</span>
            <span class="s">"typewriter"</span><span class="p">:</span> <span class="s">"Manual typewriter with keys clacking, carriage moving, and bell dinging"</span>
        <span class="p">},</span>
        
        <span class="s">"household"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"kitchen"</span><span class="p">:</span> <span class="s">"Kitchen sounds with chopping vegetables, water running, and pots simmering"</span><span class="p">,</span>
            <span class="s">"bathroom"</span><span class="p">:</span> <span class="s">"Bathroom with shower running, water draining, and fan humming"</span><span class="p">,</span>
            <span class="s">"living_room"</span><span class="p">:</span> <span class="s">"Living room with clock ticking, pages turning, and occasional footsteps"</span><span class="p">,</span>
            <span class="s">"laundry"</span><span class="p">:</span> <span class="s">"Laundry room with washing machine spinning, clothes tumbling, and water filling"</span><span class="p">,</span>
            <span class="s">"garden"</span><span class="p">:</span> <span class="s">"Garden with lawn mower running, birds chirping, and sprinkler spraying"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1"># Create the main output directory
</span>    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Determine which categories to generate
</span>    <span class="n">categories_to_generate</span> <span class="o">=</span> <span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="k">if</span> <span class="n">category</span> <span class="k">else</span> <span class="n">sound_categories</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">category_name</span> <span class="ow">in</span> <span class="n">categories_to_generate</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">category_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sound_categories</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Category '</span><span class="si">{</span><span class="n">category_name</span><span class="si">}</span><span class="s">' not found. Available categories:"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">available_category</span> <span class="ow">in</span> <span class="n">sound_categories</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"- </span><span class="si">{</span><span class="n">available_category</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># Create category subdirectory
</span>        <span class="n">category_dir</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">category_name</span><span class="p">)</span>
        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">category_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="se">\n</span><span class="s">===== Generating </span><span class="si">{</span><span class="n">category_name</span><span class="p">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s"> SOUNDS =====</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
        
        <span class="c1"># Generate each sound in the category
</span>        <span class="k">for</span> <span class="n">sound_name</span><span class="p">,</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="n">sound_categories</span><span class="p">[</span><span class="n">category_name</span><span class="p">].</span><span class="n">items</span><span class="p">():</span>
            <span class="n">output_path</span> <span class="o">=</span> <span class="n">generate_sound_effect</span><span class="p">(</span>
                <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
                <span class="n">duration</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                <span class="n">output_dir</span><span class="o">=</span><span class="n">category_dir</span>
            <span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Created </span><span class="si">{</span><span class="n">sound_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
            
            <span class="c1"># Clear GPU cache between generations if using CUDA
</span>            <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
                <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">empty_cache</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"Generate a library of sound effects with AudioGen"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--category"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                        <span class="n">help</span><span class="o">=</span><span class="s">"Specific category to generate (weather, nature, urban, mechanical, household)"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--output"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">"sound_library"</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Output directory for sound effects"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--model"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">"medium"</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">"medium"</span><span class="p">,</span> <span class="s">"large"</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Model size to use (medium or large)"</span><span class="p">)</span>
    
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>
    
    <span class="n">create_sound_library</span><span class="p">(</span>
        <span class="n">category</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">category</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">output</span>
    <span class="p">)</span>
</code></pre></div></div>

<h2 id="variations-and-customizations">Variations and Customizations</h2>

<p>Let’s explore some variations of our solution to address different needs or preferences.</p>

<h3 id="variation-1-ambient-soundscape-generator">Variation 1: Ambient Soundscape Generator</h3>

<p>Instead of short, focused sound effects, you might want to create longer ambient soundscapes for background audio in games, videos, or meditation apps:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">generate_ambient_soundscape</span><span class="p">(</span>
    <span class="n">environment</span><span class="p">,</span>
    <span class="n">duration</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
    <span class="n">model_size</span><span class="o">=</span><span class="s">"medium"</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s">"ambient_soundscapes"</span>
<span class="p">):</span>
    <span class="s">"""
    Generate a longer ambient soundscape for a specific environment.
    
    Args:
        environment (str): Type of environment or specific description
        duration (float): Length of audio in seconds (10-30 seconds recommended)
        model_size (str): Size of model to use
        temperature (float): Controls randomness
        output_dir (str): Directory to save output
    """</span>
    <span class="c1"># Create prompt with ambient-specific language
</span>    <span class="n">ambient_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"Continuous ambient background sound of </span><span class="si">{</span><span class="n">environment</span><span class="si">}</span><span class="s"> with subtle variations and natural evolution of elements"</span>
    
    <span class="c1"># Lower temperature for more consistent ambient backgrounds
</span>    <span class="k">return</span> <span class="n">generate_sound_effect</span><span class="p">(</span>
        <span class="n">prompt</span><span class="o">=</span><span class="n">ambient_prompt</span><span class="p">,</span>
        <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
        <span class="n">model_size</span><span class="o">=</span><span class="n">model_size</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span>
    <span class="p">)</span>

<span class="c1"># Example usage
</span><span class="n">environments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"peaceful forest with distant birds and gentle wind"</span><span class="p">,</span>
    <span class="s">"calm ocean waves on a beach with occasional seagulls"</span><span class="p">,</span>
    <span class="s">"light rainfall on a window with distant thunder"</span><span class="p">,</span>
    <span class="s">"busy coffee shop with quiet conversations and kitchen sounds"</span><span class="p">,</span>
    <span class="s">"space station with humming equipment and occasional beeps"</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">env</span> <span class="ow">in</span> <span class="n">environments</span><span class="p">:</span>
    <span class="n">generate_ambient_soundscape</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">20.0</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="variation-2-sound-effect-layering">Variation 2: Sound Effect Layering</h3>

<p>For more complex sound design, you might want to generate and layer multiple sound elements:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">def</span> <span class="nf">generate_layered_soundscape</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s">"layered_sounds"</span><span class="p">):</span>
    <span class="s">"""
    Generate multiple sound elements and layer them into a single audio file.
    
    Args:
        elements (dict): Dictionary of sound element descriptions
        output_dir (str): Directory to save outputs
    """</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s">"elements"</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Load model once to avoid reloading for each element
</span>    <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">backends</span><span class="p">.</span><span class="n">mps</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"mps"</span>
    <span class="k">elif</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cuda"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s">"cpu"</span>
        
    <span class="n">model</span> <span class="o">=</span> <span class="n">AudioGen</span><span class="p">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="s">"medium"</span><span class="p">)</span>
    <span class="n">model</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">sample_rate</span>
    
    <span class="c1"># Generate each sound element
</span>    <span class="n">generated_sounds</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Generating sound element: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Description: '</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s">'"</span><span class="p">)</span>
        
        <span class="c1"># Set generation parameters
</span>        <span class="n">model</span><span class="p">.</span><span class="n">set_generation_params</span><span class="p">(</span>
            <span class="n">duration</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>          <span class="c1"># Length of each element
</span>            <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>       <span class="c1"># Standard creativity level
</span>            <span class="n">top_k</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>             <span class="c1"># Diverse but controlled sampling
</span>            <span class="n">top_p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>             <span class="c1"># Disable nucleus sampling
</span>        <span class="p">)</span>
        
        <span class="c1"># Generate the sound
</span>        <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">generate</span><span class="p">([</span><span class="n">description</span><span class="p">])</span>
        <span class="n">audio_array</span> <span class="o">=</span> <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">().</span><span class="n">numpy</span><span class="p">()</span>
        
        <span class="c1"># Save individual element
</span>        <span class="n">element_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s">"elements"</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">audio_write</span><span class="p">(</span>
            <span class="n">element_path</span><span class="p">,</span>
            <span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpu</span><span class="p">(),</span>
            <span class="n">sample_rate</span><span class="p">,</span>
            <span class="n">strategy</span><span class="o">=</span><span class="s">"loudness"</span>
        <span class="p">)</span>
        
        <span class="n">generated_sounds</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"audio"</span><span class="p">:</span> <span class="n">audio_array</span><span class="p">,</span>
            <span class="s">"path"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">element_path</span><span class="si">}</span><span class="s">.wav"</span>
        <span class="p">}</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Saved element to </span><span class="si">{</span><span class="n">element_path</span><span class="si">}</span><span class="s">.wav"</span><span class="p">)</span>
    
    <span class="c1"># Combine sounds
</span>    <span class="c1"># Initialize an empty audio array at the proper length
</span>    <span class="n">max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sound</span><span class="p">[</span><span class="s">"audio"</span><span class="p">].</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">sound</span> <span class="ow">in</span> <span class="n">generated_sounds</span><span class="p">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">combined_audio</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_length</span><span class="p">)</span>
    
    <span class="c1"># Mix all sounds together
</span>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">sound</span> <span class="ow">in</span> <span class="n">generated_sounds</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Normalize the volume of each sound element
</span>        <span class="n">normalized</span> <span class="o">=</span> <span class="n">sound</span><span class="p">[</span><span class="s">"audio"</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">generated_sounds</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">)</span>  <span class="c1"># Prevent clipping
</span>        
        <span class="c1"># Add to the combined audio
</span>        <span class="n">combined_audio</span><span class="p">[:</span><span class="n">normalized</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">normalized</span>
    
    <span class="c1"># Ensure the combined audio doesn't clip
</span>    <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">combined_audio</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">combined_audio</span> <span class="o">=</span> <span class="n">combined_audio</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">combined_audio</span><span class="p">))</span>
    
    <span class="c1"># Convert back to torch tensor
</span>    <span class="n">combined_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">combined_audio</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
    
    <span class="c1"># Save the combined sound
</span>    <span class="n">scene_name</span> <span class="o">=</span> <span class="s">"_"</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">elements</span><span class="p">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">30</span><span class="p">]</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s">"scene_</span><span class="si">{</span><span class="n">scene_name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">torchaudio</span><span class="p">.</span><span class="n">save</span><span class="p">(</span>
        <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span><span class="p">,</span>
        <span class="n">combined_tensor</span><span class="p">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>  <span class="c1"># Add channel dimension
</span>        <span class="n">sample_rate</span>
    <span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Combined soundscape saved to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s">.wav"</span>

<span class="c1"># Example usage
</span><span class="n">rainy_cafe_scene</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"rain"</span><span class="p">:</span> <span class="s">"Heavy rain falling on windows and roof with occasional thunder"</span><span class="p">,</span>
    <span class="s">"cafe"</span><span class="p">:</span> <span class="s">"Inside cafe ambience with quiet conversations and cups clinking"</span><span class="p">,</span>
    <span class="s">"music"</span><span class="p">:</span> <span class="s">"Soft jazz music playing from speakers, very quiet in the background"</span><span class="p">,</span>
    <span class="s">"traffic"</span><span class="p">:</span> <span class="s">"Occasional traffic sounds from outside, muffled by the rain"</span>
<span class="p">}</span>

<span class="n">generate_layered_soundscape</span><span class="p">(</span><span class="n">rainy_cafe_scene</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="common-pitfalls-and-troubleshooting">Common Pitfalls and Troubleshooting</h2>

<h3 id="problem-inconsistent-sound-quality">Problem: Inconsistent Sound Quality</h3>

<p>Sometimes AudioGen might produce sounds with artifacts or inconsistencies, especially for complex sound descriptions.</p>

<p><strong>Solution</strong>:</p>
<ul>
  <li>Break down complex sounds into individual elements and layer them (as in Variation 2)</li>
  <li>Use more specific, detailed prompts</li>
  <li>Try different temperature settings (lower for more consistent results)</li>
  <li>Use the “large” model for higher quality output, if your hardware can handle it</li>
</ul>

<h3 id="problem-missing-sound-elements">Problem: Missing Sound Elements</h3>

<p>You might notice that sometimes AudioGen misses certain elements from your prompt.</p>

<p><strong>Solution</strong>:</p>
<ul>
  <li>Prioritize the most important sound elements earlier in your prompt</li>
  <li>Try to limit prompts to 2-3 key sound elements</li>
  <li>Generate separate sounds for complex scenes and combine them manually</li>
  <li>Emphasize specific elements with descriptive language (e.g., “prominent”, “clearly audible”)</li>
</ul>

<h3 id="problem-unrealistic-sound-textures">Problem: Unrealistic Sound Textures</h3>

<p>Some generated sounds might not sound entirely realistic, especially for specific mechanical or electronic sounds.</p>

<p><strong>Solution</strong>:</p>
<ul>
  <li>Focus on the general sound character rather than specifics</li>
  <li>Combine with real recorded samples when needed</li>
  <li>Post-process the audio with effects to enhance realism</li>
  <li>Try multiple generations with the same prompt to get variations</li>
</ul>

<h2 id="hands-on-challenge">Hands-on Challenge</h2>

<p>Now it’s your turn to experiment with what you’ve learned. Try the following challenge:</p>

<h3 id="challenge-interactive-sound-effect-generator">Challenge: Interactive Sound Effect Generator</h3>

<p>Create a script that:</p>
<ol>
  <li>Presents a menu of sound categories (weather, nature, mechanical, etc.)</li>
  <li>Allows the user to input custom text descriptions for sounds</li>
  <li>Generates the sound effect and plays it back</li>
  <li>Gives the option to save successful generations to a sound library</li>
  <li>Implements parameter controls for duration and temperature</li>
</ol>

<h3 id="bonus-challenge">Bonus Challenge</h3>

<p>Create a “sound scene composer” that allows you to:</p>
<ol>
  <li>Generate multiple sound elements with different parameters</li>
  <li>Adjust the volume level of each element</li>
  <li>Apply basic effects (reverb, EQ, etc.) to individual elements</li>
  <li>Mix the elements together with proper timing</li>
  <li>Export the final composed scene</li>
</ol>

<h2 id="key-takeaways">Key Takeaways</h2>

<ul>
  <li>AudioGen specializes in non-musical sounds and effects, complementing MusicGen’s focus on music</li>
  <li>Detailed, specific prompts with clear sound descriptions produce the best results</li>
  <li>Sound generation benefits from proper categorization (environmental, mechanical, etc.)</li>
  <li>Complex soundscapes can be created by layering multiple generated elements</li>
  <li>Parameter tuning (especially temperature) significantly affects the character of generated sounds</li>
</ul>

<h2 id="next-steps">Next Steps</h2>

<p>Now that you’ve mastered basic sound effect generation with AudioGen, you’re ready to explore:</p>

<ul>
  <li><strong>Chapter 11: Crafting Sound Effect Prompts</strong>: Learn advanced techniques for optimizing sound descriptions</li>
  <li><strong>Chapter 12: Building Sound Libraries</strong>: Discover methods for organizing and categorizing generated sounds</li>
  <li><strong>Chapter 13: Creating Complex Soundscapes</strong>: Explore advanced techniques for layering and composition</li>
  <li><strong>Chapter 18: Building a Complete Audio Pipeline</strong>: Combine sound effects with music and speech</li>
</ul>

<h2 id="further-reading">Further Reading</h2>

<ul>
  <li><a href="https://ai.meta.com/blog/audiocraft-musicgen-audiogen-encodec-generative-ai-audio/">Meta AI AudioCraft Blog Post</a></li>
  <li><a href="https://www.soundonsound.com/techniques/sound-design-basics">Sound Design Fundamentals</a></li>
  <li><a href="https://www.filmindependent.org/blog/know-the-score-the-role-of-sound-design-in-filmmaking/">Film Sound Theory</a></li>
  <li><a href="https://www.gamasutra.com/blogs/PeterGofton/20160620/275070/Sound_Design_Deep_Dive_Creating_the_Sound_for_Alien_Isolation.php">Game Audio Resources</a></li>
</ul>

  
  
  
  
  
  
  
  
</div>

<div class="chapter-navigation">
  
  
  
</div>

<!-- Copyright footer for all chapter pages -->
<div class="copyright-footer">
  <hr>
  <p>
    Copyright © 2025 Scott Friedman.
    <br>
    This work is licensed under the <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.
  </p>
</div>


        </div>
      </main>

      <footer class="site-footer">
        <div class="container">
          <div class="footer-col-wrapper">
            <div class="footer-col">
              <p>A hands-on guide to creating music, sound effects, and audio experiences with AI</p>
              <p>
                <a href="https://github.com/facebookresearch/audiocraft">AudioCraft GitHub Repository</a>
              </p>
            </div>
            <div class="footer-col">
              <p class="copyright">
                Copyright © 2025 Scott Friedman.<br>
                Licensed under <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a>.
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>